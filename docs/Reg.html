<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>3&nbsp; Regression – Kausalanalyse mit R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Simulation.html" rel="next">
<link href="./R_Einfuehrung.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script><script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<meta name="robots" content="noindex">
<script>
  MathJax = {
    tex: {
      tags: 'ams'  // should be 'ams', 'none', or 'all'
    }
  };
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js" integrity="sha512-aoZChv+8imY/U1O7KIHXvO87EOzCuKO0GhFtpD6G2Cyjo/xPeTgdf3/bchB10iB+AojMTDkMHDPLKNxPJVqDcw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
<style>
  .panel-tabset .tab-content {
    border: 0;
    padding: 1em 0 0 0;
  }
  
  .panel-tabset .nav-item a {
    border-radius: 5px 5px 0 0;
  }
  
  .scientific_borders {
    border: 0;
    border-top: 2px solid black !important; 
    border-bottom: 2px solid black !important;
  }
  .table:not(.gt_table) > :not(caption)>*>* {
    border-bottom-width: 0;
  }
  .table:not(.gt_table) > thead {
    border-bottom: 1px solid black;
  }
  .soft-box-shadow {
    border: 1px solid rgba(233,236,239,.9) !important;
    border-radius: .5rem !important;
    background-color: rgba(250,250,250,.9) !important;
    box-shadow: 0px 1px 2px rgba(0,0,0,.1),
                0px 3px 7px rgba(0,0,0,.1),
                0px 12px 30px rgba(0,0,0,.08);
    margin-top: 2rem !important;
    margin-bottom: 2.5rem !important;
    padding: .25rem !important;
  }
  .obs-soft-box-shadow {
    border: 1px solid rgba(233,236,239,.9) !important;
    border-radius: .5rem !important;
    background-color: white !important;
    box-shadow: 0px 1px 2px rgba(0,0,0,.1),
                0px 3px 7px rgba(0,0,0,.1),
                0px 12px 30px rgba(0,0,0,.08);
    margin-top: 2rem !important;
    margin-bottom: 2.5rem !important;
    padding: .25rem !important;
  }
  
</style>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    
    var gt_tables = document.querySelectorAll(".gt_table");
    gt_tables.forEach(function(table) {
      table.classList.remove("table-striped");
    });
    
    var tables = document.querySelectorAll("table.table:not(.gt_table)");
    tables.forEach(function(table) {
      table.classList.remove("table-striped");
      table.classList.add("scientific_borders");
    });
    
    document.querySelectorAll("div.sourceCode").forEach(function(block) {
      block.classList.add("soft-box-shadow");
    });
    
    document.querySelectorAll("div.bg-white").forEach(function(block) {
      block.classList.remove("bg-white");
    });
    
const elements = document.querySelectorAll('[id^="qwebr-interactive-area"]');

    elements.forEach(element => {
        element.classList.add('box-shadow');
    });
    
    document.querySelectorAll('[id^="webr"]').forEach(function(block) {
      block.classList.add("box-shadow");
    });
    
        document.querySelectorAll('.card-header').forEach(function(block) {
      block.classList.add("box-shadow");
    });
    
  });
</script><style>
.qwebr-code-output-stdout {background-color: powderblue;}

.qwebr-button-run {
 width = 100%; 
}

.centered-caption {
   text-align: center;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/quizdown@latest/public/build/quizdown.js"></script><script>quizdown.init();</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="custom_styles.css">
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./R_Einfuehrung.html">Grundlagen</a></li><li class="breadcrumb-item"><a href="./Reg.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a><a href="./index.html">Kausalanalyse mit R</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Lesemodus umschalten">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Einführung</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Grundlagen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_Einfuehrung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistische Programmierung mit R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Reg.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Simulation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Kausale Inferenz</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Matching</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FixedEffects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Panel-Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./IV.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">IV-Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./DiD.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Difference-in-Differences</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EventStudies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Event Studies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RDD.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Regression Discontiniuty Designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SyntheticControl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Synthetic Control</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RegReg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Regularisierte Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Support Vector Machines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./trees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Baum-basierte Methoden</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Machine Learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Neuronale Netzwerke</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Übungsaufgaben</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lineare Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ex_simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation mit R</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Literatur.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Literatur</span></a>
  </div>
</li>
    </ul>
</div>
    <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title"><a href="./index.html">Übersicht</a></h2>
   
  <ul>
<li><a href="#regression-schlie%C3%9Ft-backdoors-frish-waugh-lovell-theorem" id="toc-regression-schließt-backdoors-frish-waugh-lovell-theorem" class="nav-link active" data-scroll-target="#regression-schlie%C3%9Ft-backdoors-frish-waugh-lovell-theorem"><span class="header-section-number">3.1</span> Regression schließt Backdoors: Frish-Waugh-Lovell-Theorem</a></li>
  <li>
<a href="#sec-bov" id="toc-sec-bov" class="nav-link" data-scroll-target="#sec-bov"><span class="header-section-number">3.2</span> Binäre Outcome-Variable</a>
  <ul>
<li><a href="#sec-lpm" id="toc-sec-lpm" class="nav-link" data-scroll-target="#sec-lpm"><span class="header-section-number">3.2.1</span> Das lineare Wahrscheinlichkeitsmodell</a></li>
  <li>
<a href="#sec-probitreg" id="toc-sec-probitreg" class="nav-link" data-scroll-target="#sec-probitreg"><span class="header-section-number">3.2.2</span> Probit-Regression</a>
  <ul class="collapse">
<li><a href="#sch%C3%A4tzung" id="toc-schätzung" class="nav-link" data-scroll-target="#sch%C3%A4tzung"><span class="header-section-number">3.2.2.1</span> Schätzung</a></li>
  </ul>
</li>
  <li><a href="#sec-logreg" id="toc-sec-logreg" class="nav-link" data-scroll-target="#sec-logreg"><span class="header-section-number">3.2.3</span> Logistische Regression</a></li>
  <li><a href="#sch%C3%A4tzung-1" id="toc-schätzung-1" class="nav-link" data-scroll-target="#sch%C3%A4tzung-1"><span class="header-section-number">3.2.4</span> Schätzung</a></li>
  <li><a href="#modellg%C3%BCte" id="toc-modellgüte" class="nav-link" data-scroll-target="#modellg%C3%BCte"><span class="header-section-number">3.2.5</span> Modellgüte</a></li>
  <li><a href="#beispiel-klassifikation-von-palmer-piniguinen" id="toc-beispiel-klassifikation-von-palmer-piniguinen" class="nav-link" data-scroll-target="#beispiel-klassifikation-von-palmer-piniguinen"><span class="header-section-number">3.2.6</span> Beispiel: Klassifikation von Palmer-Piniguinen</a></li>
  </ul>
</li>
  <li>
<a href="#sec-poissonreg" id="toc-sec-poissonreg" class="nav-link" data-scroll-target="#sec-poissonreg"><span class="header-section-number">3.3</span> Modellierung von Zählvariablen</a>
  <ul>
<li><a href="#poisson-verteilung" id="toc-poisson-verteilung" class="nav-link" data-scroll-target="#poisson-verteilung"><span class="header-section-number">3.3.1</span> Poisson-Verteilung</a></li>
  <li><a href="#poisson-regression" id="toc-poisson-regression" class="nav-link" data-scroll-target="#poisson-regression"><span class="header-section-number">3.3.2</span> Poisson-Regression</a></li>
  <li><a href="#sch%C3%A4tzung-2" id="toc-schätzung-2" class="nav-link" data-scroll-target="#sch%C3%A4tzung-2"><span class="header-section-number">3.3.3</span> Schätzung</a></li>
  <li><a href="#interpretation-der-koeffizienten" id="toc-interpretation-der-koeffizienten" class="nav-link" data-scroll-target="#interpretation-der-koeffizienten"><span class="header-section-number">3.3.4</span> Interpretation der Koeffizienten</a></li>
  </ul>
</li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./R_Einfuehrung.html">Grundlagen</a></li><li class="breadcrumb-item"><a href="./Reg.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regression</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-regression" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regression</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="cell" data-edit="false">
<div>
<div id="webr-1">

</div>
<script type="webr-1-contents">
eyJjb2RlIjoid2Vicjo6aW5zdGFsbChcImdyYWRldGhpc1wiLCBxdWlldCA9IFRSVUUpXG5saWJyYXJ5KGdyYWRldGhpcylcbm9wdGlvbnMod2Vici5leGVyY2lzZS5jaGVja2VyID0gZnVuY3Rpb24oXG4gIGxhYmVsLCB1c2VyX2NvZGUsIHNvbHV0aW9uX2NvZGUsIGNoZWNrX2NvZGUsIGVudmlyX3Jlc3VsdCwgZXZhbHVhdGVfcmVzdWx0LFxuICBlbnZpcl9wcmVwLCBsYXN0X3ZhbHVlLCBlbmdpbmUsIHN0YWdlLCAuLi5cbikge1xuICBpZiAoaXMubnVsbChjaGVja19jb2RlKSkge1xuICAgICMgTm8gZ3JhZGluZyBjb2RlLCBzbyBqdXN0IHNraXAgZ3JhZGluZ1xuICAgIGludmlzaWJsZShOVUxMKVxuICB9IGVsc2UgaWYgKGlzLm51bGwobGFiZWwpKSB7XG4gICAgbGlzdChcbiAgICAgIGNvcnJlY3QgPSBGQUxTRSxcbiAgICAgIHR5cGUgPSBcIndhcm5pbmdcIixcbiAgICAgIG1lc3NhZ2UgPSBcIkFsbCBleGVyY2lzZXMgbXVzdCBoYXZlIGEgbGFiZWwuXCJcbiAgICApXG4gIH0gZWxzZSBpZiAoaXMubnVsbChzb2x1dGlvbl9jb2RlKSkge1xuICAgIGxpc3QoXG4gICAgICBjb3JyZWN0ID0gRkFMU0UsXG4gICAgICB0eXBlID0gXCJ3YXJuaW5nXCIsXG4gICAgICBtZXNzYWdlID0gaHRtbHRvb2xzOjp0YWdzJGRpdihcbiAgICAgICAgaHRtbHRvb2xzOjp0YWdzJHAoXCJBIHByb2JsZW0gb2NjdXJyZWQgZ3JhZGluZyB0aGlzIGV4ZXJjaXNlLlwiKSxcbiAgICAgICAgaHRtbHRvb2xzOjp0YWdzJHAoXG4gICAgICAgICAgXCJObyBzb2x1dGlvbiBjb2RlIHdhcyBmb3VuZC4gTm90ZSB0aGF0IGdyYWRpbmcgZXhlcmNpc2VzIHVzaW5nIHRoZSBcIixcbiAgICAgICAgICBodG1sdG9vbHM6OnRhZ3MkY29kZShcImdyYWRldGhpc1wiKSxcbiAgICAgICAgICBcInBhY2thZ2UgcmVxdWlyZXMgYSBtb2RlbCBzb2x1dGlvbiB0byBiZSBpbmNsdWRlZCBpbiB0aGUgZG9jdW1lbnQuXCJcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgfSBlbHNlIHtcbiAgICBncmFkZXRoaXM6OmdyYWRldGhpc19leGVyY2lzZV9jaGVja2VyKFxuICAgICAgbGFiZWwgPSBsYWJlbCwgc29sdXRpb25fY29kZSA9IHNvbHV0aW9uX2NvZGUsIHVzZXJfY29kZSA9IHVzZXJfY29kZSxcbiAgICAgIGNoZWNrX2NvZGUgPSBjaGVja19jb2RlLCBlbnZpcl9yZXN1bHQgPSBlbnZpcl9yZXN1bHQsXG4gICAgICBldmFsdWF0ZV9yZXN1bHQgPSBldmFsdWF0ZV9yZXN1bHQsIGVudmlyX3ByZXAgPSBlbnZpcl9wcmVwLFxuICAgICAgbGFzdF92YWx1ZSA9IGxhc3RfdmFsdWUsIHN0YWdlID0gc3RhZ2UsIGVuZ2luZSA9IGVuZ2luZSlcbiAgfVxufSkiLCJhdHRyIjp7ImV2YWwiOnRydWUsIm91dHB1dCI6ZmFsc2UsImVkaXQiOmZhbHNlfX0=
</script>
</div>
</div>
<div class="cell" data-completion="true">
<div>
<div id="webr-2">

</div>
<script type="webr-2-contents">
eyJjb2RlIjoidGFib3B0cyA8LSBmdW5jdGlvbih4KSB7XG4gICAgZm10X251bWJlcih4LCBkZWNpbWFscyA9IDMsIGRyb3BfdHJhaWxpbmdfemVyb3MgPSBUKSAlPiVcbiAgICB0YWJfb3B0aW9ucyh0YWJsZV9ib2R5LmhsaW5lcy5jb2xvciA9IFwid2hpdGVcIixcbiAgICAgICAgICAgICAgY29sdW1uX2xhYmVscy5ib3JkZXIuYm90dG9tLmNvbG9yID0gXCJibGFja1wiLCBcbiAgICAgICAgICAgICBjb2x1bW5fbGFiZWxzLmJvcmRlci50b3AuY29sb3IgPSBcImJsYWNrXCIsXG4gICAgICAgICAgICAgdGFibGVfYm9keS5ib3JkZXIuYm90dG9tLmNvbG9yID0gXCJibGFja1wiLCBcbiAgICAgICAgICAgICB0YWJsZS5ib3JkZXIuYm90dG9tLmNvbG9yID0gXCJibGFja1wiLFxuICAgICAgICAgICAgIGNvbHVtbl9sYWJlbHMuZm9udC53ZWlnaHQgPSBcImJvbGRcIiwgXG4gICAgICAgICAgICAgdGFibGUuZm9udC5jb2xvciA9IFwiYmxhY2tcIiwgXG4gICAgICAgICAgICAgdGFibGUuZm9udC5zaXplID0gMTYpXG59IiwiYXR0ciI6eyJldmFsIjp0cnVlLCJjb21wbGV0aW9uIjp0cnVlLCJlZGl0Ijp0cnVlLCJlY2hvIjpmYWxzZX19
</script>
</div>
</div>
<p>Viele der in diesem Companion behandelten Methoden basiert auf dem Konzept der Schätzung kausaler Effekte mit <em>Regression</em>. Als Regressionsansatz bezeichnet man eine Methode, welche die Beziehungen zwischen Variablen durch einen funktionalen Zusammenhang beschreibt und die Parameter der gewählten funktionalen Form anhand von beobachteten Daten schätzt. <em>Lineare Regression</em> nimmt eine lineare funktionale Form der Beziehung zwischen einer abhängigen Variable (Outcome-Varibale) und erklärenden Variablen (Regressoren) an. <em>Nicht-lineare Regressionsmethoden</em> modellieren die Beziehung etwa durch Polynome höherer Ordnung, exponentielle Funktionen oder andere komplexere Formen. Die Wahl der funktionalen Form hängt von der Natur des datenerzeugenden Prozesses (DGP) und somit stets von der spezifischen Beziehung ab, die untersucht wird.</p>
<p>Regressionsansätze gehören zu den am häufigsten verwendeten Methoden für Kausalanalysen, da so in vielen Forschungsdesigns kausale Effekte identifiziert werden können, indem Backdoors geschlossen werden: Regression kann die durch die Behandlungsvariable verursachte Variation in der Outcome-Variable isolieren, indem für gemeinsame Einflussfaktoren von Behandlungs- <em>und</em> Outcome-Variable kontrolliert wird. In diesem Kapitel erläutern wir Grundlagen der Spezifikation und Schätzung von Regressionsansätzen, die für spätere Kapitel relevant sind. Neben einer Motivation der Schätzung kausaler Effekte mit multipler Regression betrachten wir Modelle für verschiedene Kategorien von Outcome-Variablen und diskutieren deren Implementierung mit R.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="regression-schließt-backdoors-frish-waugh-lovell-theorem" class="level2 page-columns page-full" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="regression-schließt-backdoors-frish-waugh-lovell-theorem">
<span class="header-section-number">3.1</span> Regression schließt Backdoors: Frish-Waugh-Lovell-Theorem</h2>
<p>Das Frisch-Waugh-Lovell-Theorem (FWL) besagt, dass in einer multiplen linearen Regression die geschätzten Koeffizienten für eine Teilmenge der Regressoren numerisch identisch zu Koeffizientenschätzungen aus folgenden Schritten sind</p>
<ol type="1">
<li><p>Rechne die Effekte der übrigen Variablen auf (a) die Outcome-Variable und (b) die Teilmenge der erklärenden Variablen mit Regression heraus und</p></li>
<li><p>regressiere anschließend die Residuen von Schritt (a) auf die Residuen aus Schritt (b).</p></li>
</ol>
<p>In einem multiplen Modell mit zwei Regressoren <span class="math inline">\(X_1,\ X_2\)</span>, <span class="math display">\[\begin{align}
  Y = \beta_0 + \beta_1 X + \beta_2 X_2 + \epsilon \label{eq:fwlfullreg}
\end{align}\]</span> kann der Effekt von <span class="math inline">\(X_1\)</span> auf <span class="math inline">\(Y\)</span> also mit der Regression <span class="math display">\[\begin{align*}
  \widehat{u}_{Y,X_2} = \beta_1 \widehat{u}_{X_1,X_2} + e \label{eq:fwl2reg}
\end{align*}\]</span> geschätzt werden, wobei <span class="math inline">\(\widehat{u}_{Y,X_2}\)</span> und <span class="math inline">\(\widehat{u}_{X_1,X_2}\)</span> die Residuen der Regression von <span class="math inline">\(Y\)</span> auf <span class="math inline">\(X_2\)</span> und von <span class="math inline">\(X_1\)</span> auf <span class="math inline">\(X_2\)</span> sind.</p>
<p>FWL ermöglicht daher eine Vereinfachung der Schätzung komplexer Modelle durch die Zerlegung der Schätzung in Teilschritte.</p>
<p>Für das Verständnis der Schätzung kausaler Effekte mit linearer Regression ist FWL hilfreich, denn es zeigt, wie sowohl die Variation in der Outcome-Variable (<span class="math inline">\(\widehat{u}_{Y,X_2}\)</span>) als auch die Variation in der Behandlungsvariable (<span class="math inline">\(\widehat{u}_{X_1,X_2}\)</span>), die jeweils <em>nicht</em> durch Kovariablen (<span class="math inline">\(X_2\)</span>) verursacht wird, mit multipler Regression isoliert werden kann, sodass Backdoors geschlossen werden.</p>
<p>Wir illustrieren dieses Konzept anhand einer multiplen Regression für die Schnabeltiefe (<code>body_mass</code>) von Pinguinen aus dem Datensatz <code><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">palmerpenguins::penguins</a></code>,</p>
<p><span class="math display">\[\begin{align}
  \textup{body\_mass} = \beta_0 + \beta_1\cdot\textup{bill\_length} + \beta_2\cdot \textup{flipper\_length} + \epsilon,\label{eq:billdepthmodel}
\end{align}\]</span> unter der Annahme, dass <span class="math inline">\(\beta_1\)</span> der interessierende Effekt ist: Die erwartete Änderung des Gewichts eines Pinguins (in Gramm) für eine Änderung der Schnabel-Länge um 1mm.</p>
<p>Vor der Schätzung von Modell <span class="math inline">\(\eqref{eq:billdepthmodel}\)</span> lesen wir den Datensatz ein und erstellen eine bereinigte Variante <code>penguins_cleaned</code>, analog zur Vorgehensweise in <a href="R_Einfuehrung.html#sec-pp" class="quarto-xref"><span>Kapitel 2.2</span></a>.</p>
<div class="cell">
<div>
<div id="webr-3">

</div>
<script type="webr-3-contents">
eyJjb2RlIjoibGlicmFyeShwYWxtZXJwZW5ndWlucylcbmRhdGEocGVuZ3VpbnMpXG5cbiMgRGF0ZW5zYXR6IGJlcmVpbmlnZW5cbnBlbmd1aW5zX2NsZWFuZWQgPC0gcGVuZ3VpbnMgJT4lIFxuICByZW5hbWUoXG4gICAgYmlsbF9kZXB0aCA9IGJpbGxfZGVwdGhfbW0sXG4gICAgYmlsbF9sZW5ndGggPSBiaWxsX2xlbmd0aF9tbSxcbiAgICBmbGlwcGVyX2xlbmd0aCA9IGZsaXBwZXJfbGVuZ3RoX21tLFxuICAgIGJvZHlfbWFzcyA9IGJvZHlfbWFzc19nXG4gICkgJT4lIFxuICBkcm9wX25hKCkgJT4lIFxuICBmaWx0ZXIoXG4gICAgYm9keV9tYXNzIDwgcXVhbnRpbGUoYm9keV9tYXNzLCAuOTUpXG4gIClcblxuIyDDnGJlcmJsaWNrXG5zbGljZV9oZWFkKHBlbmd1aW5zX2NsZWFuZWQsIG4gPSAxMCkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>Wir schätzen nun Modell <span class="math inline">\(\eqref{eq:billdepthmodel}\)</span> mit <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> und erhalten eine Zusammenfassung der geschätzen Koeffizienten mit <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy()</a></code>.</p>
<div class="cell">
<div>
<div id="webr-4">

</div>
<script type="webr-4-contents">
eyJjb2RlIjoibGlicmFyeShicm9vbSlcblxuIyBcIkdyb8OfZXNcIiBNb2RlbGwgc2Now6R0emVuXG5sbShcbiAgZm9ybXVsYSA9IGJvZHlfbWFzcyB+IGJpbGxfbGVuZ3RoICsgZmxpcHBlcl9sZW5ndGgsIFxuICBkYXRhID0gcGVuZ3VpbnNfY2xlYW5lZFxuKSAlPiVcbiAgdGlkeSgpIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<p>Das Ergebnis der Schätzung ist <span class="math inline">\(\widehat{\beta}_1\approx3.80\)</span>. Der nächste Code-Block berechnet die Residuen aus den Regressionen <span class="math display">\[\begin{align*}
  \textup{body\_mass} =&amp;\, \alpha_0 + \alpha_1 \textup{flipper\_length} + u_{\textup{body\_mass},\,\textup{flipper\_length}},\\
  \textup{bill\_length} =&amp;\, \delta_0 + \delta_1 \textup{flipper\_length} + u_{\textup{bill\_length},\,\textup{flipper\_length}},
\end{align*}\]</span></p>
<p>und speichert diese in <code>body_mass_res</code> und <code>bill_length_res</code>.</p>
<div class="cell">
<div>
<div id="webr-5">

</div>
<script type="webr-5-contents">
eyJjb2RlIjoiIyBGV0wtU2Nocml0dCAxIChhKVxucGVuZ19tb2RfZndsMWEgPC0gbG0oXG4gIGZvcm11bGEgPSBib2R5X21hc3MgfiBmbGlwcGVyX2xlbmd0aCwgXG4gIGRhdGEgPSBwZW5ndWluc19jbGVhbmVkXG4pXG5cbmJvZHlfbWFzc19yZXMgPC0gcmVzaWR1YWxzKHBlbmdfbW9kX2Z3bDFhKVxuXG4jIEZXTC1TY2hyaXR0IDEgKGIpXG5wZW5nX21vZF9md2wxYiA8LSBsbShcbiAgZm9ybXVsYSA9IGJpbGxfbGVuZ3RoIH4gZmxpcHBlcl9sZW5ndGgsIFxuICBkYXRhID0gcGVuZ3VpbnNfY2xlYW5lZFxuKVxuXG5iaWxsX2xlbmd0aF9yZXMgPC0gcmVzaWR1YWxzKHBlbmdfbW9kX2Z3bDFiKSIsImF0dHIiOnsiZXZhbCI6dHJ1ZSwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
<div class="cell">
<div>
<div id="webr-6">

</div>
<script type="webr-6-contents">
eyJjb2RlIjoiIyBGV0wtU2Nocml0dCAyXG5sbShmb3JtdWxhID0gYm9keV9tYXNzX3JlcyB+IGJpbGxfbGVuZ3RoX3JlcyAtIDEpICU+JSBcbiAgdGlkeSgpIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<p>Der geschätzte Koeffizient aus der Regression der Residuen stimmt mit dem geschätzten Koeffizienten von <code>bill_length</code> aus der großen Regression <span class="math inline">\(\eqref{eq:billdepthmodel}\)</span> überein.</p>
<p>Wir können den Effekt der Kontrolle für <code>flipper_length</code> visualisieren. Wir plotten hierzu:</p>
<ul>
<li><p>Die originalen Datenpunkte für <code>bill_length</code> und <code>body_mass</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> gemeinsam mit der geschätzten Regressionslinie für das Modell <span class="math display">\[ \textup{body\_mass} = \beta_0 + \beta_1\textup{bill\_length} + u \]</span> (keine Kontrolle für <code>flipper_length</code>!)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p></li>
<li><p>Die um <code>flipper_length</code> bereinigten Datenpunkte und die zugehörige geschätzte Regressionslinie.</p></li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Für eine bessere Lesbarkeit der Grafik zentrieren wir beide Variablen um den jeweiligen Stichprobenmittelwert.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;Der R-Befehl für diese Regression ist <code>lm(I(body_mass - mean(body_mass)) ~ I(bill_length - mean(bill_length)) - 1, data = penguins_cleaned)</code>.</p></div></div><div class="cell">
<div>
<div id="webr-7">

</div>
<script type="webr-7-contents">
eyJjb2RlIjoiIyBSZXNpZHVlbiBpbiB0aWJibGUgc2FtbWVsblxudGliYmxlKFxuICBib2R5X21hc3NfcmVzLCBcbiAgYmlsbF9sZW5ndGhfcmVzXG4pICU+JVxuICBcbiAgZ2dwbG90KCkgK1xuICAjIEJlcmVpbmlndGUgRGF0ZW5wdW5rdGUgcGxvdHRlblxuICBnZW9tX3BvaW50KFxuICAgIG1hcHBpbmcgPSBhZXMoXG4gICAgICB4ID0gYmlsbF9sZW5ndGhfcmVzLCBcbiAgICAgIHkgPSBib2R5X21hc3NfcmVzLFxuICAgICAgY29sb3IgPSBcIlVtIGZsaXBwZXJfbGVuZ3RoIGJlcmVpbmlndGUgRGF0ZW5cIlxuICAgIClcbiAgKSArXG4gICMgUmVncmVzc2lvbnNsaW5pZSBmw7xyIGJlcmVpbmlndGUgRGF0ZW5wdW5rdGVcbiAgZ2VvbV9zbW9vdGgoXG4gICAgbWFwcGluZyA9IGFlcyh4ID0gYmlsbF9sZW5ndGhfcmVzLCB5ID0gYm9keV9tYXNzX3JlcyksXG4gICAgbWV0aG9kID0gXCJsbVwiLCBcbiAgICBmb3JtdWxhID0gXCJ5IH4geCAtIDFcIixcbiAgICBzZSA9IEYsXG4gICAgY29sID0gXCJwdXJwbGVcIlxuICApICtcbiAgIyBVcnNwcsO8bmdsaWNoZSBEYXRlbnB1bmt0ZSBwbG90dGVuXG4gIGdlb21fcG9pbnQoXG4gICAgZGF0YSA9IHBlbmd1aW5zX2NsZWFuZWQsIFxuICAgIG1hcHBpbmcgPSBhZXMoXG4gICAgICB4ID0gYmlsbF9sZW5ndGggLSBtZWFuKGJpbGxfbGVuZ3RoKSwgXG4gICAgICB5ID0gYm9keV9tYXNzIC0gbWVhbihib2R5X21hc3MpLFxuICAgICAgY29sb3IgPSBcIlVyc3Byw7xuZ2xpY2hlIERhdGVucHVua3RlXCJcbiAgICApLFxuICAgIGFscGhhID0gLjUsXG4gICkgK1xuICAjIFJlZ3Jlc3Npb25zbGluaWUgZsO8ciB1cnNwcsO8bmdsaWNoZSBEYXRlbnB1bmt0ZVxuICBnZW9tX3Ntb290aChcbiAgICBkYXRhID0gcGVuZ3VpbnNfY2xlYW5lZCwgXG4gICAgbWFwcGluZyA9IGFlcyhcbiAgICAgIHggPSBiaWxsX2xlbmd0aCAtIG1lYW4oYmlsbF9sZW5ndGgpLCBcbiAgICAgIHkgPSBib2R5X21hc3MgLSBtZWFuKGJvZHlfbWFzcylcbiAgICApLFxuICAgIG1ldGhvZCA9IFwibG1cIiwgXG4gICAgZm9ybXVsYSA9IFwieSB+IHggLSAxXCIsXG4gICAgc2UgPSBGLFxuICAgIGNvbCA9IGFscGhhKFwiYmxhY2tcIiwgLjUpXG4gICkgK1xuICBzY2FsZV9jb2xvcl9tYW51YWwoXG4gICAgbmFtZSA9IFwiXCIsXG4gICAgdmFsdWVzID0gYyhcbiAgICAgIFwiVW0gZmxpcHBlcl9sZW5ndGggYmVyZWluaWd0ZSBEYXRlblwiID0gXCJwdXJwbGVcIixcbiAgICAgIFwiVXJzcHLDvG5nbGljaGUgRGF0ZW5wdW5rdGVcIiA9IFwiYmxhY2tcIlxuICAgIClcbiAgKSArXG4gIGxhYnMoXG4gICAgdGl0bGUgPSBcIlBlbmd1aW5zOiBBbndlbmR1bmcgdm9uIEZXTFwiLFxuICAgIHggPSBcImJpbGxfbGVuZ3RoXCIsXG4gICAgeSA9IFwiYm9keV9tYXNzXCJcbiAgKSArXG4gIHRoZW1lX2Nvd3Bsb3QoKSArXG4gIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9IFwidG9wXCIpIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<p>Der grafische Vergleich beider Vorgehensweisen zeigt den Effekt der Kontrolle für <code>flipper_length</code>: Die geschätzte (schwarze) Regressionslinie für die bereinigten Daten hat eine deutlich geringere Steigung als die anhand der ursprünglichen Daten geschätzte (lilane) Linie. Der Effekt von <code>bill_length</code> auf <code>body_mass</code> wird mit der einfachen Regression <code>lm(body_mass ~ bill_length)</code> vermutlich <em>überschätzt</em>, weil es andere Faktoren (wie <code>flipper_length</code> gibt, die mit <code>bill_length</code> und <code>body_mass</code> korrelieren. Kontrollieren für <code>flipper_length</code> in der multiplen Regression <code>lm(body_mass ~ bill_length + flipper_length)</code> schließt die Backdoor durch <code>flipper_length</code>. Die Konsequenz ist eine deutlich geringere Steigung der lilanen Regressionslinie.</p>
</section><section id="sec-bov" class="level2 page-columns page-full" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="sec-bov">
<span class="header-section-number">3.2</span> Binäre Outcome-Variable</h2>
<p>Eine binäre Variable, auch als dichotome Variable oder Indikator-Variable bezeichnet, ist eine Variable, die nur zwei Ausprägungen annehmen kann. Diese beiden Ausprägungen werden typischerweise durch die Werte 0 und 1 repräsentiert und dienen dazu, zwei verschiedene Zustände oder Kategorien zu unterscheiden. Formal kann eine binäre Variable <span class="math inline">\(B\)</span> wie folgt definiert werden:</p>
<p><span class="math display">\[\begin{align}
  B = \begin{cases}
  1, &amp; \text{Eigenschaft trifft zu,} \\
  0, &amp; \text{Eigenschaft trifft nicht zu.}
  \end{cases}
\end{align}\]</span></p>
<p>Eine in späteren Kapiteln dieses Companions als verwendeter <em>binärer Regressor</em> ist der Indikator für die Zuordnung von Beobachtungen in Behandlungs- oder Kontrollgruppe (1 = Behandlungsgruppe, 0 = Kontrollgruppe).</p>
<p>Für viele ökonomische Forschungsfragen ist es hilfreich, eine <em>binäre Outcome-Variable</em> mit Regression zu modellieren. Hierzu gibt es verschiedene Ansätze, die wir nachfolgend zusammenfassen und ihre Anwendung mit R zeigen.</p>
<section id="sec-lpm" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="sec-lpm">
<span class="header-section-number">3.2.1</span> Das lineare Wahrscheinlichkeitsmodell</h3>
<p>Das lineare Regressionsmodell</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1 X_{1} + \beta_2 X_{2} + \dots + \beta_k X_{k} + u\]</span> mit einer binären abhängigen Variablen <span class="math inline">\(Y_i\in\{0,1\}\)</span> wird als <em>lineares Wahrscheinlichkeitsmodell</em> bezeichnet. Wie üblich modellieren wir den Erwartungswert der abhängigen Variable gegeben der Regressoren <span class="math inline">\(X_1,\dots,X_k\)</span> als lineare Funktion,</p>
<p><span class="math display">\[E(Y\vert X_1,X_2,\dots,X_k) = P(Y=1\vert X_1, X_2,\dots, X_3).\]</span> Da <span class="math inline">\(Y\)</span> eine binäre Variable ist, gilt hier</p>
<p><span class="math display">\[ P(Y = 1 \vert X_1, X_2, \dots, X_k) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_k X_k.\]</span></p>
<p>Das lineare Wahrscheinlichkeitsmodell beschreibt also die <em>Wahrscheinlichkeit</em>, dass <span class="math inline">\(Y=1\)</span> als lineare Funktion der Regressoren: <span class="math inline">\(\beta_j\)</span> misst die Änderung in der Wahrscheinlichkeit für das Ereignis <span class="math inline">\(Y_i=1\)</span>, unter der Bedingung, dass die anderen <span class="math inline">\(k-1\)</span> Regressoren konstant gehalten werden. Genau wie bei multipler Regression mit einer kontinuierlichen abhängigen Variablen können die <span class="math inline">\(\beta_j\)</span> mit der KQ-Methode geschätzt werden.</p>
<p>Aufgrund der Beschränktheit der <span class="math inline">\(Y_i\)</span> auf <span class="math inline">\(\{0,1\}\)</span> sind die <span class="math inline">\(u_i\)</span> heteroskedastisch. Folglich sollten Inferenzstatistiken mit robusten Standardfehlern berechnet werden. Weiterhin ist zu beachten, dass <span class="math inline">\(R^2\)</span> in den meisten Anwendungen von linearen Wahrscheinlichkeitsmodellen keine hilfreiche Interpretation hat, da das geschätzte Modell die Daten nicht perfekt erklären kann, wenn die abhängige Variable binär, aber die Regressoren kontinuierlich verteilt sind.</p>
<p>Das lineare Wahrscheinlichkeitsmodell hat einen wesentlichen Nachteil: Das Modell nimmt an, dass die bedingte Wahrscheinlichkeitsfunktion linear ist und <span class="math inline">\(P(Y=1\vert X_1,\dots,X_k)\)</span> nicht auf das für Wahrscheinlichkeiten definierte Intervall <span class="math inline">\([0,1]\)</span> beschränkt ist. Ein angepasstes Modell hat dann für Regressorwerte, die zu Vorhersagen von <span class="math inline">\(Y\)</span> jenseits von <span class="math inline">\([0,1]\)</span> führen keine sinnvolle Interpretation.</p>
<p>Dieser Umstand verlangt nach Regressionsansätzen, die <span class="math inline">\(P(Y=1)\)</span> durch eine auf <span class="math inline">\([0,1]\)</span> beschränkte (nicht-lineare) Funktion der Regressoren modellieren. Häufig verwendete Methoden sind Probit- und Logit-Regression.</p>
<p>Ein lineares Wahrscheinlichkeitsmodell kann mit <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> geschätzt werden, wobei die abhängige Variable den Typ <code>numeric</code> oder <code>integer</code> haben muss.</p>
</section><section id="sec-probitreg" class="level3 page-columns page-full" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="sec-probitreg">
<span class="header-section-number">3.2.2</span> Probit-Regression</h3>
<p>Bei der Probit-Regression wird die Standardnormalverteilungsfunktion <span class="math inline">\(\Phi(\cdot)\)</span> verwendet, um die Regressionsfunktion einer binären abhängigen Variable zu modellieren. Wir nehmen an, dass <span class="math display">\[\begin{align}
  E(Y\vert X) = P(Y=1\vert X) = \Phi(\beta_0 + \beta_1 X), \label{eq:probitmodel}
\end{align}\]</span> sodass der mit der Verknüfungsfunktion (Link) <span class="math display">\[\textup{probit}(\cdot) = \Phi^{-1}(\cdot)\]</span> transformierte Erwartungswert <span class="math inline">\(P(Y=1\vert X)\)</span> dem linearen Prädiktor <span class="math inline">\(z=\beta_0 + \beta_1 X\)</span> entspricht, <span class="math display">\[\begin{align*}
  \Phi^{-1}\big[P(Y=1\vert X)\big] = \beta_0 + \beta_1 X.
\end{align*}\]</span></p>
<p><span class="math inline">\(z=\beta_0 + \beta_1 X\)</span> in <span class="math inline">\(\eqref{eq:probitmodel}\)</span> modelliert hier also ein <em>Quantil</em> der Standardnormalverteilung, <span class="math display">\[\begin{align*}
\Phi(z) = P(Z \leq z) \ , \ Z \sim \mathcal{N}(0,1).
\end{align*}\]</span> Der Koeffizient <span class="math inline">\(\beta_1\)</span> in <span class="math inline">\(\eqref{eq:probitmodel}\)</span> misst die Änderung in <span class="math inline">\(z\)</span>, die mit einer Änderung von <span class="math inline">\(X\)</span> um eine Einheit verbunden ist. Obwohl der Effekt einer Änderung in <span class="math inline">\(X\)</span> auf <span class="math inline">\(z\)</span> linear ist, ist der Zusammenhang zwischen <span class="math inline">\(z\)</span> und <span class="math inline">\(\textup{E}(Y\vert X) = P(Y=1\vert X)\)</span> <em>nicht linear</em>, denn <span class="math inline">\(\Phi(\cdot)\)</span> ist eine nicht-lineare Funktion von <span class="math inline">\(X\)</span>.</p>
<div class="cell">
<div>
<div id="webr-8">

</div>
<script type="webr-8-contents">
eyJjb2RlIjoiIyBOKDAsMSktUXVhbnRpbHNmdW5rdGlvbiAvIFByb2JpdC1MaW5rXG5nZ3Bsb3QoKSArXG4gIGdlb21fZnVuY3Rpb24oZnVuID0gcW5vcm0pICtcbiAgc2NhbGVfeF9jb250aW51b3VzKFxuICAgIG5hbWUgPSBcInpcIiwgXG4gICAgbGltaXRzID0gYygwLCAxKVxuICApICtcbiAgc2NhbGVfeV9jb250aW51b3VzKG5hbWUgPSBcIlF1YW50aWxcIikgK1xuICBsYWJzKHRpdGxlID0gXCJQcm9iaXQtRnVua3Rpb25cIikgK1xuICB0aGVtZV9jb3dwbG90KCkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>Aufgrund der Nicht-Linearität der Link-Funktion hat der Koeffizient von <span class="math inline">\(X\)</span> keine einfache Interpretation hinsichtlich des Effekts auf <span class="math inline">\(P(Y=1\vert X)\)</span>. Die Änderung in der Wahrscheinlichkeit, dass <span class="math inline">\(Y=1\)</span> ist, durch eine Änderung in <span class="math inline">\(X\)</span> (partieller Effekt von <span class="math inline">\(X\)</span>) kann berechnet werden als:</p>
<p><span class="math display">\[\begin{align*}
  \frac{\partial\textup{E}(Y\vert X)}{\partial X} = \frac{\partial\textup{P}(Y=1\vert X)}{\partial X} = \frac{\partial\Phi(\beta_0 + \beta_1 X)}{\partial X} = \phi(\beta_0 + \beta_1 X) \beta_1,
\end{align*}\]</span> wobei <span class="math inline">\(\phi(\cdot)\)</span> die Dichtefunktion der Standardnormalverteilung ist. In empirischen Anwendungen wird der partielle Effekt häufig als Differenz in geschätzten Wahrscheinlichkeiten angegeben:</p>
<ol type="1">
<li>Berechne die geschätzte Wahrscheinlichkeit, dass <span class="math inline">\(Y=1\)</span> für einen Bezugswert <span class="math inline">\(X\)</span>.</li>
<li>Berechne die geschätzte Wahrscheinlichkeit, dass <span class="math inline">\(Y=1\)</span> für <span class="math inline">\(X + \Delta X\)</span>.</li>
<li>Berechne die Differenz zwischen der geschätzten Wahrscheinlichkeiten.</li>
</ol>
<p>Wie im linearen Wahrscheinlichkeitsmodell kann das Modell <span class="math inline">\(\eqref{eq:probitmodel}\)</span> auf eine Probit-Regression mit <span class="math inline">\(k+1\)</span> Regressoren <span class="math inline">\(\boldsymbol{X} := (1, X_1, \dots, X_k)\)</span> verallgemeinert werden, um das Risiko einer Verzerrung durch ausgelassene Variablen zu mindern. Die Schritte 1 bis 3 für die Berechnung des partiellen Effekts einer Änderung in <span class="math inline">\(X_j\)</span> erfolgen dann unter der Annahme, dass die übrigen <span class="math inline">\(k-1\)</span> Regressoren konstant gehalten werden, wobei der partielle Effekt von den jeweiligen Regressorwerten abhängt. Im nächsten Abschnitt erläutern wir die Schätzung von Probit-Modellen mit <span class="math inline">\(k+1\)</span> Regressoren.</p>
<section id="schätzung" class="level4 page-columns page-full" data-number="3.2.2.1"><h4 data-number="3.2.2.1" class="anchored" data-anchor-id="schätzung">
<span class="header-section-number">3.2.2.1</span> Schätzung</h4>
<p>Die Likelihood-Funktion für Probit-Regression ist</p>
<p><span class="math display">\[\begin{align*}
  L(\boldsymbol{\beta}) = \prod_{i=1}^n \Phi(\mathbf{X}_i^\top \boldsymbol{\beta})^{y_i} \left[1 - \Phi(\mathbf{X}_i^\top \boldsymbol{\beta})\right]^{1-y_i}
\end{align*}\]</span></p>
<p>Hierbei ist <span class="math inline">\(\Phi(\mathbf{X}_i^\top \boldsymbol{\beta})\)</span> die Wahrscheinlichkeit, dass <span class="math inline">\(Y_i = 1\)</span> ist und <span class="math inline">\(1 - \Phi(\mathbf{X}_i^\top \boldsymbol{\beta})\)</span> ist die Wahrscheinlichkeit, dass <span class="math inline">\(Y_i = 0\)</span> ist.</p>
<p>Die Log-Likelihood-Funktion ergibt sich als</p>
<p><span class="math display">\[\begin{align*}
  \mathcal{L}(\boldsymbol{\beta}) = \sum_{i=1}^n \left[ y_i \log \Phi(\mathbf{X}_i^\top \boldsymbol{\beta}) + (1 - y_i) \log \left(1 - \Phi(\mathbf{X}_i^\top \boldsymbol{\beta})\right) \right]
\end{align*}\]</span></p>
<p>Um den Maximum-Likelihood-Schätzer <span class="math inline">\(\widehat{\boldsymbol{\beta}}\)</span> zu finden, muss die Log-Likelihood-Funktion <span class="math inline">\(\mathcal{L}(\boldsymbol{\beta})\)</span> maximiert werden. In der Praxis erfolgt dies häufig durch numerische Optimierung, da die Log-Likelihood-Funktion der Probit-Regression im Allgemeinen keine geschlossene Form hat damit eine analytische Lösung nicht möglich ist.</p>
<p>Für eine Anwendung in R und einen Vergleich mit dem linearen Wahrscheinlichkeitsmodell erzeugen wir einen Beispieldatensatz <code>simdata</code> für einen datenerzeugenden Prozess (DGP)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> mit einem normalverteilten Regressor <span class="math inline">\(X\sim N(5,2^2)\)</span> und <span class="math display">\[\begin{align*}
  P(Y=1\vert X) = \Phi(z), \quad z = -4 + 0.7 X.
\end{align*}\]</span></p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Siehe <a href="Simulation.html" class="quarto-xref"><span>Kapitel 4</span></a> für Erläuterungen von Simulationsmethoden in R.</p></div></div><div class="cell">
<div>
<div id="webr-9">

</div>
<script type="webr-9-contents">
eyJjb2RlIjoiIyBEYXRlbiBzaW11bGllcmVuXG5zZXQuc2VlZCgxMjM0KVxuXG4jIFN0aWNocHJvYmVuZ3LDtsOfZVxubiA8LSA1MDAgXG5cbnNpbWRhdGEgPC0gdGliYmxlKFxuICBYID0gcm5vcm0obiA9IG4sIG1lYW4gPSA1LCBzZCA9IDIpLCAjIFJlZ3Jlc3NvclxuICBQID0gcG5vcm0oLTQgKyAwLjcgKiBYKSxcbilcblxuIyBCaW7DpHJlIE91dGNvbWUtVmFyaWFibGUgaGluenVmw7xnZW5cbnNpbWRhdGEgPC0gc2ltZGF0YSAlPiVcbiAgbXV0YXRlKFxuICAgIFkgPSBhcy5pbnRlZ2VyKHJ1bmlmKG4pIDwgUClcbiAgKVxuXG4jIMOcYmVyYmxpY2tcbnNsaWNlX2hlYWQoc2ltZGF0YSwgbiA9IDEwKSIsImF0dHIiOnsiZXZhbCI6dHJ1ZSwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
<p>Das lineare Wahrscheinlichkeitsmodell schätzen wir wie gewohnt mit <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> und berechnen robuste Standardfehler mit <code><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">lmtest::coeftest()</a></code>.</p>
<div class="cell">
<div>
<div id="webr-10">

</div>
<script type="webr-10-contents">
eyJjb2RlIjoiIyBsaW5lYXJlcyBXYWhyc2NoZWlubGljaGtlaXRzbW9kZWxsIHNjaMOkdHplblxubW9kX2xwIDwtIGxtKFxuICBmb3JtdWxhID0gWSB+IFgsIFxuICBkYXRhID0gc2ltZGF0YVxuKVxuXG4jIFp1c2FtbWVuZmFzc3VuZ1xubW9kX2xwICU+JSBcbiAgY29lZnRlc3QodmNvdiA9IHZjb3ZIQywgdHlwZSA9IFwiSEMxXCIpICU+JVxuICB0aWR5KCkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>Beachte, dass lediglich die Vorzeichen der geschätzten Koeffizienten mit denen der wahren Werten übereinstimmmen. Da das lineare Modell fehlspezifiziert ist, sind die KQ-Schätzer der Koeffizienten hier inkonsistent.</p>
<p>Ein Probit-Modell kann mit <code><a href="https://rdrr.io/r/stats/glm.html">stats::glm()</a></code> geschätzt werden. Hierbei ist <code>formula</code> die Formel für den linearen Prädiktor <span class="math inline">\(z\)</span> und <code>family</code> eine Link-Funktion für den Zusammenhang von <span class="math inline">\(z\)</span> und <span class="math inline">\(P(Y\vert X)\)</span>. Mit <code>family = binomial(link = "probit")</code> wählen wir die Link-Funktion <code>probit</code>.</p>
<div class="cell">
<div>
<div id="webr-11">

</div>
<script type="webr-11-contents">
eyJjb2RlIjoiIyBQcm9iaXQtTW9kZWxsIHNjaMOkdHplblxubW9kX3Byb2JpdCA8LSBnbG0oXG4gIGZvcm11bGEgPSBZIH4gWCxcbiAgZGF0YSA9IHNpbWRhdGEsIFxuICBmYW1pbHkgPSBiaW5vbWlhbChsaW5rID0gXCJwcm9iaXRcIilcbilcblxuIyBadXNhbW1lbmZhc3N1bmdcbm1vZF9wcm9iaXQgJT4lXG4gIGNvZWZ0ZXN0KHZjb3YgPSB2Y292SEMsIHR5cGUgPSBcIkhDMVwiKSAlPiVcbiAgdGlkeSgpIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<p>Die geschätzten Koeffizienten in der Probit-Regression liegen, wie erwartet, nahe bei Parametern des DGPs.</p>
<p>Um beide Schätzungen gemeinsam zu plotten, erzeugen wir mit <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> Vorhersagen für eine Menge von Werten <code>X</code> im Intervall <span class="math inline">\([0,11]\)</span>. Beachte, dass bei Vorhersagen für das Probit-Modell die gewünschte Transformation der vorherzusagenden Variable über <code>type</code> gewählt werden muss.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Der Standardfall ist <code>type = "link"</code>, d.h. wir erhalten Vorhersagen für den linearen Prädiktor: <span class="math inline">\(\widehat{z} = \widehat\beta_0 + \widehat{\beta}_1X\)</span>. Mit <code>type = "response"</code> werden diese Werte mit der Link-Funktion, hier <span class="math inline">\(\Phi(\cdot)\)</span> zu vorhergesagten Wahrscheinlichkeiten <span class="math inline">\(\widehat{P}(Y=1\vert X = x)\)</span> transformiert.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;Dies gilt für jedes Modell mit einer anderen Link-Funktion als <span class="math inline">\(f(x) = x\)</span> ist (lineare Regression).</p></div></div><div class="cell">
<div>
<div id="webr-12">

</div>
<script type="webr-12-contents">
eyJjb2RlIjoiIyBnZXNjaMOkdHp0ZSBXYWhyc2NoZWlubGljaGtlaXRzZnVua3Rpb25cbiMgZsO8ciBsaW5lYXJlcyBNb2RlbGxcblggPC0gc2VxKDAsIDExLCAwLjAxKVxuXG5wcmVkIDwtIHRpYmJsZShcbiAgWCA9IFgsIFxuICBMUCA9IHByZWRpY3QoXG4gICAgb2JqZWN0ID0gbW9kX2xwLCBcbiAgICBuZXdkYXRhID0gdGliYmxlKFgpXG4gICksXG4gIHByb2JpdCA9IHByZWRpY3QoXG4gICAgb2JqZWN0ID0gbW9kX3Byb2JpdCxcbiAgICBuZXdkYXRhID0gdGliYmxlKFgpLFxuICAgIHR5cGUgPSBcInJlc3BvbnNlXCJcbiAgKVxuKVxuXG4jIMOcYmVyYmxpY2sgdmVyc2NoYWZmZW5cbnNsaWNlX2hlYWQocHJlZCwgbiA9IDEwKSIsImF0dHIiOnsiZXZhbCI6dHJ1ZSwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
<p>Der nachfolgende Code-Chunk erstellt einen Punkte-Plot mit Jitter-Effekt (<code>position_jitter</code>), wobei die Beobachtungen zufällig leicht vertikal verschoben werden, um Überlappungen zu vermeiden. Zusätzlich zeichnen wir die geschätzten Regressionslinien für <code>mod_lp</code> (LPM) und <code>mod_probit</code> (Probit) sowie die tatsächliche Wahrscheinlichkeitsfunktion <span class="math inline">\(P(Y=1\vert X)\)</span> ein.</p>
<div class="cell">
<div>
<div id="webr-13">

</div>
<script type="webr-13-contents">
eyJjb2RlIjoiIyBEYXRlbiB1bmQgZ2VzY2jDpHR6dGUgTW9kZWxsZSBwbG90dGVuXG5wIDwtIHNpbWRhdGEgJT4lXG4gIGdncGxvdChtYXBwaW5nID0gYWVzKHggPSBYLCB5ID0gWSkpICtcbiAgZ2VvbV9wb2ludChcbiAgICBwb3NpdGlvbiA9IHBvc2l0aW9uX2ppdHRlcihcbiAgICAgIGhlaWdodCA9IC4wMjUsXG4gICAgICBzZWVkID0gMTIzNFxuICAgICksXG4gICAgYWxwaGEgPSAuMjUsXG4gICAgY29sb3IgPSBcImdyYXlcIlxuICApICtcbiAgZ2VvbV9saW5lKFxuICAgIGRhdGEgPSBwcmVkLCBcbiAgICBtYXBwaW5nID0gYWVzKHkgPSBMUCwgY29sb3IgPSBcIkxQTVwiKSxcbiAgICBsd2QgPSAuNzVcbiAgKSArXG4gIGdlb21fbGluZShcbiAgICBkYXRhID0gcHJlZCwgXG4gICAgbWFwcGluZyA9IGFlcyh5ID0gcHJvYml0LCBjb2xvciA9IFwiUHJvYml0XCIpLFxuICAgIGx3ZCA9IC43NVxuICApICtcbiAgZ2VvbV9mdW5jdGlvbihcbiAgICBmdW4gPSBcXCh4KSBwbm9ybSgtNCArIC43ICogeCksIFxuICAgIG1hcHBpbmcgPSBhZXMoY29sb3IgPSBcIldhaHJoZWl0XCIpXG4gICkgK1xuICBzY2FsZV9jb2xvcl9tYW51YWwoXG4gICAgbmFtZSA9IFwiXCIsXG4gICAgdmFsdWVzID0gYyhcbiAgICAgIFwiV2FocmhlaXRcIiA9IFwiYmxhY2tcIixcbiAgICAgIFwiTFBNXCIgPSBcInN0ZWVsYmx1ZVwiLCBcbiAgICAgIFwiUHJvYml0XCIgPSBcIm9yYW5nZVwiXG4gICAgKVxuICApICtcbiAgbGFicyh0aXRsZSA9IFwiR2VzY2guIE1vZGVsbGUgZsO8ciBiaW7DpHJlIGFiaMOkbmdpZ2UgVmFyaWFibGVcIikgK1xuICB0aGVtZV9jb3dwbG90KCkgK1xuICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSBcInRvcFwiKVxuXG5wIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<p>Die Grafik zeigt, dass beide Modelle den positiven Zusammenhang für <span class="math inline">\(X\)</span> und <span class="math inline">\(P(Y=1\vert X)\)</span> erfassen. Das lineare Wahrscheinlichkeitsmodell approximiert die tatsächliche nicht-lineare Wahrscheinlichkeitsfunktion nur schlecht und liefert insbesondere in den Rändern der Verteilung von <span class="math inline">\(X\)</span> (kleine und große Werte) unzulässige Vorhersagen außerhalb des Intervalls <span class="math inline">\([0,1]\)</span>. Die Probit-Spezifikation hingegen erfasst den nicht-linearen Verlauf der tatsächlichen Wahrscheinlichkeitsfunktion gut.</p>
</section></section><section id="sec-logreg" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="sec-logreg">
<span class="header-section-number">3.2.3</span> Logistische Regression</h3>
<p>Bei logistischer Regression wird die logistische Funktion <span class="math inline">\(\Lambda(\cdot)\)</span> <span class="math display">\[\begin{align}
\Lambda(z) = \frac{1}{1 + \exp(-z)},
\end{align}\]</span> als Link-Funktion genutzt, um die Wahrscheinlichkeitsfunktion von <span class="math inline">\(Y\)</span> gegeben <span class="math inline">\(X\)</span> zu modellieren. Ähnlich wie im Probit-Modell nehmen wir hier an, dass <span class="math display">\[\begin{align}
E(Y\vert X) = P(Y=1\vert X) = \Lambda(\beta_0 + \beta_1 X). \label{eq:logitmodel}
\end{align}\]</span> In diesem Modell ist die Link-Funktion <span class="math inline">\(\Lambda^{-1}(\cdot)\)</span>. Für <span class="math inline">\(z=\beta_0 + \beta_1 X\)</span> ist <span class="math inline">\(\Lambda^{-1}(t)\)</span> der sogenannte <em>logit</em>: Dass logarithmierte Verhältnis von <span class="math inline">\(p := P(Y=1\vert X)\)</span> und <span class="math inline">\(1 - p = P(Y=0\vert X)\)</span>, <span class="math display">\[\begin{align*}
  \textup{logit(p)} = \log\bigg(\frac{p}{1-p}\bigg) = \beta_0 + \beta_1 X.
\end{align*}\]</span> Der Koeffizient <span class="math inline">\(\beta_1\)</span> misst also die Veränderung des Logits pro Einheit Änderung im Regressor <span class="math inline">\(X\)</span>.</p>
<p>Ähnlich wie bei Probit-Regression ist der Einfluss von <span class="math inline">\(X\)</span> auf den Logit linear, jedoch besteht auch hier eine nicht-lineare Beziehung zwischen dem linearen Prädiktor und der Wahrscheinlichkeit <span class="math inline">\(P(Y=1\vert X)\)</span>, denn <span class="math inline">\(\Lambda(\cdot)\)</span> ist eine nicht-lineare Funktion mit dem Wertebereich <span class="math inline">\([0,1]\)</span>.</p>
<div class="cell">
<div>
<div id="webr-14">

</div>
<script type="webr-14-contents">
eyJjb2RlIjoiIyBQbG90OiBMb2dpc3Rpc2NoZSBGdW5rdGlvblxuZ2dwbG90KCkgK1xuICBzdGF0X2Z1bmN0aW9uKFxuICAgIGZ1biA9IFxcKHgpIDEgLyAoMSArIGV4cCgteCkpXG4gICAgKSArXG4gIHNjYWxlX3hfY29udGludW91cyhcbiAgICBuYW1lID0gXCJ6XCIsIFxuICAgIGxpbWl0cyA9IGMoLTQsIDQpXG4gICkgK1xuICBzY2FsZV95X2NvbnRpbnVvdXMobmFtZSA9IFwiTGFtYmRhKHopXCIpICtcbiAgbGFicyh0aXRsZSA9IFwiTG9naXN0aXNjaGUgRnVua3Rpb25cIikgK1xuICB0aGVtZV9jb3dwbG90KCkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<div class="cell">
<div>
<div id="webr-15">

</div>
<script type="webr-15-contents">
eyJjb2RlIjoiIyBQbG90OiBMb2dpdFxuZ2dwbG90KCkgK1xuICBzdGF0X2Z1bmN0aW9uKFxuICAgIGZ1biA9IFxcKHgpIGxvZyh4IC8gKDEgLSB4KSlcbiAgICApICtcbiAgc2NhbGVfeF9jb250aW51b3VzKFxuICAgIG5hbWUgPSBcInBcIiwgXG4gICAgbGltaXRzID0gYygwLCAxKVxuICApICtcbiAgc2NhbGVfeV9jb250aW51b3VzKG5hbWUgPSBcIkxvZ2l0KHApXCIpICtcbiAgbGFicyh0aXRsZSA9IFwiTG9naXQtRnVua3Rpb25cIikgK1xuICB0aGVtZV9jb3dwbG90KCkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>Die nachstehende interaktive Grafik zeigt, wie die Wahscheinlichkeitsfunktion der latenten Variable <span class="math inline">\(z=\beta_0 + \beta_1 X\)</span> von den Parametern <span class="math inline">\(\beta_0\)</span> und <span class="math inline">\(\beta_1\)</span> jeweils für Logit- und Probit-Regression beeinflusst wird.</p>
<iframe class="obs-soft-box-shadow" width="100%" height="700" frameborder="0" src="https://observablehq.com/embed/@mca91/latent-variable-cdf?cells=plot%2Cviewof+beta0%2Cviewof+beta%2CMathJax">
</iframe>
<p>Aufgrund der Nicht-Linearität von <span class="math inline">\(\Lambda(z)\)</span> kann der Koeffizient <span class="math inline">\(\beta_1\)</span> wie im Probit-Modell nicht direkt als Effekt auf die Wahrscheinlichkeit <span class="math inline">\(P(Y=1\vert X)\)</span> interpretiert werden.</p>
<p>Um den partiellen Effekt einer Änderung in <span class="math inline">\(X\)</span> am Punkt <span class="math inline">\(X\)</span> auf <span class="math inline">\(P(Y=1\vert X)\)</span> zu ermitteln, berechnen wir die Ableitung des bedingten Erwartungswerts:</p>
<p><span class="math display">\[\begin{align*}
\frac{\partial\textup{E}(Y\vert X)}{\partial X} = \frac{\partial\textup{P}(Y=1\vert X)}{\partial X} = \frac{\partial\Lambda(\beta_0 + \beta_1 X)}{\partial X} = \lambda(\beta_0 + \beta_1 X) \beta_1,
\end{align*}\]</span> wobei <span class="math inline">\(\lambda(\cdot)\)</span>, ähnlich wie die Dichtefunktion der Normalverteilung im Probit-Modell, die Dichtefunktion der logistischen Verteilung darstellt. Diese ist gegeben durch <span class="math display">\[\begin{align*}
\lambda(z) = \Lambda(z) \cdot (1 - \Lambda(z)).
\end{align*}\]</span></p>
<p>Die Interpretation des angepassten Modells ist aufgrund der Modellierung des Logits intuitiver als für Probit-Regression. Angenommen eine Bank möchte die Wahrscheinlichkeit modellieren, dass ein Kunde einen Kredit nicht zurückzahlt: <span class="math inline">\(P(Y=\textup{Zahlungsausfall}\vert X)\)</span>, wobei der Regressor <span class="math inline">\(X\)</span> das Verhältnis von aktuellem Schuldenstand und Monatseinkommen ist. Die Schätzung einer logistischen Regression ergibt, dass ein Anstieg von <span class="math inline">\(X =x\)</span> um 0.1 den Logit für die Wahrscheinlichkeit eines Kreditausfalls <span class="math inline">\(p(x)\)</span> um 0.4 erhöht: <span class="math display">\[\begin{align*}
  \textup{logit} \big[P(Y=\textup{Zahlungsausfall}\vert X = x + 0.1)\big] = \textup{logit}[p(x)] + 0.4.
\end{align*}\]</span></p>
<p>Das Modell besagt dann, dass die Wahrscheinlichkeit der Zahlungsunfähigkeit etwa um den <em>Faktor</em> 1.5 ansteigt, denn <span class="math display">\[\begin{align*}
  \exp\big(\textup{logit}[p(x)] + 0.4\big) = \frac{p(x)}{1-p(x)} \cdot \exp(0.4)
\end{align*}\]</span> mit <span class="math display">\[\begin{align*}
  \exp(0.4) \approx 1.50.
\end{align*}\]</span></p>
</section><section id="schätzung-1" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="schätzung-1">
<span class="header-section-number">3.2.4</span> Schätzung</h3>
<p>Ähnlich wie bei Probit-Regressionen können Logit-Modelle mit Maximum-Likelihood geschätzt werden. Die Likelihood-Funktion für Logit-Regression lautet</p>
<p><span class="math display">\[\begin{align}
  L(\boldsymbol{\beta}) &amp;= \prod_{i=1}^n \left(\frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}\right)^{y_i} \left(1 - \frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}\right)^{1-y_i},
\end{align}\]</span></p>
<p>mit <span class="math display">\[\frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}\]</span> der Wahrscheinlichkeit, dass <span class="math inline">\(Y_i = 1\)</span>. Für das Ereignis <span class="math inline">\(Y_i = 0\)</span> ist die Wahrscheinlichkeit entsprechend <span class="math display">\[1 - \frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}.\]</span></p>
<p>Die Log-Likelihood-Funktion lautet</p>
<p><span class="math display">\[\begin{align*}
  \mathcal{L}(\boldsymbol{\beta}) &amp;= \sum_{i=1}^n \left[ y_i \log \left(\frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}\right) + (1 - y_i) \log \left(1 - \frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}\right) \right]
\end{align*}\]</span></p>
<p>und erlaubt die Schätzung von <span class="math inline">\(\boldsymbol{\beta}\)</span> durch Maximierung mit numerischen Methoden.</p>
<p>Für Anwendungen mit R nutzen wir <code><a href="https://rdrr.io/r/stats/glm.html">stats::glm()</a></code> und wählen die logistische Link-Funktion mit <code>family = binomial(link = "logit")</code>. Für die simulierten Daten <code>simdata</code> aus <a href="#sec-probitreg" class="quarto-xref"><span>Kapitel 3.2.2</span></a>:</p>
<div class="cell">
<div>
<div id="webr-16">

</div>
<script type="webr-16-contents">
eyJjb2RlIjoiIyBMb2dpdC1Nb2RlbGwgc2Now6R0emVuXG5tb2RfbG9naXQgPC0gZ2xtKFxuICBmb3JtdWxhID0gWSB+IFgsXG4gIGRhdGEgPSBzaW1kYXRhLCBcbiAgZmFtaWx5ID0gYmlub21pYWwobGluayA9IFwibG9naXRcIilcbilcblxuIyBSb2J1c3RlIFp1c2FtbWVuZmFzc3VuZ1xubW9kX2xvZ2l0ICU+JVxuICBjb2VmdGVzdCh2Y292ID0gdmNvdkhDLCB0eXBlID0gXCJIQzFcIilcbiAgdGlkeSgpIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<p>Wir erweitern nun <code>pred</code> um die anhand von <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> für <code>mod_logit</code> geschätzten Wahrscheinlichkeiten von <span class="math inline">\(Y=1\vert X\)</span> für die Regressorwerte in <code>X</code>.</p>
<div class="cell">
<div>
<div id="webr-17">

</div>
<script type="webr-17-contents">
eyJjb2RlIjoiIyBnZXNjaC4gV1NLLUZ1bmt0aW9uIGdlbS4gTG9naXQtTW9kZWxsIGhpbnp1ZsO8Z2VuXG5wcmVkIDwtIHByZWQgJT4lXG4gIG11dGF0ZShcbiAgICBMb2dpdCA9IHByZWRpY3QobW9kX2xvZ2l0LCB0aWJibGUoWCksIHR5cGUgPSBcInJlc3BvbnNlXCIpXG4gICkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>Anhand der Vorhersagen in <code>pred</code> können wir die im Objekt <code>p</code> gespeicherte Grafik um die geschätzte Regressionsfunktion für das Logit-Modell erweitern.</p>
<div class="cell">
<div>
<div id="webr-18">

</div>
<script type="webr-18-contents">
eyJjb2RlIjoiIyBHcmFmaWsgbWl0IExvZ2l0LWZpdCBlcndlaXRlcm5cbnAgKyBcbiAgZ2VvbV9saW5lKFxuICAgIGRhdGEgPSBwcmVkLCBcbiAgICBtYXBwaW5nID0gYWVzKHkgPSBMb2dpdCwgY29sb3IgPSBcIkxvZ2l0XCIpLFxuICAgIGx3ZCA9IC43NVxuICApICtcbiAgICBzY2FsZV9jb2xvcl9tYW51YWwoXG4gICAgbmFtZSA9IFwiXCIsXG4gICAgdmFsdWVzID0gYyhcbiAgICAgIFwiV2FocmhlaXRcIiA9IFwiYmxhY2tcIixcbiAgICAgIFwiTFBNXCIgPSBcInN0ZWVsYmx1ZVwiLCBcbiAgICAgIFwiUHJvYml0XCIgPSBcIm9yYW5nZVwiLFxuICAgICAgXCJMb2dpdFwiID0gXCJkYXJrcmVkXCJcbiAgICApXG4gICkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>Die Logit-Regression kann den wahren Zusammenhang gut abbilden und ist praktisch nicht von der Probit-Schätzung unterscheidbar.</p>
</section><section id="modellgüte" class="level3 page-columns page-full" data-number="3.2.5"><h3 data-number="3.2.5" class="anchored" data-anchor-id="modellgüte">
<span class="header-section-number">3.2.5</span> Modellgüte</h3>
<p>Ähnlich wie bei linearer Regression kann die Anpassung von generalisierten linearen Modellen an die Daten mit Anpassungsmaßen verglichen werden. In generalisierten linearen Modellen für binäre Outcome-Variablen kann hierzu die <em>Deviance</em> verwendet werden. Für eine Schätzung anhand der Beobachtungen <span class="math inline">\(i=1,\dots,n\)</span> berechnet man die Deviance <span class="math inline">\(D\)</span> als <span class="math display">\[\begin{align*}
  D = -2 \sum_{i=1}^{n} \left[ y_i \cdot \log\left(\widehat{P}_i\right) + (1 - y_i) \cdot \log\left(1 - \widehat{P}_i\right) \right].
\end{align*}\]</span> <span class="math inline">\(D\)</span> quantifiziert die Abweichung eines geschätzten Modells von einem perfekt passenden Modell.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Eine geringere Deviance deutet darauf hin, dass das Modell die Daten besser erklärt. Eine R-Funktion zur Anwendung für Objekte des Typs <code>glm</code> ist <code><a href="https://rdrr.io/r/stats/deviance.html">deviance()</a></code>.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Im Allgemeinen vergleicht Deviance die Log-Likelihood des geschätzten Modells mit der Log-Likelihood des perfekten Modells.</p></div></div><div class="cell">
<div>
<div id="webr-19">

</div>
<script type="webr-19-contents">
eyJjb2RlIjoiIyBEZXZpYW5jZSBiZXJlY2huZW5cbmxpc3QoXG4gIFwiUHJvYml0XCIgPSBtb2RfcHJvYml0LCBcbiAgXCJMb2dpdFwiID0gbW9kX2xvZ2l0XG4pICU+JSBcbiAgbWFwX2RibCguZiA9IGRldmlhbmNlKSIsImF0dHIiOnsiZXZhbCI6dHJ1ZSwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
<p>Die Deviance für das Probit-Modell ist tatsächlich etwas geringer als für das Logit-Modell.</p>
<p>Ähnlich wie <span class="math inline">\(R^2\)</span> für lineare Regression misst die Deviance <span class="math inline">\(D\)</span> lediglich die Anpassung des Modells an die beobachteten Daten. Daher eignet sich <span class="math inline">\(D\)</span> nur bedingt als Maß zur Einschätzung der Tauglichkeit eines Modells für Out-of-sample-Vorhersagen. Je nach Ziel der Modellierung kann es hilfreich sein, eine robuste Einschätzung der Vorhersage-Güte unter Berücksichtigung der Modellkomplexität vorzunehmen. Hierfür werden oft Informationskriterien verwendet. Das Akaike-Informationskriterium (AIC) <span class="math display">\[\begin{align*}
  \text{AIC} = 2k - 2 \log(\widehat{\mathcal{L}})
\end{align*}\]</span> ist ein Maß zur Bewertung der Güte eines Modells unter Berücksichtigung der Modellkomplexität. Das AIC wägt die Anpassung des Modells an die Daten (gemessen durch die maximierte Likelihood-Funktion <span class="math inline">\(\widehat{\mathcal{L}}\)</span><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>) und die Komplexität (gemessen als Funktion der Regressoranzahl <span class="math inline">\(k\)</span>) gegeneinander ab. Hierbei werden Modelle mit weniger Parametern bevorzugt, wenn sie die Daten ähnlich gut erklären, sodass eine Überanpassung und damit eine schlechte Vorhersage-Fähigkeit vermieden werden. In R können wir das AIC für Modell-Objekte mit <code><a href="https://rdrr.io/r/stats/AIC.html">AIC()</a></code> berechnen.</p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;<span class="math inline">\(\widehat{\mathcal{L}}\)</span> meint die Likelihood-Funktion für die geschätzen Koeffizienten.</p></div></div><div class="cell">
<div>
<div id="webr-20">

</div>
<script type="webr-20-contents">
eyJjb2RlIjoiIyBBSUMgYmVyZWNobmVuXG5saXN0KFxuICBQcm9iaXQgPSBtb2RfcHJvYml0LCBcbiAgTG9naXQgPSBtb2RfbG9naXRcbikgJT4lIFxuICBtYXBfZGJsKC5mID0gQUlDKSIsImF0dHIiOnsiZXZhbCI6dHJ1ZSwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
<p>Auch das AIC zeigt an, dass die Schätzung des Probit-Modells in <code>mod_probit</code> besser geeignet für die Modiellierung von <code>simdata</code> ist als das Logit-Modell <code>mod_logit</code>.</p>
</section><section id="beispiel-klassifikation-von-palmer-piniguinen" class="level3" data-number="3.2.6"><h3 data-number="3.2.6" class="anchored" data-anchor-id="beispiel-klassifikation-von-palmer-piniguinen">
<span class="header-section-number">3.2.6</span> Beispiel: Klassifikation von Palmer-Piniguinen</h3>
<p>Anhand der in diesem Kapitel betrachteten Methoden können wir Modelle zur Klassifikation von Pinguinen in <code><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">palmerpenguins::penguins</a></code> hinsichtlich ihres Geschlechts konstruieren. Hierfür nutzen wir den bereinigten Datensatz <code>penguins_cleaned</code> und transformieren zunächst die abhängige Variable <code>sex</code> in ein numerisches Format.</p>
<div class="cell">
<div>
<div id="webr-21">

</div>
<script type="webr-21-contents">
eyJjb2RlIjoiIyAnc2V4JyB0cmFuc2Zvcm1pZXJlblxucGVuZ3VpbnNfY2xlYW5lZCA8LSBwZW5ndWluc19jbGVhbmVkICU+JSBcbiAgbXV0YXRlKFxuICAgICMgc2V4IGluIDAsMS1jb2RpZXJ0ZSBWYXJpYWJsZSB1bXdhbmRlbG5cbiAgICBzZXggPSBpZl9lbHNlKHNleCA9PSBcImZlbWFsZVwiLCAxLCAwKVxuICAgIClcblxuIyDDnGJlcnByw7xmZW5cbnBlbmd1aW5zX2NsZWFuZWQgJT4lXG4gIHNlbGVjdChzZXgpICU+JVxuICBzbGljZV9oZWFkKG4gPSAxMCkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>Wir schätznen nachfolgend ein lineares Wahrscheinlichkeitsmodell <code>penguins_lp</code>, ein Probit-Modell <code>penguins_probit</code> sowie ein Logit-Modell <code>penguins_logit</code> die jeweils <code>sex</code> anhand der simplen Spezikation des linearen Prädiktors <span class="math display">\[z = \beta_0 + \beta_1 \textup{bill\_depth}\]</span> erklären.</p>
<div class="cell">
<div>
<div id="webr-22">

</div>
<script type="webr-22-contents">
eyJjb2RlIjoiIyBMaW5lYXJlcyBNb2RlbGxcbnBlbmd1aW5zX2xwIDwtIGxtKFxuICBmb3JtdWxhID0gc2V4IH4gYmlsbF9kZXB0aCwgXG4gIGRhdGEgPSBwZW5ndWluc19jbGVhbmVkXG4pIFxuXG4jIFJvYnVzdGUgWnVzYW1tZW5mYXNzdW5nXG5wZW5ndWluc19scCAlPiVcbiAgY29lZnRlc3QodmNvdiA9IHZjb3ZIQywgdHlwZSA9IFwiSEMxXCIpICU+JVxuICB0aWR5KCkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<div class="cell">
<div>
<div id="webr-23">

</div>
<script type="webr-23-contents">
eyJjb2RlIjoiIyBQcm9iaXQtTW9kZWxsXG5wZW5ndWluc19wcm9iaXQgPC0gZ2xtKFxuICBmb3JtdWxhID0gc2V4IH4gYmlsbF9kZXB0aCwgXG4gIGRhdGEgPSBwZW5ndWluc19jbGVhbmVkLCBcbiAgZmFtaWx5ID0gYmlub21pYWwoXCJwcm9iaXRcIilcbilcblxuIyBSb2J1c3RlIFp1c2FtbWVuZmFzc3VuZ1xucGVuZ3VpbnNfcHJvYml0ICU+JSBcbiAgICBjb2VmdGVzdCh2Y292ID0gdmNvdkhDLCB0eXBlID0gXCJIQzFcIikgJT4lXG4gIHRpZHkoKSIsImF0dHIiOnsiZXZhbCI6dHJ1ZSwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
<div class="cell">
<div>
<div id="webr-24">

</div>
<script type="webr-24-contents">
eyJjb2RlIjoiIyBMb2dpdC1Nb2RlbGxcbnBlbmd1aW5zX2xvZ2l0IDwtIGdsbShcbiAgZm9ybXVsYSA9IHNleCB+IGJpbGxfZGVwdGgsIFxuICBkYXRhID0gcGVuZ3VpbnNfY2xlYW5lZCwgXG4gIGZhbWlseSA9IGJpbm9taWFsKFwibG9naXRcIilcbilcblxuIyBSb2J1c3RlIFp1c2FtbWVuZmFzc3VuZ1xucGVuZ3VpbnNfbG9naXQgJT4lIFxuICBjb2VmdGVzdCh2Y292ID0gdmNvdkhDLCB0eXBlID0gXCJIQzFcIikgJT4lXG4gIHRpZHkoKSIsImF0dHIiOnsiZXZhbCI6dHJ1ZSwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
<p>Mit <code><a href="https://modelsummary.com/man/modelsummary.html">modelsummary::modelsummary()</a></code> können wir die wichtigsten Ergebnisse der Regressionen in einer pubplikationsfähigen Tabelle darstellen. Hierzu übergeben wir dem Argument <code>models</code> eine (benannte) Liste der geschätzten Modelle. Bei Angabe von <code>vcov = "HC1"</code> werden robuste Standardfehler ausgegeben.</p>
<div class="cell">
<div>
<div id="webr-25">

</div>
<script type="webr-25-contents">
eyJjb2RlIjoibGlicmFyeShtb2RlbHN1bW1hcnkpXG5cbiMgR2VzY2jDpHR6dGUgTW9kZWxsZVxubW9kZWxzdW1tYXJ5KFxuICBtb2RlbHMgPSBcbiAgICBsaXN0KFxuICAgICAgXCJMUE1cIiA9IHBlbmd1aW5zX2xwLFxuICAgICAgXCJQcm9iaXRcIiA9IHBlbmd1aW5zX3Byb2JpdCxcbiAgICAgIFwiTG9naXRcIiA9IHBlbmd1aW5zX2xvZ2l0XG4gICAgKSwgXG4gIG91dHB1dCA9IFwiZ3RcIiwgXG4gIHZjb3YgPSBcIkhDMVwiLCBcbiAgc3RhcnMgPSBUUlVFLCBcbikgJT4lXG4gIHRhYm9wdHMoKSAlPiVcbiAgdGFiX2hlYWRlcihcbiAgICB0aXRsZSA9IFwiTW9kZWxsZSBmw7xyIEdlc2NobGVjaHQgdi4gUGluZ3VpbmVuXCIsXG4gICkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>Die geschätzten negativen und signifikanten Koeffizienten von <span class="math inline">\(\textup{bill\_depth}\)</span> erfassen den Zusammenhang, dass Pinguine mit größeren Schnäbeln tendenziell männlich sind: Je größer <span class="math inline">\(\textup{bill\_depth}\)</span>, desto geringer die geschätzte Wahrscheinlichkeit, dass ein Pinguin weiblich ist. Ein Vergleich anhand des AIC zeigt, dass das Probit-Modell <code>penguins_probit</code> am besten geeignet ist.</p>
<p>Analog zur Vorgehensweise in <a href="#sec-logreg" class="quarto-xref"><span>Kapitel 3.2.3</span></a> können wir die geschätzten Modelle vergleichen, in dem wir geschätzte Wahrscheinlichkeiten <span class="math inline">\(P(Y=\textup{weiblich}\vert\textup{bill\_depth})\)</span> für eine Menge repräsentativer Werte des Regressors <code>bill_depth</code> berechnen und gemeinsam mit den Beobachtungen plotten.</p>
<div class="cell">
<div>
<div id="webr-26">

</div>
<script type="webr-26-contents">
eyJjb2RlIjoiIyBTZXF1ZW56IGbDvHIgYmlsbF9kZXB0aCBlcnN0ZWxsZW5cbmJpbGxfZGVwdGhfbmV3IDwtIHNlcShcbiAgZnJvbSA9IG1pbihwZW5ndWluc19jbGVhbmVkJGJpbGxfZGVwdGgpLCBcbiAgdG8gPSBtYXgocGVuZ3VpbnNfY2xlYW5lZCRiaWxsX2RlcHRoKSwgXG4gIGJ5ID0gLjFcbilcblxuIyBWb3JoZXJzYWdlbiBXU0sgbWl0ICdiaWxsX2RlcHRoX25ldydcbnByZWRzIDwtIHRpYmJsZShcbiAgYmlsbF9kZXB0aCA9IGJpbGxfZGVwdGhfbmV3LFxuICBscCA9IHByZWRpY3QoXG4gICAgb2JqZWN0ID0gcGVuZ3VpbnNfbHAsIFxuICAgIG5ld2RhdGEgPSB0aWJibGUoYmlsbF9kZXB0aCA9IGJpbGxfZGVwdGhfbmV3KVxuICApLFxuICBwcm9iaXQgPSBwcmVkaWN0KFxuICAgIG9iamVjdCA9IHBlbmd1aW5zX3Byb2JpdCxcbiAgICBuZXdkYXRhID0gdGliYmxlKGJpbGxfZGVwdGggPSBiaWxsX2RlcHRoX25ldyksXG4gICAgdHlwZSA9IFwicmVzcG9uc2VcIlxuICApLFxuICBsb2dpdCA9IHByZWRpY3QoXG4gICAgb2JqZWN0ID0gcGVuZ3VpbnNfbG9naXQsXG4gICAgbmV3ZGF0YSA9IHRpYmJsZShiaWxsX2RlcHRoID0gYmlsbF9kZXB0aF9uZXcpLFxuICAgIHR5cGUgPSBcInJlc3BvbnNlXCJcbiAgKVxuKVxuXG4jIFByw7xmZW46XG5zbGljZV9oZWFkKHByZWRzLCBuID0gMTApIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<div class="cell">
<div>
<div id="webr-27">

</div>
<script type="webr-27-contents">
eyJjb2RlIjoiIyBHZXNjaMOkdHp0ZSBiZWRpbmd0ZSBXU0sgcGxvdHRlblxucGVuZ3VpbnNfY2xlYW5lZCAlPiVcbiAgZ2dwbG90KFxuICAgIG1hcHBpbmcgPSBhZXMoeCA9IGJpbGxfZGVwdGgsIHkgPSBzZXgpXG4gICkgK1xuICBnZW9tX3BvaW50KFxuICAgIHBvc2l0aW9uID0gcG9zaXRpb25faml0dGVyKFxuICAgICAgaGVpZ2h0ID0gLjAyNSxcbiAgICAgIHNlZWQgPSAxMjM0XG4gICAgKSxcbiAgICBhbHBoYSA9IC4yNSxcbiAgICBjb2xvciA9IFwiYmx1ZVwiXG4gICkgK1xuICBnZW9tX2xpbmUoXG4gICAgZGF0YSA9IHByZWRzLCBcbiAgICBtYXBwaW5nID0gYWVzKHkgPSBscCwgY29sb3IgPSBcIkxQTVwiKVxuICApICtcbiAgZ2VvbV9saW5lKFxuICAgIGRhdGEgPSBwcmVkcywgXG4gICAgbWFwcGluZyA9IGFlcyh5ID0gcHJvYml0LCBjb2xvciA9IFwiUHJvYml0XCIpXG4gICkgK1xuICBnZW9tX2xpbmUoXG4gICAgZGF0YSA9IHByZWRzLCBcbiAgICBtYXBwaW5nID0gYWVzKHkgPSBsb2dpdCwgY29sb3IgPSBcIkxvZ2l0XCIpXG4gICkgK1xuICBzY2FsZV9jb2xvcl9tYW51YWwoXG4gICAgbmFtZSA9IFwiTW9kZWxsZVwiLFxuICAgIHZhbHVlcyA9IGMoXG4gICAgICBcIkxQTVwiID0gXCJzdGVlbGJsdWVcIiwgXG4gICAgICBcIlByb2JpdFwiID0gXCJvcmFuZ2VcIixcbiAgICAgIFwiTG9naXRcIiA9IFwiZGFya3JlZFwiXG4gICAgKVxuICApICtcbiAgbGFicyh0aXRsZSA9IFwiTW9kZWxsaWVydW5nIHYuIFBpbmd1aW4tR2VzY2hsZWNodCBtaXQgUmVncmVzc2lvblwiKSArXG4gIHRoZW1lX2Nvd3Bsb3QoKSArXG4gIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9IFwidG9wXCIpIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<p>Die geschätzten Regressionsfunktionen unterscheiden sich für den Bereich beobachteter Werte von <span class="math inline">\(bill\_depth\)</span> nur wenig. Die Grafik zeigt, dass die Schätzungen mit Probit- und Logit-Ansatz nur wenig Nicht-Linearität aufweisen, sodass eine (leichter interpretierbare) Modellierung mit dem linearen Wahrscheinlichkeitsmodell <code>penguins_lp</code> hier zulässig scheint.</p>
<p>Die Klassifizierung der Pinguine im Datensatz hinsichtlich ihres Geschlechts anhand vorhergesagter Wahrscheinlichkeiten <span class="math inline">\(\widehat{P}_i\)</span> kann durch Abgleich mit einem Grenzwert erfolgen. Ein Beispiel ist <span class="math display">\[\begin{align}
  \widehat{Y}_i = \begin{cases}
    \textup{weiblich}, &amp; \widehat{P}_i \geq .5,\\
    \textup{männlich}, &amp; \textup{sonst.}
  \end{cases}\label{eq:pengclass}
\end{align}\]</span></p>
<p>Wir können diesen Ansatz in R implementieren, indem wir zunächst die für den Datensatz angepassten Wahrscheinlichkeiten <code>fitted</code> aus den Modell-Objekten auslesen.</p>
<div class="cell">
<div>
<div id="webr-28">

</div>
<script type="webr-28-contents">
eyJjb2RlIjoiKFxuICBXU0sgPC0gcGVuZ3VpbnNfY2xlYW5lZCAlPiVcbiAgc2VsZWN0KHNleCkgJT4lXG4gIG11dGF0ZShcbiAgICBsaXN0KFxuICAgICAgbGluZWFyID0gcGVuZ3VpbnNfbHAsIFxuICAgICAgcHJvYml0ID0gcGVuZ3VpbnNfcHJvYml0LFxuICAgICAgbG9naXQgPSBwZW5ndWluc19sb2dpdFxuICAgICkgJT4lIFxuICAgICAgbWFwX2RmYyguZiA9IH4gLiRmaXR0ZWQpICAgICBcbiAgKVxuKSIsImF0dHIiOnsiZXZhbCI6dHJ1ZSwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
<p>Für die Klassifikation der Pinguine anhand der jeweiligen geschätzten Wahrscheinlichkeiten wenden wir die Regel <span class="math inline">\(\eqref{eq:pengclass}\)</span> mit <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> spaltenweise für die Modelle an und erzeugen neue Spalten mit vorhersagen des Geschlechts. Mit <code>.names = "{.col}_pred"</code> erhalten die neuen Spalten das Suffix <code>_pred</code>.</p>
<div class="cell">
<div>
<div id="webr-29">

</div>
<script type="webr-29-contents">
eyJjb2RlIjoiIyBLbGFzc2lmaWthdGlvbiBmLiBHZXNjaGxlY2h0IGR1cmNoZsO8aHJlblxudm9yaCA8LSBXU0sgJT4lXG4gIG11dGF0ZShcbiAgICBhY3Jvc3MoXG4gICAgICBjKGxpbmVhcjpsb2dpdCksIFxuICAgICAgLmZucyA9IH4gKC4gPiAwLjUpID09IHNleCxcbiAgICAgIC5uYW1lcyA9IFwiey5jb2x9X3ByZWRcIilcbiAgICApIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<p>Mit <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> berechnen wir nun den Anteil korrekter Vorhersagen.</p>
<div class="cell">
<div>
<div id="webr-30">

</div>
<script type="webr-30-contents">
eyJjb2RlIjoiIyBHZW5hdWlna2VpdCBkZXIgVm9yaGVyc2FnZSBiZXJlY2huZW5cbnZvcmggJT4lIFxuICBzdW1tYXJpc2UoXG4gICAgYWNyb3NzKGxpbmVhcl9wcmVkOmxvZ2l0X3ByZWQsIG1lYW4pXG4gICkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>In diesem Beispiel unterscheiden sich die Vorhersagen der drei Modelle für den Grenzwert 0.5 nicht.</p>
</section></section><section id="sec-poissonreg" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="sec-poissonreg">
<span class="header-section-number">3.3</span> Modellierung von Zählvariablen</h2>
<p>Eine weitere Klasse von <span class="math inline">\(Y\)</span> für die sich der Regressionsansatz von einfacher linearer Regression unterscheidet, sind <em>Zählvariablen</em>: Variablen, die diskrete, nicht-negative Werte annehmen. Wenn die abhängige Variable <span class="math inline">\(Y\)</span> Ereignisse in einem bestimmten Zeitraum misst (wie z.B. die Anzahl der Verkehrsunfälle in Essen innerhalb eines Monats) und weitere Bedingungen erfüllt sind, folgt <span class="math inline">\(Y\)</span> einer Poisson-Verteilung und kann mit Poisson-Regression modelliert werden. Wir erläutern nachfolgend die wesentlichen Komponenten von Poisson-Regression und diskutieren ein R-Beispiel mit fiktiven Daten.</p>
<section id="poisson-verteilung" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="poisson-verteilung">
<span class="header-section-number">3.3.1</span> Poisson-Verteilung</h3>
<p>Die Zufallsvariable <span class="math inline">\(Y\)</span> folgt einer Poisson-Verteilung mit Parameter <span class="math inline">\(\lambda\)</span>, wenn:</p>
<ol type="1">
<li><p><strong>Ereignisse unabhängig voneinander auftreten:</strong> Das Auftreten eines Ereignisses beeinflusst nicht die Wahrscheinlichkeit, dass ein weiteres Ereignis auftritt.</p></li>
<li><p><strong>Ereignisse einzeln auftreten:</strong> Die Wahrscheinlichkeit, dass in einem sehr kleinen Intervall (im Sinne von <span class="math inline">\([a,b]\)</span> für <span class="math inline">\(a \to b\)</span>) mehr als ein Ereignis auftritt, ist vernachlässigbar.</p></li>
<li><p><strong>die Rate der Ereignisse konstant ist:</strong> Die durchschnittliche Anzahl der Ereignisse pro Zeiteinheit oder pro Raumeinheit <span class="math inline">\(\lambda\)</span> ist konstant.</p></li>
</ol>
<p>Die Wahrscheinlichkeitsfunktion von <span class="math inline">\(Y\)</span> ist</p>
<p><span class="math display">\[\begin{align}
P(Y = y) = \frac{\lambda^y e^{-\lambda}}{y!} \quad \text{für} \quad y = 0, 1, 2, \ldots,\label{eq:poissonpmf}
\end{align}\]</span> wobei <span class="math inline">\(\lambda\)</span> sowohl der Erwartungswert als auch die Varianz der Verteilung ist, <span class="math display">\[\textup{E}(Y) = \textup{Var}(Y) = \lambda.\]</span></p>
<p>Die nächste Grafik zeigt die diskrete (Wahrscheinlichkeitsmasse-)Funktion <span class="math inline">\(\eqref{eq:poissonpmf}\)</span> für eine Poisson-verteilte Zufallsvariable <span class="math inline">\(Y\)</span> mit <span class="math inline">\(\lambda = 5\)</span> für den Wertebereich von 0 bis 15.</p>
<div class="cell">
<div>
<div id="webr-31">

</div>
<script type="webr-31-contents">
eyJjb2RlIjoidGliYmxlKFxuICAgIHggPSAwOjE1LFxuICAgIGRlbnMgPSBkcG9pcyh4LCBsYW1iZGEgPSA1KVxuKSAlPiVcbiAgICBcbiAgICBnZ3Bsb3QoIFxuICAgICAgICBtYXBwaW5nID0gYWVzKHggPSB4LCB5ID0gZGVucylcbiAgICApICtcbiAgICBnZW9tX2JhcihcbiAgICAgIHN0YXQgPSBcImlkZW50aXR5XCIsIFxuICAgICAgZmlsbCA9IFwic3RlZWxibHVlXCIsXG4gICAgICBjb2xvciA9IFwid2hpdGVcIlxuICAgICkgK1xuICAgIHNjYWxlX3hfY29udGludW91cyhicmVha3MgPSAwOjE1KSArIFxuICAgIGxhYnMoXG4gICAgICAgIHRpdGxlID0gXCJQb2lzc29uLURpY2h0ZWZ1bmt0aW9uIGbDvHIgbGFtYmRhID0gNVwiLCBcbiAgICAgICAgeSA9IFwiRGljaHRlXCJcbiAgICApICtcbiAgICB0aGVtZV9jb3dwbG90KCkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImxhYmVsIjoiZmlnLXBvaXNzb25kZW5zaXR5IiwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
</section><section id="poisson-regression" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="poisson-regression">
<span class="header-section-number">3.3.2</span> Poisson-Regression</h3>
<p>Wie für die bisher betrachteten Regressionsansätzen modelliert Poisson-Regression den Erwartungswert (und damit gleichzeitig die Varianz) <span class="math inline">\(\lambda\)</span> der abhängigen Variable <span class="math inline">\(Y\)</span> als eine Funktion der Regressoren <span class="math inline">\(\mathbf{X} = (X_1, X_2, \ldots, X_k)\)</span>. Unter Annahme einer Poisson-Verteilung kann Poisson-Regression als generalisiertes lineares Modell verstanden werden, wobei eine logarithmische Verknüpfungsfunktion für den linearen Prädiktor <span class="math inline">\(\mathbf{X}_i^\top \boldsymbol{\beta}\)</span> verwendet wird:</p>
<p><span class="math display">\[\begin{align*}
\log(\lambda_i) &amp;= \mathbf{X}_i^\top \boldsymbol{\beta},
\end{align*}\]</span> sodass <span class="math display">\[\begin{align*}
\lambda_i &amp;= \exp(\mathbf{X}_i^\top \boldsymbol{\beta}),
\end{align*}\]</span> wobei</p>
<ul>
<li>
<span class="math inline">\(\lambda_i = \textup{E}(Y_i\vert \mathbf{X}_i) = \textup{Var}(Y_i\vert \mathbf{X}_i)\)</span> für Beobachtung <span class="math inline">\(i\)</span>,</li>
<li>
<span class="math inline">\(\mathbf{X}_i\)</span> der Vektor der unabhängigen Variablen für Beobachtung <span class="math inline">\(i\)</span> ist, und</li>
<li>
<span class="math inline">\(\boldsymbol{\beta}\)</span> der Vektor der Regressionskoeffizienten ist.</li>
</ul></section><section id="schätzung-2" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="schätzung-2">
<span class="header-section-number">3.3.3</span> Schätzung</h3>
<p>Die Likelihood-Funktion für <span class="math inline">\(n\)</span> Beobachtungen ist</p>
<p><span class="math display">\[\begin{align}
L(\boldsymbol{\beta}) = \prod_{i=1}^n \frac{\lambda_i^{y_i} e^{-\lambda_i}}{y_i!}.
\end{align}\]</span></p>
<p>Die Log-Likelihood-Funktion ist daher</p>
<p><span class="math display">\[\begin{align}
\mathcal{L}(\boldsymbol{\beta}) = \sum_{i=1}^n \left( y_i \log(\lambda_i) - \lambda_i - \log(y_i!). \right)
\end{align}\]</span></p>
<p>Da <span class="math inline">\(\lambda_i = \exp(\mathbf{X}_i^\top \boldsymbol{\beta})\)</span>, wird die Log-Likelihood-Funktion zu</p>
<p><span class="math display">\[\begin{align}
\mathcal{L}(\boldsymbol{\beta}) = \sum_{i=1}^n \left( y_i (\mathbf{X}_i^\top \boldsymbol{\beta}) - \exp(\mathbf{X}_i^\top \boldsymbol{\beta}) - \log(y_i!) \right)
\end{align}\]</span></p>
<p>Den ML-Schätzer <span class="math inline">\(\widehat{\boldsymbol{\beta}}\)</span> erhalten wir durch Maximierung der Log-Likelihoodfunktion <span class="math inline">\(\mathcal{L}(\boldsymbol{\beta})\)</span>. Die R-Implementierung von Poisson-Regression in <code><a href="https://rdrr.io/r/stats/glm.html">stats::glm()</a></code> wird mit <code>family = poisson(link = "log")</code> aufgerufen.</p>
</section><section id="interpretation-der-koeffizienten" class="level3" data-number="3.3.4"><h3 data-number="3.3.4" class="anchored" data-anchor-id="interpretation-der-koeffizienten">
<span class="header-section-number">3.3.4</span> Interpretation der Koeffizienten</h3>
<p>Die Koeffizienten <span class="math inline">\(\boldsymbol{\beta}\)</span> in der Poisson-Regression haben eine log-lineare Beziehung zur Zählvariable. Für einen bestimmten Koeffizienten <span class="math inline">\(\beta_j\)</span> ist die Interpretation wiefolgt:</p>
<p>Eine Änderung der unabhängigen Variable <span class="math inline">\(X_j\)</span> um eine Einheit führt zu einer Änderung des <em>Logarithmus</em> des Erwartungswertes von <span class="math inline">\(Y\)</span> um <span class="math inline">\(\beta_j\)</span>. Der Erwartungswert <span class="math inline">\(\lambda\)</span> ändert sich also <em>multiplikativ</em> um den Faktor <span class="math inline">\(\exp(\beta_j)\)</span>.</p>
<p>Als Beispiel betrachten wir den linearen Prädiktor</p>
<p><span class="math display">\[\begin{align*}
  \log(\lambda) = \beta_0 + \beta_1 X.
\end{align*}\]</span></p>
<p>Für eine Änderung von <span class="math inline">\(X\)</span> um <span class="math inline">\(\Delta X\)</span> erhalten wir</p>
<p><span class="math display">\[\begin{align*}
   \lambda =&amp;\, \exp(\beta_0 + \beta_1 X) \\
    \lambda + \delta\lambda =&amp;\, \exp(\beta_0 + \beta_1 (X + \Delta X)) \\
    =&amp;\, \exp(\beta_0 + \beta_1 X) \cdot \exp(\beta\Delta X) \\
    =&amp;\, \lambda \cdot \exp(\beta\Delta X)
\end{align*}\]</span></p>
<p>Angenommen <span class="math inline">\(X\)</span> ist die Anzahl durchgeführter Werbekampagnen und die abhängige Zählvariable <span class="math inline">\(Y\)</span> misst die Anzahl der Verkäufe des beworbenen Produkts pro Monat.</p>
<p>Wenn <span class="math inline">\(\beta_1 = 0.5\)</span>, bedeutet dies, dass jede zusätzliche Werbekampagne (<span class="math inline">\(\Delta X = 1\)</span>) die erwartete Anzahl der Verkäufe pro Monat um einen Faktor von <span class="math inline">\(\exp(0.5) \approx 1.65\)</span> erhöht:</p>
<p>Das heißt, die <em>Rate</em> der Verkäufe steigt um 65% für jede zusätzliche Werbekampagne.</p>
<p>Zur Veranschaulichung der Schätzung einer Poisson-Regression für dieses Beispiel erzeugen wir Poisson-verteilte Daten für <span class="math display">\[\begin{align*}
  \log(\lambda) = 2 + 0.4 \cdot X
\end{align*}\]</span> und ziehen <span class="math inline">\(X\)</span> gleichverteilt aus <span class="math inline">\(\{1,2,\dots,8\}\)</span>.</p>
<div class="cell">
<div>
<div id="webr-32">

</div>
<script type="webr-32-contents">
eyJjb2RlIjoiIyBTZXR6ZSBkZW4gWnVmYWxsc3phaGxlbmdlbmVyYXRvciBmw7xyIFJlcHJvZHV6aWVyYmFya2VpdFxuc2V0LnNlZWQoMTIzNClcblxuIyBBbnphaGwgZGVyIEJlb2JhY2h0dW5nZW5cbm4gPC0gNTAwXG5cbiMgWsO8Z2UgZsO8ciB1bmFiaMOkbmdpZ2UgVmFyaWFibGUgWCAoQW56YWhsIGRlciBXZXJiZWthbXBhZ25lbilcblggPC0gc2FtcGxlKDE6OCwgcmVwbGFjZSA9IFQsIHNpemUgPSBuKVxuXG4jIEVyd2FydHVuZ3N3ZXJ0ZVxubGFtYmRhIDwtIGV4cCgyICsgMC40ICogWClcblxuIyBBYmjDpG5naWdlIFZhcmlhYmxlIFkgKEFuemFobCBkZXIgVmVya8OkdWZlKSBhbHMgUG9pc3Nvbi12ZXJ0ZWlsdGUgWnVmYWxsc3ZhcmlhYmxlLCBnZWdlYmVuIGxhbWJkYVxuWSA8LSBtYXBfZGJsKFxuICAueCA9IDE6biwgXG4gIC5mID0gfiBycG9pcyhcbiAgICBuID0gMSwgbGFtYmRhID0gbGFtYmRhWy54XVxuICApXG4pXG4gIFxuIyBEYW50ZW4gaW4gdGliYmxlIHNhbW1lbG5cbmRhdCA8LSB0aWJibGUoXG4gIEthbXBhZ25lbiA9IFgsIFxuICBWZXJrYWV1ZmUgPSBZXG4gIClcblxuIyDDnGJlcmJsaWNrXG5zbGljZV9oZWFkKGRhdCwgbiA9IDEwKSIsImF0dHIiOnsiZXZhbCI6dHJ1ZSwiZWRpdCI6dHJ1ZX19
</script>
</div>
</div>
<p>Die Züge aus der abhängigen Variablen visualieren wir mit einem Häufigkeits-Histogramm.</p>
<div class="cell">
<div>
<div id="webr-33">

</div>
<script type="webr-33-contents">
eyJjb2RlIjoiIyBIaXN0b2dyYW1tIGRlciBBYmguIFZhcmlhYmxlXG5nZ3Bsb3QoXG4gIGRhdGEgPSBkYXQsIFxuICBtYXBwaW5nID0gYWVzKHggPSBWZXJrYWV1ZmUpXG4gICkgK1xuICBnZW9tX2hpc3RvZ3JhbShiaW53aWR0aCA9IDIpICtcbiAgbGFicyhcbiAgICB0aXRsZSA9IFwiUG9pc3Nvbi12ZXJ0ZWlsdGUgRGF0ZW5cIlxuICApICtcbiAgdGhlbWVfY293cGxvdCgpIiwiYXR0ciI6eyJldmFsIjp0cnVlLCJlZGl0Ijp0cnVlfX0=
</script>
</div>
</div>
<p>Wir schätzen das Modell und extrahieren die robuste Zusammenfassung mit <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy()</a></code>.</p>
<div class="cell">
<div>
<div id="webr-34">

</div>
<script type="webr-34-contents">
eyJjb2RlIjoiIyBQb2lzc29uLVJlZ3Jlc3Npb24gc2Now6R0emVuXG5tb2RfcG9pc3NvbiA8LSBnbG0oXG4gIGZvcm11bGEgPSBWZXJrYWV1ZmUgfiBLYW1wYWduZW4sIFxuICBmYW1pbHkgPSBwb2lzc29uKGxpbmsgPSBcImxvZ1wiKSwgXG4gIGRhdGEgPSBkYXRcbilcblxuIyBadXNhbW1lbmZhc3N1bmcgZGVzIGdlc2NoLiBNb2RlbGxzXG5tb2RfcG9pc3NvbiAlPiVcbiAgY29lZnRlc3QodmNvdiA9IHZjb3ZIQywgdHlwZSA9IFwiSEMxXCIpICU+JVxuICB0aWR5KCkiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>
<p>Die ML-Schätzung des Poisson-Modells liefert für die verwendete Stichprobe von 500 Beobachtungen Koeffizienten-Schätzungen nahe der wahren Parameter. Zur Veranschaulichung des geschätzten Modells überlagern wir die simulierten Datenpunkte aus <code>dat</code> mit der anhand von <code>mod_poisson</code> geschätzten Anzahl der Verkäufe je Anzahl an Werbekampagnen.</p>
<div class="cell">
<div>
<div id="webr-35">

</div>
<script type="webr-35-contents">
eyJjb2RlIjoiIyBWZWt0b3IgZsO8ciBLYW1wYWduZW5cbkthbXBhZ25lbl9uZXcgPC0gdGliYmxlKEthbXBhZ25lbiA9IDE6OClcblxuIyBWb3JoZXJzYWdlbiBtaXQgTW9kZWxsXG5wcmVkIDwtIHRpYmJsZShcbiAgS2FtcGFnbmVuID0gMTo4LFxuICBwcmVkaWN0ZWQgPSBwcmVkaWN0KFxuICAgIG1vZF9wb2lzc29uLCBcbiAgICBuZXdkYXRhID0gS2FtcGFnbmVuX25ldyxcbiAgICB0eXBlID0gXCJyZXNwb25zZVwiXG4gIClcbilcblxuIyBTaW11bGllcnRlIERhdGVuIHVuZCBTY2jDpHR6dW5nZW5cbmdncGxvdCgpICtcbiAgZ2VvbV9wb2ludChcbiAgICBkYXRhID0gZGF0LFxuICAgIG1hcHBpbmcgPSBhZXMoXG4gICAgICB4ID0gS2FtcGFnbmVuLCBcbiAgICAgIHkgPSBWZXJrYWV1ZmVcbiAgICApLCBcbiAgICBjb2xvciA9IFwiZ3JheVwiLFxuICAgIGFscGhhID0gMC4yNSwgXG4gICAgcG9zaXRpb24gPSBwb3NpdGlvbl9qaXR0ZXIod2lkdGggPSAuMSlcbiAgKSArXG4gICAgZ2VvbV9wb2ludChcbiAgICBkYXRhID0gcHJlZCxcbiAgICBtYXBwaW5nID0gYWVzKFxuICAgICAgeCA9IEthbXBhZ25lbixcbiAgICAgIHkgPSBwcmVkaWN0ZWRcbiAgICApLFxuICAgIGNvbG9yID0gXCJyZWRcIlxuICApICtcbiAgc2NhbGVfeF9jb250aW51b3VzKGJyZWFrcyA9IDE6OCkgK1xuICBsYWJzKFxuICAgIHRpdGxlID0gXCJEYXRlbnNhdHogdW5kIFBvaXNzb24tU2Now6R0enVuZ2VuIGRlciBWZXJrw6R1ZmVcIixcbiAgICB4ID0gXCJBbnphaGwgZGVyIFdlcmJla2FtcGFnbmVuXCIsXG4gICAgeSA9IFwiQW56YWhsIGRlciBWZXJrw6R1ZmVcIlxuICApICtcbiAgdGhlbWVfY293cGxvdCgpICtcbiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gXCJ0b3BcIikiLCJhdHRyIjp7ImV2YWwiOnRydWUsImVkaXQiOnRydWV9fQ==
</script>
</div>
</div>


<!-- -->

<script type="webr-data">
eyJwYWNrYWdlcyI6eyJyZXBvcyI6W10sInBrZ3MiOlsiZXZhbHVhdGUiLCJrbml0ciIsImh0bWx0b29scyIsImJyb29tIiwiY293cGxvdCIsImxtdGVzdCIsImRwbHlyIiwiZ2dwbG90MiIsImd0IiwibW9kZWxzdW1tYXJ5IiwicGFsbWVycGVuZ3VpbnMiLCJwdXJyciIsInRpZHlyIiwicmVhZHIiLCJzYW5kd2ljaCJdfSwib3B0aW9ucyI6eyJiYXNlVXJsIjoiaHR0cHM6Ly93ZWJyLnItd2FzbS5vcmcvdjAuNC4xLyJ9LCJyZW5kZXJfZGYiOiJkZWZhdWx0In0=
</script><script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zNTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMzUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMzUgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zNS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTM1LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzM1ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zNSwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTM1IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zNDtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMzQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMzQgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zNC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTM0LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzM0ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zNCwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTM0IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zMztcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMzMiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMzMgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zMy1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTMzLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzMzID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zMywge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTMzIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zMjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMzIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMzIgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zMi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTMyLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzMyID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zMiwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTMyIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zMTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMzEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMzEgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zMS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTMxLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzMxID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zMSwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTMxIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zMDtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMzAiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMzAgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zMC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTMwLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzMwID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zMCwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTMwIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yOTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjkiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjkgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yOS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTI5LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzI5ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yOSwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTI5IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yODtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjggPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yOC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTI4LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzI4ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yOCwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTI4IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yNztcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjcgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yNy1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTI3LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzI3ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yNywge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTI3IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yNjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjYiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjYgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yNi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTI2LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzI2ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yNiwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTI2IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yNTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjUgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yNS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTI1LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzI1ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yNSwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTI1IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yNDtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjQgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yNC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTI0LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzI0ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yNCwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTI0IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yMztcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjMiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjMgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yMy1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTIzLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzIzID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yMywge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTIzIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yMjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjIgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yMi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTIyLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzIyID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yMiwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTIyIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yMTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjEgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yMS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTIxLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzIxID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yMSwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTIxIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yMDtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMjAiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMjAgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yMC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTIwLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzIwID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8yMCwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTIwIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xOTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTkiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTkgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xOS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTE5LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzE5ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xOSwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTE5IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xODtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTggPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xOC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTE4LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzE4ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xOCwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTE4IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xNztcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTcgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xNy1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTE3LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzE3ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xNywge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTE3IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xNjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTYiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTYgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xNi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTE2LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzE2ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xNiwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTE2IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xNTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTUgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xNS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTE1LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzE1ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xNSwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTE1IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xNDtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTQgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xNC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTE0LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzE0ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xNCwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTE0IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xMztcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTMiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTMgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xMy1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTEzLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzEzID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xMywge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTEzIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xMjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTIgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xMi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTEyLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzEyID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xMiwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTEyIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xMTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTEgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xMS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTExLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzExID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xMSwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTExIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8xMDtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTAiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfMTAgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0xMC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTEwLWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzEwID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8xMCwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTEwIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV85O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIiwiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC05IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0In0seyJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzkgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici05LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItOS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV85ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl85LCB7fSk7XG4iLCJjZWxsTmFtZSI6IndlYnItOSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQifSx7InNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfODtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtOCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCJ9LHsic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl84ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItOC1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTgtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfOCA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfOCwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0In0seyJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzc7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4iLCJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfNyA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTctY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici03LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzcgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzcsIHt9KTtcbiIsImNlbGxOYW1lIjoid2Vici03IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV82O1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIiwiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC02IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0In0seyJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzYgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici02LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV82ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl82LCB7fSk7XG4iLCJjZWxsTmFtZSI6IndlYnItNiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQifSx7InNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfNTtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtNSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCJ9LHsic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl81ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItNS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTUtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfNSA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfNSwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0In0seyJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzQ7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4iLCJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6InZpZXdvZiBfd2Vicl9lZGl0b3JfNCA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTQtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici00LWNvbnRlbnRzYCB9LCBibG9jay5hdHRyKTtcbiAgY29uc3QgZWRpdG9yID0gbmV3IFdlYlJFeGVyY2lzZUVkaXRvcih3ZWJST2pzLndlYlJQcm9taXNlLCBibG9jay5jb2RlLCBvcHRpb25zKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl93ZWJyX3ZhbHVlXzQgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzQsIHt9KTtcbiIsImNlbGxOYW1lIjoid2Vici00IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8zO1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIiwiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0zIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0In0seyJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzMgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0zLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHdlYnItMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8zID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl8zLCB7fSk7XG4iLCJjZWxsTmFtZSI6IndlYnItMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQifSx7InNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMjtcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiIsImNlbGxOYW1lIjoid2Vici13aWRnZXQtMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCJ9LHsic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl8yID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMi1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgaWQ6IGB3ZWJyLTItY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuXG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxuX3dlYnJfdmFsdWVfMiA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMiwge30pO1xuIiwiY2VsbE5hbWUiOiJ3ZWJyLTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0In0seyJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzE7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4iLCJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQifSx7InNvdXJjZSI6Il93ZWJyX3ZhbHVlXzEgPSB7XG4gIGNvbnN0IHsgaGlnaGxpZ2h0UiwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTEtY29udGVudHNcIixcbiAgICBlY2hvOiB0cnVlLFxuICAgIG91dHB1dDogdHJ1ZVxuICB9LCBibG9jay5hdHRyKTtcblxuICAvLyBFdmFsdWF0ZSB0aGUgcHJvdmlkZWQgUiBjb2RlXG4gIGNvbnN0IHJlc3VsdCA9IHdlYlJPanMucHJvY2Vzcyh7Y29kZTogYmxvY2suY29kZSwgb3B0aW9uc30sIHt9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiMVwiIGluIHdlYlJPanMucmVuZGVyZWRPanMpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGlmIChvcHRpb25zLmVjaG8pIHtcbiAgICAgIC8vIFNob3cgb3V0cHV0IGFzIGhpZ2hsaWdodGVkIHNvdXJjZVxuICAgICAgY29uc3QgcHJlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwcmVcIik7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlXCI7XG4gICAgICBwcmVFbGVtLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZSByXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFIoYmxvY2suY29kZSkpO1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItZ3JvdyBzcGlubmVyLWdyb3ctc20gbS0yIHBvc2l0aW9uLWFic29sdXRlIHRvcC0wIGVuZC0wXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHByZUVsZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICB9XG5cbiAgICB5aWVsZCBjb250YWluZXI7XG4gIH1cblxuICB3ZWJST2pzLnJlbmRlcmVkT2pzW1wiMVwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiIsImNlbGxOYW1lIjoid2Vici0xIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCJ9LHsic291cmNlIjoid2ViUk9qcyA9IHtcbiAgY29uc3QgeyBXZWJSIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lLldlYlI7XG4gIGNvbnN0IHtcbiAgICBXZWJSRXZhbHVhdG9yLFxuICAgIFdlYlJFbnZpcm9ubWVudE1hbmFnZXIsXG4gICAgc2V0dXBSLFxuICAgIGI2NERlY29kZSxcbiAgICBjb2xsYXBzZVBhdGhcbiAgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc3RhdHVzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLXN0YXR1c1wiKTtcbiAgY29uc3QgaW5kaWNhdG9yQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleGVyY2lzZS1sb2FkaW5nLWluZGljYXRvclwiKTtcbiAgaW5kaWNhdG9yQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJkLW5vbmVcIik7XG5cbiAgbGV0IHN0YXR1c1RleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gIHN0YXR1c1RleHQuY2xhc3NMaXN0ID0gXCJleGVyY2lzZS1sb2FkaW5nLWRldGFpbHNcIjtcbiAgc3RhdHVzVGV4dCA9IHN0YXR1c0NvbnRhaW5lci5hcHBlbmRDaGlsZChzdGF0dXNUZXh0KTtcbiAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBJbml0aWFsaXNlYDtcblxuICAvLyBIb2lzdCBpbmRpY2F0b3Igb3V0IGZyb20gZmluYWwgc2xpZGUgd2hlbiBydW5uaW5nIHVuZGVyIHJldmVhbFxuICBjb25zdCByZXZlYWxTdGF0dXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmVhbCAuZXhlcmNpc2UtbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gIGlmIChyZXZlYWxTdGF0dXMpIHtcbiAgICByZXZlYWxTdGF0dXMucmVtb3ZlKCk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZlYWwgPiAuc2xpZGVzXCIpLmFwcGVuZENoaWxkKHJldmVhbFN0YXR1cyk7XG4gIH1cblxuICAvLyB3ZWJSIHN1cHBsZW1lbnRhbCBkYXRhIGFuZCBvcHRpb25zXG4gIGNvbnN0IGRhdGFDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItZGF0YVxcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGI2NERlY29kZShkYXRhQ29udGVudCkpO1xuXG4gIC8vIEdyYWIgbGlzdCBvZiByZXNvdXJjZXMgdG8gYmUgZG93bmxvYWRlZFxuICBjb25zdCBmaWxlc0NvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwidmZzLWZpbGVcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBmaWxlcyA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKGZpbGVzQ29udGVudCkpO1xuXG4gIC8vIEluaXRpYWxpc2Ugd2ViUiBhbmQgc2V0dXAgZm9yIFIgY29kZSBldmFsdWF0aW9uXG4gIGxldCB3ZWJSUHJvbWlzZSA9IChhc3luYyAod2ViUikgPT4ge1xuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgRG93bmxvYWRpbmcgd2ViUmA7XG4gICAgYXdhaXQgd2ViUi5pbml0KCk7XG5cbiAgICAvLyBJbnN0YWxsIHByb3ZpZGVkIGxpc3Qgb2YgcGFja2FnZXNcbiAgICAvLyBFbnN1cmUgd2ViUiBkZWZhdWx0IHJlcG8gaXMgaW5jbHVkZWRcbiAgICBkYXRhLnBhY2thZ2VzLnJlcG9zLnB1c2goXCJodHRwczovL3JlcG8uci13YXNtLm9yZ1wiKVxuICAgIGF3YWl0IGRhdGEucGFja2FnZXMucGtncy5tYXAoKHBrZykgPT4gKCkgPT4ge1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyBwYWNrYWdlOiAke3BrZ31gO1xuICAgICAgcmV0dXJuIHdlYlIuZXZhbFJWb2lkKGBcbiAgICAgICAgd2Vicjo6aW5zdGFsbChwa2csIHJlcG9zID0gcmVwb3MpXG4gICAgICAgIGxpYnJhcnkocGtnLCBjaGFyYWN0ZXIub25seSA9IFRSVUUpXG4gICAgICBgLCB7IGVudjoge1xuICAgICAgICBwa2c6IHBrZyxcbiAgICAgICAgcmVwb3M6IGRhdGEucGFja2FnZXMucmVwb3MsXG4gICAgICB9fSk7XG4gICAgfSkucmVkdWNlKChjdXIsIG5leHQpID0+IGN1ci50aGVuKG5leHQpLCBQcm9taXNlLnJlc29sdmUoKSk7XG5cbiAgICAvLyBEb3dubG9hZCBhbmQgaW5zdGFsbCByZXNvdXJjZXNcbiAgICBhd2FpdCBmaWxlcy5tYXAoKGZpbGUpID0+IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5hbWUgPSBmaWxlLnN1YnN0cmluZyhmaWxlLmxhc3RJbmRleE9mKCcvJykgKyAxKTtcbiAgICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgRG93bmxvYWRpbmcgcmVzb3VyY2U6ICR7bmFtZX1gO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChmaWxlKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW4ndCBkb3dubG9hZCBcXGAke2ZpbGV9XFxgLiBFcnJvciAke3Jlc3BvbnNlLnN0YXR1c306IFwiJHtyZXNwb25zZS5zdGF0dXNUZXh0fVwiLmApO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7XG5cbiAgICAgIC8vIFN0b3JlIFVSTHMgaW4gdGhlIGN3ZCB3aXRob3V0IGFueSBzdWJkaXJlY3Rvcnkgc3RydWN0dXJlXG4gICAgICBpZiAoZmlsZS5pbmNsdWRlcyhcIjovL1wiKSkge1xuICAgICAgICBmaWxlID0gbmFtZTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29sbGFwc2UgaGlnaGVyIGRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGZpbGUgPSBjb2xsYXBzZVBhdGgoZmlsZSk7XG5cbiAgICAgIC8vIENyZWF0ZSBkaXJlY3RvcnkgdHJlZSwgaWdub3JpbmcgXCJkaXJlY3RvcnkgZXhpc3RzXCIgVkZTIGVycm9yc1xuICAgICAgY29uc3QgcGFydHMgPSBmaWxlLnNwbGl0KCcvJykuc2xpY2UoMCwgLTEpO1xuICAgICAgbGV0IHBhdGggPSAnJztcbiAgICAgIHdoaWxlIChwYXJ0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHBhdGggKz0gcGFydHMuc2hpZnQoKSArICcvJztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB3ZWJSLkZTLm1rZGlyKHBhdGgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgaWYgKCFlLm1lc3NhZ2UuaW5jbHVkZXMoXCJGUyBlcnJvclwiKSkge1xuICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gV3JpdGUgdGhpcyBmaWxlIHRvIHRoZSBWRlNcbiAgICAgIHJldHVybiBhd2FpdCB3ZWJSLkZTLndyaXRlRmlsZShmaWxlLCBuZXcgVWludDhBcnJheShkYXRhKSk7XG4gICAgfSkucmVkdWNlKChjdXIsIG5leHQpID0+IGN1ci50aGVuKG5leHQpLCBQcm9taXNlLnJlc29sdmUoKSk7XG5cbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYEluc3RhbGxpbmcgd2ViUiBzaGltc2A7XG4gICAgYXdhaXQgd2ViUi5ldmFsUlZvaWQoYHdlYnI6OnNoaW1faW5zdGFsbCgpYCk7XG5cbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYFdlYlIgZW52aXJvbm1lbnQgc2V0dXBgO1xuICAgIGF3YWl0IHNldHVwUih3ZWJSLCBkYXRhKTtcblxuICAgIHN0YXR1c1RleHQucmVtb3ZlKCk7XG4gICAgaWYgKHN0YXR1c0NvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGggPT0gMCkge1xuICAgICAgc3RhdHVzQ29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlKCk7XG4gICAgfVxuICAgIHJldHVybiB3ZWJSO1xuICB9KShuZXcgV2ViUihkYXRhLm9wdGlvbnMpKTtcblxuICAvLyBLZWVwIHRyYWNrIG9mIGluaXRpYWwgT0pTIGJsb2NrIHJlbmRlclxuICBjb25zdCByZW5kZXJlZE9qcyA9IHt9O1xuXG4gIGNvbnN0IHByb2Nlc3MgPSBhc3luYyAoY29udGV4dCwgaW5wdXRzKSA9PiB7XG4gICAgY29uc3Qgd2ViUiA9IGF3YWl0IHdlYlJQcm9taXNlO1xuICAgIGNvbnN0IGV2YWx1YXRvciA9IG5ldyBXZWJSRXZhbHVhdG9yKHdlYlIsIGNvbnRleHQpXG4gICAgYXdhaXQgZXZhbHVhdG9yLnByb2Nlc3MoaW5wdXRzKTtcbiAgICByZXR1cm4gZXZhbHVhdG9yLmNvbnRhaW5lcjtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcHJvY2VzcyxcbiAgICB3ZWJSUHJvbWlzZSxcbiAgICByZW5kZXJlZE9qcyxcbiAgfTtcbn1cbiIsImNlbGxOYW1lIjoid2Vici1wcmVsdWRlIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0In1dfQ==
</script><div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script></section></section></main><!-- /main --><script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script><script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./R_Einfuehrung.html" class="pagination-link" aria-label="Statistische Programmierung mit R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistische Programmierung mit R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Simulation.html" class="pagination-link" aria-label="Simulation">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Simulation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Quellcode</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb2" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> live-html</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="an">webr:</span><span class="co"> </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">  packages: [</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">            'broom',</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">            'cowplot',</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">            'lmtest',</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">            'dplyr',</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">            'ggplot2',</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">            'gt',</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">            'modelsummary',</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">            'palmerpenguins',</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">            'purrr',</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">            'tidyr',</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">            'readr',</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">            'sandwich'</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">            ]</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>{{&lt; include ./_extensions/r-wasm/live/_knitr.qmd &gt;}}</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>{{&lt; include ./_extensions/r-wasm/live/_gradethis.qmd &gt;}}</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu"># Regression {#sec-regression}</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="in">#| completion: true</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="in">tabopts &lt;- function(x) {</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="in">    fmt_number(x, decimals = 3, drop_trailing_zeros = T) %&gt;%</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="in">    tab_options(table_body.hlines.color = "white",</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="in">              column_labels.border.bottom.color = "black", </span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="in">             column_labels.border.top.color = "black",</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="in">             table_body.border.bottom.color = "black", </span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="in">             table.border.bottom.color = "black",</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="in">             column_labels.font.weight = "bold", </span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="in">             table.font.color = "black", </span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="in">             table.font.size = 16)</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>Viele der in diesem Companion behandelten Methoden basiert auf dem Konzept der Schätzung kausaler Effekte mit *Regression*. Als Regressionsansatz bezeichnet man eine Methode, welche die Beziehungen zwischen Variablen durch einen funktionalen Zusammenhang beschreibt und die Parameter der gewählten funktionalen Form anhand von beobachteten Daten schätzt. *Lineare Regression* nimmt eine lineare funktionale Form der Beziehung zwischen einer abhängigen Variable (Outcome-Varibale) und erklärenden Variablen (Regressoren) an. *Nicht-lineare Regressionsmethoden* modellieren die Beziehung etwa durch Polynome höherer Ordnung, exponentielle Funktionen oder andere komplexere Formen. Die Wahl der funktionalen Form hängt von der Natur des datenerzeugenden Prozesses (DGP) und somit stets von der spezifischen Beziehung ab, die untersucht wird. </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>Regressionsansätze gehören zu den am häufigsten verwendeten Methoden für Kausalanalysen, da so in vielen Forschungsdesigns kausale Effekte identifiziert werden können, indem Backdoors geschlossen werden: Regression kann die durch die Behandlungsvariable verursachte Variation in der Outcome-Variable isolieren, indem für gemeinsame Einflussfaktoren von Behandlungs- *und* Outcome-Variable kontrolliert wird. In diesem Kapitel erläutern wir Grundlagen der Spezifikation und Schätzung von Regressionsansätzen, die für spätere Kapitel relevant sind. Neben einer Motivation der Schätzung kausaler Effekte mit multipler Regression betrachten wir Modelle für verschiedene Kategorien von Outcome-Variablen und diskutieren deren Implementierung mit R.</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Regression schließt Backdoors: Frish-Waugh-Lovell-Theorem</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>Das Frisch-Waugh-Lovell-Theorem (FWL) besagt, dass in einer multiplen linearen Regression die geschätzten Koeffizienten für eine Teilmenge der Regressoren numerisch identisch zu Koeffizientenschätzungen aus folgenden Schritten sind </span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Rechne die Effekte der übrigen Variablen auf (a) die Outcome-Variable und (b) die Teilmenge der erklärenden Variablen mit Regression heraus und </span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>regressiere anschließend die Residuen von Schritt (a) auf die Residuen aus Schritt (b). </span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>In einem multiplen Modell mit zwei Regressoren $X_1,\ X_2$,</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  Y = \beta_0 + \beta_1 X + \beta_2 X_2 + \epsilon \label{eq:fwlfullreg}</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>kann der Effekt von $X_1$ auf $Y$ also mit der Regression</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  \widehat{u}_{Y,X_2} = \beta_1 \widehat{u}_{X_1,X_2} + e \label{eq:fwl2reg}</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>geschätzt werden, wobei $\widehat{u}_{Y,X_2}$ und $\widehat{u}_{X_1,X_2}$ die Residuen der Regression von $Y$ auf $X_2$ und von $X_1$ auf $X_2$ sind.</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>FWL ermöglicht daher eine Vereinfachung der Schätzung komplexer Modelle durch die Zerlegung der Schätzung in Teilschritte. </span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>Für das Verständnis der Schätzung kausaler Effekte mit linearer Regression ist FWL hilfreich, denn es zeigt, wie sowohl die Variation in der Outcome-Variable ($\widehat{u}_{Y,X_2}$) als auch die Variation in der Behandlungsvariable ($\widehat{u}_{X_1,X_2}$), die jeweils *nicht* durch Kovariablen ($X_2$) verursacht wird, mit multipler Regression isoliert werden kann, sodass Backdoors geschlossen werden.</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>Wir illustrieren dieses Konzept anhand einer multiplen Regression für die Schnabeltiefe (<span class="in">`body_mass`</span>) von Pinguinen aus dem Datensatz <span class="in">`palmerpenguins::penguins`</span>,</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  \textup{body<span class="sc">\_</span>mass} = \beta_0 + \beta_1\cdot\textup{bill<span class="sc">\_</span>length} + \beta_2\cdot \textup{flipper<span class="sc">\_</span>length} + \epsilon,\label{eq:billdepthmodel}</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>unter der Annahme, dass $\beta_1$ der interessierende Effekt ist: Die erwartete Änderung des Gewichts eines Pinguins (in Gramm) für eine Änderung der Schnabel-Länge um 1mm.</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>Vor der Schätzung von Modell \eqref{eq:billdepthmodel} lesen wir den Datensatz ein und erstellen eine bereinigte Variante <span class="in">`penguins_cleaned`</span>, analog zur Vorgehensweise in @sec-pp.</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="in">library(palmerpenguins)</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="in">data(penguins)</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="in"># Datensatz bereinigen</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_cleaned &lt;- penguins %&gt;% </span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="in">    bill_depth = bill_depth_mm,</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="in">    bill_length = bill_length_mm,</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="in">    flipper_length = flipper_length_mm,</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="in">    body_mass = body_mass_g</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na() %&gt;% </span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="in">    body_mass &lt; quantile(body_mass, .95)</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="in"># Überblick</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="in">slice_head(penguins_cleaned, n = 10)</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>Wir schätzen nun Modell \eqref{eq:billdepthmodel} mit <span class="in">`lm()`</span> und erhalten eine Zusammenfassung der geschätzen Koeffizienten mit <span class="in">`broom::tidy()`</span>.</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom)</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="in"># "Großes" Modell schätzen</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="in">lm(</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = body_mass ~ bill_length + flipper_length, </span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="in">  data = penguins_cleaned</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy()</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>Das Ergebnis der Schätzung ist $\widehat{\beta}_1\approx3.80$. Der nächste Code-Block berechnet die Residuen aus den Regressionen</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>  \textup{body<span class="sc">\_</span>mass} =&amp;\, \alpha_0 + \alpha_1 \textup{flipper<span class="sc">\_</span>length} + u_{\textup{body<span class="sc">\_</span>mass},\,\textup{flipper<span class="sc">\_</span>length}},<span class="sc">\\</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>  \textup{bill<span class="sc">\_</span>length} =&amp;\, \delta_0 + \delta_1 \textup{flipper<span class="sc">\_</span>length} + u_{\textup{bill<span class="sc">\_</span>length},\,\textup{flipper<span class="sc">\_</span>length}},</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>und speichert diese in <span class="in">`body_mass_res`</span> und <span class="in">`bill_length_res`</span>.</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a><span class="in"># FWL-Schritt 1 (a)</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a><span class="in">peng_mod_fwl1a &lt;- lm(</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = body_mass ~ flipper_length, </span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="in">  data = penguins_cleaned</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a><span class="in">body_mass_res &lt;- residuals(peng_mod_fwl1a)</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a><span class="in"># FWL-Schritt 1 (b)</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a><span class="in">peng_mod_fwl1b &lt;- lm(</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = bill_length ~ flipper_length, </span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a><span class="in">  data = penguins_cleaned</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a><span class="in">bill_length_res &lt;- residuals(peng_mod_fwl1b)</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a><span class="in"># FWL-Schritt 2</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a><span class="in">lm(formula = body_mass_res ~ bill_length_res - 1) %&gt;% </span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy()</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>Der geschätzte Koeffizient aus der Regression der Residuen stimmt mit dem geschätzten Koeffizienten von <span class="in">`bill_length`</span> aus der großen Regression \eqref{eq:billdepthmodel} überein.</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>Wir können den Effekt der Kontrolle für <span class="in">`flipper_length`</span> visualisieren. Wir plotten hierzu:</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Die originalen Datenpunkte für <span class="in">`bill_length`</span> und <span class="in">`body_mass`</span>^<span class="co">[</span><span class="ot">Für eine bessere Lesbarkeit der Grafik zentrieren wir beide Variablen um den jeweiligen Stichprobenmittelwert.</span><span class="co">]</span> gemeinsam mit der geschätzten Regressionslinie für das Modell $$ \textup{body<span class="sc">\_</span>mass} = \beta_0 + \beta_1\textup{bill<span class="sc">\_</span>length} + u $$ (keine Kontrolle für <span class="in">`flipper_length`</span>!)^<span class="co">[</span><span class="ot">Der R-Befehl für diese Regression ist `lm(I(body_mass - mean(body_mass)) ~ I(bill_length - mean(bill_length)) - 1, data = penguins_cleaned)`.</span><span class="co">]</span>.</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Die um <span class="in">`flipper_length`</span> bereinigten Datenpunkte und die zugehörige geschätzte Regressionslinie.</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a><span class="in"># Residuen in tibble sammeln</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a><span class="in">tibble(</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a><span class="in">  body_mass_res, </span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a><span class="in">  bill_length_res</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() +</span></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a><span class="in">  # Bereinigte Datenpunkte plotten</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a><span class="in">      x = bill_length_res, </span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a><span class="in">      y = body_mass_res,</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a><span class="in">      color = "Um flipper_length bereinigte Daten"</span></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a><span class="in">  # Regressionslinie für bereinigte Datenpunkte</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(x = bill_length_res, y = body_mass_res),</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "lm", </span></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a><span class="in">    formula = "y ~ x - 1",</span></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a><span class="in">    se = F,</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a><span class="in">    col = "purple"</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a><span class="in">  # Ursprüngliche Datenpunkte plotten</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(</span></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a><span class="in">    data = penguins_cleaned, </span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a><span class="in">      x = bill_length - mean(bill_length), </span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a><span class="in">      y = body_mass - mean(body_mass),</span></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a><span class="in">      color = "Ursprüngliche Datenpunkte"</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = .5,</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a><span class="in">  # Regressionslinie für ursprüngliche Datenpunkte</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a><span class="in">    data = penguins_cleaned, </span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(</span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a><span class="in">      x = bill_length - mean(bill_length), </span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a><span class="in">      y = body_mass - mean(body_mass)</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "lm", </span></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a><span class="in">    formula = "y ~ x - 1",</span></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a><span class="in">    se = F,</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a><span class="in">    col = alpha("black", .5)</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "",</span></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c(</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a><span class="in">      "Um flipper_length bereinigte Daten" = "purple",</span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a><span class="in">      "Ursprüngliche Datenpunkte" = "black"</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Penguins: Anwendung von FWL",</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "bill_length",</span></span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "body_mass"</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_cowplot() +</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top")</span></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>Der grafische Vergleich beider Vorgehensweisen zeigt den Effekt der Kontrolle für <span class="in">`flipper_length`</span>: Die geschätzte (schwarze) Regressionslinie für die bereinigten Daten hat eine deutlich geringere Steigung als die anhand der ursprünglichen Daten geschätzte (lilane) Linie. Der Effekt von <span class="in">`bill_length`</span> auf <span class="in">`body_mass`</span> wird mit der einfachen Regression <span class="in">`lm(body_mass ~ bill_length)`</span> vermutlich *überschätzt*, weil es andere Faktoren (wie <span class="in">`flipper_length`</span> gibt, die mit <span class="in">`bill_length`</span> und <span class="in">`body_mass`</span> korrelieren. Kontrollieren für <span class="in">`flipper_length`</span> in der multiplen Regression <span class="in">`lm(body_mass ~ bill_length + flipper_length)`</span> schließt die Backdoor durch <span class="in">`flipper_length`</span>. Die Konsequenz ist eine deutlich geringere Steigung der lilanen Regressionslinie.</span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a><span class="fu">## Binäre Outcome-Variable {#sec-bov}</span></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>Eine binäre Variable, auch als dichotome Variable oder Indikator-Variable bezeichnet, ist eine Variable, die nur zwei Ausprägungen annehmen kann. Diese beiden Ausprägungen werden typischerweise durch die Werte 0 und 1 repräsentiert und dienen dazu, zwei verschiedene Zustände oder Kategorien zu unterscheiden. Formal kann eine binäre Variable $B$ wie folgt definiert werden:</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>  B = \begin{cases} </span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>  1, &amp; \text{Eigenschaft trifft zu,} <span class="sc">\\</span></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>  0, &amp; \text{Eigenschaft trifft nicht zu.}</span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>  \end{cases}</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>Eine in späteren Kapiteln dieses Companions als verwendeter *binärer Regressor* ist der Indikator für die Zuordnung von Beobachtungen in Behandlungs- oder Kontrollgruppe (1 = Behandlungsgruppe, 0 = Kontrollgruppe). </span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>Für viele ökonomische Forschungsfragen ist es hilfreich, eine *binäre Outcome-Variable* mit Regression zu modellieren. Hierzu gibt es verschiedene Ansätze, die wir nachfolgend zusammenfassen und ihre Anwendung mit R zeigen.</span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a><span class="fu">### Das lineare Wahrscheinlichkeitsmodell {#sec-lpm}</span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>Das lineare Regressionsmodell</span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>$$Y = \beta_0 + \beta_1 X_{1} + \beta_2 X_{2} + \dots + \beta_k X_{k} + u$$</span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>mit einer binären abhängigen Variablen $Y_i\in<span class="sc">\{</span>0,1<span class="sc">\}</span>$ wird als *lineares Wahrscheinlichkeitsmodell* bezeichnet. Wie üblich modellieren wir den Erwartungswert der abhängigen Variable gegeben der Regressoren $X_1,\dots,X_k$ als lineare Funktion,</span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>$$E(Y\vert X_1,X_2,\dots,X_k) = P(Y=1\vert X_1, X_2,\dots, X_3).$$ Da $Y$ eine binäre Variable ist, gilt hier</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>$$ P(Y = 1 \vert X_1, X_2, \dots, X_k) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_k X_k.$$</span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>Das lineare Wahrscheinlichkeitsmodell beschreibt also die *Wahrscheinlichkeit*, dass $Y=1$ als lineare Funktion der Regressoren: $\beta_j$ misst die Änderung in der Wahrscheinlichkeit für das Ereignis $Y_i=1$, unter der Bedingung, dass die anderen $k-1$ Regressoren konstant gehalten werden. Genau wie bei multipler Regression mit einer kontinuierlichen abhängigen Variablen können die $\beta_j$ mit der KQ-Methode geschätzt werden.</span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>Aufgrund der Beschränktheit der $Y_i$ auf $<span class="sc">\{</span>0,1<span class="sc">\}</span>$ sind die $u_i$ heteroskedastisch. Folglich sollten Inferenzstatistiken mit robusten Standardfehlern berechnet werden. Weiterhin ist zu beachten, dass $R^2$ in den meisten Anwendungen von linearen Wahrscheinlichkeitsmodellen keine hilfreiche Interpretation hat, da das geschätzte Modell die Daten nicht perfekt erklären kann, wenn die abhängige Variable binär, aber die Regressoren kontinuierlich verteilt sind.</span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>Das lineare Wahrscheinlichkeitsmodell hat einen wesentlichen Nachteil: Das Modell nimmt an, dass die bedingte Wahrscheinlichkeitsfunktion linear ist und $P(Y=1\vert X_1,\dots,X_k)$ nicht auf das für Wahrscheinlichkeiten definierte Intervall $<span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>$ beschränkt ist. Ein angepasstes Modell hat dann für Regressorwerte, die zu Vorhersagen von $Y$ jenseits von $<span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>$ führen keine sinnvolle Interpretation.</span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>Dieser Umstand verlangt nach Regressionsansätzen, die $P(Y=1)$ durch eine auf $<span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>$ beschränkte (nicht-lineare) Funktion der Regressoren modellieren. Häufig verwendete Methoden sind Probit- und Logit-Regression.</span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>Ein lineares Wahrscheinlichkeitsmodell kann mit <span class="in">`lm()`</span> geschätzt werden, wobei die abhängige Variable den Typ <span class="in">`numeric`</span> oder <span class="in">`integer`</span> haben muss.</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a><span class="fu">### Probit-Regression {#sec-probitreg}</span></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>Bei der Probit-Regression wird die Standardnormalverteilungsfunktion $\Phi(\cdot)$ verwendet, um die Regressionsfunktion einer binären abhängigen Variable zu modellieren. Wir nehmen an, dass</span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>  E(Y\vert X) = P(Y=1\vert X) = \Phi(\beta_0 + \beta_1 X), \label{eq:probitmodel}</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>sodass der mit der Verknüfungsfunktion (Link) $$\textup{probit}(\cdot) = \Phi^{-1}(\cdot)$$ transformierte Erwartungswert $P(Y=1\vert X)$ dem linearen Prädiktor $z=\beta_0 + \beta_1 X$ entspricht,</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>  \Phi^{-1}\big<span class="co">[</span><span class="ot">P(Y=1\vert X)\big</span><span class="co">]</span> = \beta_0 + \beta_1 X.</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>$z=\beta_0 + \beta_1 X$ in \eqref{eq:probitmodel} modelliert hier also ein *Quantil* der Standardnormalverteilung,</span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>\Phi(z) = P(Z \leq z) \ , \ Z \sim \mathcal{N}(0,1).</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>Der Koeffizient $\beta_1$ in \eqref{eq:probitmodel} misst die Änderung in $z$, die mit einer Änderung von $X$ um eine Einheit verbunden ist. Obwohl der Effekt einer Änderung in $X$ auf $z$ linear ist, ist der Zusammenhang zwischen $z$ und $\textup{E}(Y\vert X) = P(Y=1\vert X)$ *nicht linear*, denn $\Phi(\cdot)$ ist eine nicht-lineare Funktion von $X$.</span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a><span class="in"># N(0,1)-Quantilsfunktion / Probit-Link</span></span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = qnorm) +</span></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(</span></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "z", </span></span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a><span class="in">    limits = c(0, 1)</span></span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(name = "Quantil") +</span></span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Probit-Funktion") +</span></span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_cowplot()</span></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>Aufgrund der Nicht-Linearität der Link-Funktion hat der Koeffizient von $X$ keine einfache Interpretation hinsichtlich des Effekts auf $P(Y=1\vert X)$. Die Änderung in der Wahrscheinlichkeit, dass $Y=1$ ist, durch eine Änderung in $X$ (partieller Effekt von $X$) kann berechnet werden als:</span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>  \frac{\partial\textup{E}(Y\vert X)}{\partial X} = \frac{\partial\textup{P}(Y=1\vert X)}{\partial X} = \frac{\partial\Phi(\beta_0 + \beta_1 X)}{\partial X} = \phi(\beta_0 + \beta_1 X) \beta_1,</span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>wobei $\phi(\cdot)$ die Dichtefunktion der Standardnormalverteilung ist. In empirischen Anwendungen wird der partielle Effekt häufig als Differenz in geschätzten Wahrscheinlichkeiten angegeben:</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Berechne die geschätzte Wahrscheinlichkeit, dass $Y=1$ für einen Bezugswert $X$.</span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Berechne die geschätzte Wahrscheinlichkeit, dass $Y=1$ für $X + \Delta X$.</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Berechne die Differenz zwischen der geschätzten Wahrscheinlichkeiten.</span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>Wie im linearen Wahrscheinlichkeitsmodell kann das Modell \eqref{eq:probitmodel} auf eine Probit-Regression mit $k+1$ Regressoren $\boldsymbol{X} := (1, X_1, \dots, X_k)$ verallgemeinert werden, um das Risiko einer Verzerrung durch ausgelassene Variablen zu mindern. Die Schritte 1 bis 3 für die Berechnung des partiellen Effekts einer Änderung in $X_j$ erfolgen dann unter der Annahme, dass die übrigen $k-1$ Regressoren konstant gehalten werden, wobei der partielle Effekt von den jeweiligen Regressorwerten abhängt. Im nächsten Abschnitt erläutern wir die Schätzung von Probit-Modellen mit $k+1$ Regressoren.</span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Schätzung</span></span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>Die Likelihood-Funktion für Probit-Regression ist</span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>  L(\boldsymbol{\beta}) = \prod_{i=1}^n \Phi(\mathbf{X}_i^\top \boldsymbol{\beta})^{y_i} \left<span class="co">[</span><span class="ot">1 - \Phi(\mathbf{X}_i^\top \boldsymbol{\beta})\right</span><span class="co">]</span>^{1-y_i}</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>Hierbei ist $\Phi(\mathbf{X}_i^\top \boldsymbol{\beta})$ die Wahrscheinlichkeit, dass $Y_i = 1$ ist und $1 - \Phi(\mathbf{X}_i^\top \boldsymbol{\beta})$ ist die Wahrscheinlichkeit, dass $Y_i = 0$ ist.</span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>Die Log-Likelihood-Funktion ergibt sich als</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>  \mathcal{L}(\boldsymbol{\beta}) = \sum_{i=1}^n \left<span class="co">[</span><span class="ot"> y_i \log \Phi(\mathbf{X}_i^\top \boldsymbol{\beta}) + (1 - y_i) \log \left(1 - \Phi(\mathbf{X}_i^\top \boldsymbol{\beta})\right) \right</span><span class="co">]</span></span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>Um den Maximum-Likelihood-Schätzer $\widehat{\boldsymbol{\beta}}$ zu finden, muss die Log-Likelihood-Funktion $\mathcal{L}(\boldsymbol{\beta})$ maximiert werden. In der Praxis erfolgt dies häufig durch numerische Optimierung, da die Log-Likelihood-Funktion der Probit-Regression im Allgemeinen keine geschlossene Form hat damit eine analytische Lösung nicht möglich ist.</span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>Für eine Anwendung in R und einen Vergleich mit dem linearen Wahrscheinlichkeitsmodell erzeugen wir einen Beispieldatensatz <span class="in">`simdata`</span> für einen datenerzeugenden Prozess (DGP)^<span class="co">[</span><span class="ot">Siehe @sec-sim für Erläuterungen von Simulationsmethoden in R.</span><span class="co">]</span> mit einem normalverteilten Regressor $X\sim N(5,2^2)$ und</span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>  P(Y=1\vert X) = \Phi(z), \quad z = -4 + 0.7 X.</span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a><span class="in"># Daten simulieren</span></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(1234)</span></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a><span class="in"># Stichprobengröße</span></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 500 </span></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a><span class="in">simdata &lt;- tibble(</span></span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a><span class="in">  X = rnorm(n = n, mean = 5, sd = 2), # Regressor</span></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a><span class="in">  P = pnorm(-4 + 0.7 * X),</span></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a><span class="in"># Binäre Outcome-Variable hinzufügen</span></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a><span class="in">simdata &lt;- simdata %&gt;%</span></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a><span class="in">    Y = as.integer(runif(n) &lt; P)</span></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a><span class="in"># Überblick</span></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a><span class="in">slice_head(simdata, n = 10)</span></span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>Das lineare Wahrscheinlichkeitsmodell schätzen wir wie gewohnt mit <span class="in">`lm()`</span> und berechnen robuste Standardfehler mit <span class="in">`lmtest::coeftest()`</span>.</span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a><span class="in"># lineares Wahrscheinlichkeitsmodell schätzen</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a><span class="in">mod_lp &lt;- lm(</span></span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = Y ~ X, </span></span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a><span class="in">  data = simdata</span></span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a><span class="in"># Zusammenfassung</span></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a><span class="in">mod_lp %&gt;% </span></span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a><span class="in">  coeftest(vcov = vcovHC, type = "HC1") %&gt;%</span></span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy()</span></span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a>Beachte, dass lediglich die Vorzeichen der geschätzten Koeffizienten mit denen der wahren Werten übereinstimmmen. Da das lineare Modell fehlspezifiziert ist, sind die KQ-Schätzer der Koeffizienten hier inkonsistent.</span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>Ein Probit-Modell kann mit <span class="in">`stats::glm()`</span> geschätzt werden. Hierbei ist <span class="in">`formula`</span> die Formel für den linearen Prädiktor $z$ und <span class="in">`family`</span> eine Link-Funktion für den Zusammenhang von $z$ und $P(Y\vert X)$. Mit <span class="in">`family = binomial(link = "probit")`</span> wählen wir die Link-Funktion <span class="in">`probit`</span>.</span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a><span class="in"># Probit-Modell schätzen</span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a><span class="in">mod_probit &lt;- glm(</span></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = Y ~ X,</span></span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a><span class="in">  data = simdata, </span></span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a><span class="in">  family = binomial(link = "probit")</span></span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a><span class="in"># Zusammenfassung</span></span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a><span class="in">mod_probit %&gt;%</span></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a><span class="in">  coeftest(vcov = vcovHC, type = "HC1") %&gt;%</span></span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy()</span></span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a>Die geschätzten Koeffizienten in der Probit-Regression liegen, wie erwartet, nahe bei Parametern des DGPs.</span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a>Um beide Schätzungen gemeinsam zu plotten, erzeugen wir mit <span class="in">`predict()`</span> Vorhersagen für eine Menge von Werten <span class="in">`X`</span> im Intervall $<span class="co">[</span><span class="ot">0,11</span><span class="co">]</span>$. Beachte, dass bei Vorhersagen für das Probit-Modell die gewünschte Transformation der vorherzusagenden Variable über <span class="in">`type`</span> gewählt werden muss.^<span class="co">[</span><span class="ot">Dies gilt für jedes Modell mit einer anderen Link-Funktion als $f(x) = x$ ist (lineare Regression).</span><span class="co">]</span> Der Standardfall ist <span class="in">`type = "link"`</span>, d.h. wir erhalten Vorhersagen für den linearen Prädiktor: $\widehat{z} = \widehat\beta_0 + \widehat{\beta}_1X$. Mit <span class="in">`type = "response"`</span> werden diese Werte mit der Link-Funktion, hier $\Phi(\cdot)$ zu vorhergesagten Wahrscheinlichkeiten $\widehat{P}(Y=1\vert X = x)$ transformiert.</span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a><span class="in"># geschätzte Wahrscheinlichkeitsfunktion</span></span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a><span class="in"># für lineares Modell</span></span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a><span class="in">X &lt;- seq(0, 11, 0.01)</span></span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- tibble(</span></span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a><span class="in">  X = X, </span></span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a><span class="in">  LP = predict(</span></span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a><span class="in">    object = mod_lp, </span></span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a><span class="in">    newdata = tibble(X)</span></span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a><span class="in">  probit = predict(</span></span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a><span class="in">    object = mod_probit,</span></span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a><span class="in">    newdata = tibble(X),</span></span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a><span class="in">    type = "response"</span></span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a><span class="in"># Überblick verschaffen</span></span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a><span class="in">slice_head(pred, n = 10)</span></span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a>Der nachfolgende Code-Chunk erstellt einen Punkte-Plot mit Jitter-Effekt (<span class="in">`position_jitter`</span>), wobei die Beobachtungen zufällig leicht vertikal verschoben werden, um Überlappungen zu vermeiden. Zusätzlich zeichnen wir die geschätzten Regressionslinien für <span class="in">`mod_lp`</span> (LPM) und <span class="in">`mod_probit`</span> (Probit) sowie die tatsächliche Wahrscheinlichkeitsfunktion $P(Y=1\vert X)$ ein.</span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a><span class="in"># Daten und geschätzte Modelle plotten</span></span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- simdata %&gt;%</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(mapping = aes(x = X, y = Y)) +</span></span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(</span></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a><span class="in">    position = position_jitter(</span></span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a><span class="in">      height = .025,</span></span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a><span class="in">      seed = 1234</span></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = .25,</span></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "gray"</span></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(</span></span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a><span class="in">    data = pred, </span></span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(y = LP, color = "LPM"),</span></span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a><span class="in">    lwd = .75</span></span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(</span></span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a><span class="in">    data = pred, </span></span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(y = probit, color = "Probit"),</span></span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a><span class="in">    lwd = .75</span></span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(</span></span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a><span class="in">    fun = \(x) pnorm(-4 + .7 * x), </span></span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(color = "Wahrheit")</span></span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "",</span></span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c(</span></span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a><span class="in">      "Wahrheit" = "black",</span></span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a><span class="in">      "LPM" = "steelblue", </span></span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a><span class="in">      "Probit" = "orange"</span></span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Gesch. Modelle für binäre abhängige Variable") +</span></span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_cowplot() +</span></span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top")</span></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a><span class="in">p</span></span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a>Die Grafik zeigt, dass beide Modelle den positiven Zusammenhang für $X$ und $P(Y=1\vert X)$ erfassen. Das lineare Wahrscheinlichkeitsmodell approximiert die tatsächliche nicht-lineare Wahrscheinlichkeitsfunktion nur schlecht und liefert insbesondere in den Rändern der Verteilung von $X$ (kleine und große Werte) unzulässige Vorhersagen außerhalb des Intervalls $<span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>$. Die Probit-Spezifikation hingegen erfasst den nicht-linearen Verlauf der tatsächlichen Wahrscheinlichkeitsfunktion gut.</span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistische Regression {#sec-logreg}</span></span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a>Bei logistischer Regression wird die logistische Funktion $\Lambda(\cdot)$ </span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a>\Lambda(z) = \frac{1}{1 + \exp(-z)},</span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a>als Link-Funktion genutzt, um die Wahrscheinlichkeitsfunktion von $Y$ gegeben $X$ zu modellieren. Ähnlich wie im Probit-Modell nehmen wir hier an, dass</span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a>E(Y\vert X) = P(Y=1\vert X) = \Lambda(\beta_0 + \beta_1 X). \label{eq:logitmodel}</span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a>In diesem Modell ist die Link-Funktion $\Lambda^{-1}(\cdot)$. Für $z=\beta_0 + \beta_1 X$ ist $\Lambda^{-1}(t)$ der sogenannte *logit*: Dass logarithmierte Verhältnis von $p := P(Y=1\vert X)$ und $1 - p = P(Y=0\vert X)$,</span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a>  \textup{logit(p)} = \log\bigg(\frac{p}{1-p}\bigg) = \beta_0 + \beta_1 X.</span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a>Der Koeffizient $\beta_1$ misst also die Veränderung des Logits pro Einheit Änderung im Regressor $X$. </span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a>Ähnlich wie bei Probit-Regression ist der Einfluss von $X$ auf den Logit linear, jedoch besteht auch hier eine nicht-lineare Beziehung zwischen dem linearen Prädiktor und der Wahrscheinlichkeit $P(Y=1\vert X)$, denn $\Lambda(\cdot)$ ist eine nicht-lineare Funktion mit dem Wertebereich $<span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>$.</span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot: Logistische Funktion</span></span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(</span></span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a><span class="in">    fun = \(x) 1 / (1 + exp(-x))</span></span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(</span></span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "z", </span></span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a><span class="in">    limits = c(-4, 4)</span></span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(name = "Lambda(z)") +</span></span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Logistische Funktion") +</span></span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_cowplot()</span></span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot: Logit</span></span>
<span id="cb2-514"><a href="#cb2-514" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb2-515"><a href="#cb2-515" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(</span></span>
<span id="cb2-516"><a href="#cb2-516" aria-hidden="true" tabindex="-1"></a><span class="in">    fun = \(x) log(x / (1 - x))</span></span>
<span id="cb2-517"><a href="#cb2-517" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb2-518"><a href="#cb2-518" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(</span></span>
<span id="cb2-519"><a href="#cb2-519" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "p", </span></span>
<span id="cb2-520"><a href="#cb2-520" aria-hidden="true" tabindex="-1"></a><span class="in">    limits = c(0, 1)</span></span>
<span id="cb2-521"><a href="#cb2-521" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-522"><a href="#cb2-522" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(name = "Logit(p)") +</span></span>
<span id="cb2-523"><a href="#cb2-523" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Logit-Funktion") +</span></span>
<span id="cb2-524"><a href="#cb2-524" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_cowplot()</span></span>
<span id="cb2-525"><a href="#cb2-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-526"><a href="#cb2-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-527"><a href="#cb2-527" aria-hidden="true" tabindex="-1"></a>Die nachstehende interaktive Grafik zeigt, wie die Wahscheinlichkeitsfunktion der latenten Variable $z=\beta_0 + \beta_1 X$ von den Parametern $\beta_0$ und $\beta_1$ jeweils für Logit- und Probit-Regression beeinflusst wird.</span>
<span id="cb2-528"><a href="#cb2-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-529"><a href="#cb2-529" aria-hidden="true" tabindex="-1"></a>&lt;iframe class="obs-soft-box-shadow" width="100%" height="700" frameborder="0"</span>
<span id="cb2-530"><a href="#cb2-530" aria-hidden="true" tabindex="-1"></a>  src="https://observablehq.com/embed/@mca91/latent-variable-cdf?cells=plot%2Cviewof+beta0%2Cviewof+beta%2CMathJax"&gt;&lt;/iframe&gt;</span>
<span id="cb2-531"><a href="#cb2-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-532"><a href="#cb2-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-533"><a href="#cb2-533" aria-hidden="true" tabindex="-1"></a>Aufgrund der Nicht-Linearität von $\Lambda(z)$ kann der Koeffizient $\beta_1$ wie im Probit-Modell nicht direkt als Effekt auf die Wahrscheinlichkeit $P(Y=1\vert X)$ interpretiert werden.</span>
<span id="cb2-534"><a href="#cb2-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-535"><a href="#cb2-535" aria-hidden="true" tabindex="-1"></a>Um den partiellen Effekt einer Änderung in $X$ am Punkt $X$ auf $P(Y=1\vert X)$ zu ermitteln, berechnen wir die Ableitung des bedingten Erwartungswerts:</span>
<span id="cb2-536"><a href="#cb2-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a>\frac{\partial\textup{E}(Y\vert X)}{\partial X} = \frac{\partial\textup{P}(Y=1\vert X)}{\partial X} = \frac{\partial\Lambda(\beta_0 + \beta_1 X)}{\partial X} = \lambda(\beta_0 + \beta_1 X) \beta_1,</span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a>wobei $\lambda(\cdot)$, ähnlich wie die Dichtefunktion der Normalverteilung im Probit-Modell, die Dichtefunktion der logistischen Verteilung darstellt. Diese ist gegeben durch</span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a>\lambda(z) = \Lambda(z) \cdot (1 - \Lambda(z)).</span>
<span id="cb2-543"><a href="#cb2-543" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-544"><a href="#cb2-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-545"><a href="#cb2-545" aria-hidden="true" tabindex="-1"></a>Die Interpretation des angepassten Modells ist aufgrund der Modellierung des Logits intuitiver als für Probit-Regression. Angenommen eine Bank möchte die Wahrscheinlichkeit modellieren, dass ein Kunde einen Kredit nicht zurückzahlt:  $P(Y=\textup{Zahlungsausfall}\vert X)$, wobei der Regressor $X$ das Verhältnis von aktuellem Schuldenstand und Monatseinkommen ist. Die Schätzung einer logistischen Regression ergibt, dass ein Anstieg von $X =x$ um 0.1 den Logit für die Wahrscheinlichkeit eines Kreditausfalls $p(x)$ um 0.4 erhöht:</span>
<span id="cb2-546"><a href="#cb2-546" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-547"><a href="#cb2-547" aria-hidden="true" tabindex="-1"></a>  \textup{logit} \big<span class="co">[</span><span class="ot">P(Y=\textup{Zahlungsausfall}\vert X = x + 0.1)\big</span><span class="co">]</span> = \textup{logit}<span class="co">[</span><span class="ot">p(x)</span><span class="co">]</span> + 0.4. </span>
<span id="cb2-548"><a href="#cb2-548" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-549"><a href="#cb2-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-550"><a href="#cb2-550" aria-hidden="true" tabindex="-1"></a>Das Modell besagt dann, dass die Wahrscheinlichkeit der Zahlungsunfähigkeit etwa um den *Faktor* 1.5 ansteigt, denn</span>
<span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-552"><a href="#cb2-552" aria-hidden="true" tabindex="-1"></a>  \exp\big(\textup{logit}<span class="co">[</span><span class="ot">p(x)</span><span class="co">]</span> + 0.4\big) = \frac{p(x)}{1-p(x)} \cdot \exp(0.4)</span>
<span id="cb2-553"><a href="#cb2-553" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-554"><a href="#cb2-554" aria-hidden="true" tabindex="-1"></a>mit</span>
<span id="cb2-555"><a href="#cb2-555" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-556"><a href="#cb2-556" aria-hidden="true" tabindex="-1"></a>  \exp(0.4) \approx 1.50.</span>
<span id="cb2-557"><a href="#cb2-557" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-558"><a href="#cb2-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-559"><a href="#cb2-559" aria-hidden="true" tabindex="-1"></a><span class="fu">### Schätzung</span></span>
<span id="cb2-560"><a href="#cb2-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-561"><a href="#cb2-561" aria-hidden="true" tabindex="-1"></a>Ähnlich wie bei Probit-Regressionen können Logit-Modelle mit Maximum-Likelihood geschätzt werden. Die Likelihood-Funktion für Logit-Regression lautet</span>
<span id="cb2-562"><a href="#cb2-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-563"><a href="#cb2-563" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-564"><a href="#cb2-564" aria-hidden="true" tabindex="-1"></a>  L(\boldsymbol{\beta}) &amp;= \prod_{i=1}^n \left(\frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}\right)^{y_i} \left(1 - \frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}\right)^{1-y_i},</span>
<span id="cb2-565"><a href="#cb2-565" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-566"><a href="#cb2-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-567"><a href="#cb2-567" aria-hidden="true" tabindex="-1"></a>mit $$\frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}$$ der Wahrscheinlichkeit, dass $Y_i = 1$. Für das Ereignis $Y_i = 0$ ist die  Wahrscheinlichkeit entsprechend $$1 - \frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}.$$</span>
<span id="cb2-568"><a href="#cb2-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-569"><a href="#cb2-569" aria-hidden="true" tabindex="-1"></a>Die Log-Likelihood-Funktion lautet</span>
<span id="cb2-570"><a href="#cb2-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-571"><a href="#cb2-571" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-572"><a href="#cb2-572" aria-hidden="true" tabindex="-1"></a>  \mathcal{L}(\boldsymbol{\beta}) &amp;= \sum_{i=1}^n \left<span class="co">[</span><span class="ot"> y_i \log \left(\frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}\right) + (1 - y_i) \log \left(1 - \frac{1}{1 + \exp(-\mathbf{X}_i^\top \boldsymbol{\beta})}\right) \right</span><span class="co">]</span></span>
<span id="cb2-573"><a href="#cb2-573" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-574"><a href="#cb2-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-575"><a href="#cb2-575" aria-hidden="true" tabindex="-1"></a>und erlaubt die Schätzung von $\boldsymbol{\beta}$ durch Maximierung mit numerischen Methoden.</span>
<span id="cb2-576"><a href="#cb2-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-577"><a href="#cb2-577" aria-hidden="true" tabindex="-1"></a>Für Anwendungen mit R nutzen wir <span class="in">`stats::glm()`</span> und wählen die logistische Link-Funktion mit <span class="in">`family = binomial(link = "logit")`</span>. Für die simulierten Daten <span class="in">`simdata`</span> aus @sec-probitreg:</span>
<span id="cb2-578"><a href="#cb2-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-581"><a href="#cb2-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-582"><a href="#cb2-582" aria-hidden="true" tabindex="-1"></a><span class="in"># Logit-Modell schätzen</span></span>
<span id="cb2-583"><a href="#cb2-583" aria-hidden="true" tabindex="-1"></a><span class="in">mod_logit &lt;- glm(</span></span>
<span id="cb2-584"><a href="#cb2-584" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = Y ~ X,</span></span>
<span id="cb2-585"><a href="#cb2-585" aria-hidden="true" tabindex="-1"></a><span class="in">  data = simdata, </span></span>
<span id="cb2-586"><a href="#cb2-586" aria-hidden="true" tabindex="-1"></a><span class="in">  family = binomial(link = "logit")</span></span>
<span id="cb2-587"><a href="#cb2-587" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-588"><a href="#cb2-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-589"><a href="#cb2-589" aria-hidden="true" tabindex="-1"></a><span class="in"># Robuste Zusammenfassung</span></span>
<span id="cb2-590"><a href="#cb2-590" aria-hidden="true" tabindex="-1"></a><span class="in">mod_logit %&gt;%</span></span>
<span id="cb2-591"><a href="#cb2-591" aria-hidden="true" tabindex="-1"></a><span class="in">  coeftest(vcov = vcovHC, type = "HC1")</span></span>
<span id="cb2-592"><a href="#cb2-592" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy()</span></span>
<span id="cb2-593"><a href="#cb2-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-594"><a href="#cb2-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-595"><a href="#cb2-595" aria-hidden="true" tabindex="-1"></a>Wir erweitern nun <span class="in">`pred`</span> um die anhand von <span class="in">`predict()`</span> für <span class="in">`mod_logit`</span> geschätzten Wahrscheinlichkeiten von $Y=1\vert X$ für die Regressorwerte in <span class="in">`X`</span>.</span>
<span id="cb2-596"><a href="#cb2-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-599"><a href="#cb2-599" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-600"><a href="#cb2-600" aria-hidden="true" tabindex="-1"></a><span class="in"># gesch. WSK-Funktion gem. Logit-Modell hinzufügen</span></span>
<span id="cb2-601"><a href="#cb2-601" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- pred %&gt;%</span></span>
<span id="cb2-602"><a href="#cb2-602" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb2-603"><a href="#cb2-603" aria-hidden="true" tabindex="-1"></a><span class="in">    Logit = predict(mod_logit, tibble(X), type = "response")</span></span>
<span id="cb2-604"><a href="#cb2-604" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-605"><a href="#cb2-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-606"><a href="#cb2-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-607"><a href="#cb2-607" aria-hidden="true" tabindex="-1"></a>Anhand der Vorhersagen in <span class="in">`pred`</span> können wir die im Objekt <span class="in">`p`</span> gespeicherte Grafik um die geschätzte Regressionsfunktion für das Logit-Modell erweitern.</span>
<span id="cb2-608"><a href="#cb2-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-611"><a href="#cb2-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-612"><a href="#cb2-612" aria-hidden="true" tabindex="-1"></a><span class="in"># Grafik mit Logit-fit erweitern</span></span>
<span id="cb2-613"><a href="#cb2-613" aria-hidden="true" tabindex="-1"></a><span class="in">p + </span></span>
<span id="cb2-614"><a href="#cb2-614" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(</span></span>
<span id="cb2-615"><a href="#cb2-615" aria-hidden="true" tabindex="-1"></a><span class="in">    data = pred, </span></span>
<span id="cb2-616"><a href="#cb2-616" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(y = Logit, color = "Logit"),</span></span>
<span id="cb2-617"><a href="#cb2-617" aria-hidden="true" tabindex="-1"></a><span class="in">    lwd = .75</span></span>
<span id="cb2-618"><a href="#cb2-618" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-619"><a href="#cb2-619" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_color_manual(</span></span>
<span id="cb2-620"><a href="#cb2-620" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "",</span></span>
<span id="cb2-621"><a href="#cb2-621" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c(</span></span>
<span id="cb2-622"><a href="#cb2-622" aria-hidden="true" tabindex="-1"></a><span class="in">      "Wahrheit" = "black",</span></span>
<span id="cb2-623"><a href="#cb2-623" aria-hidden="true" tabindex="-1"></a><span class="in">      "LPM" = "steelblue", </span></span>
<span id="cb2-624"><a href="#cb2-624" aria-hidden="true" tabindex="-1"></a><span class="in">      "Probit" = "orange",</span></span>
<span id="cb2-625"><a href="#cb2-625" aria-hidden="true" tabindex="-1"></a><span class="in">      "Logit" = "darkred"</span></span>
<span id="cb2-626"><a href="#cb2-626" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb2-627"><a href="#cb2-627" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-628"><a href="#cb2-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-629"><a href="#cb2-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-630"><a href="#cb2-630" aria-hidden="true" tabindex="-1"></a>Die Logit-Regression kann den wahren Zusammenhang gut abbilden und ist praktisch nicht von der Probit-Schätzung unterscheidbar. </span>
<span id="cb2-631"><a href="#cb2-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-632"><a href="#cb2-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-633"><a href="#cb2-633" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modellgüte</span></span>
<span id="cb2-634"><a href="#cb2-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-635"><a href="#cb2-635" aria-hidden="true" tabindex="-1"></a>Ähnlich wie bei linearer Regression kann die Anpassung von generalisierten linearen Modellen an die Daten mit Anpassungsmaßen verglichen werden. In generalisierten linearen Modellen für binäre Outcome-Variablen kann hierzu die *Deviance* verwendet werden. Für eine Schätzung anhand der Beobachtungen $i=1,\dots,n$ berechnet man die Deviance $D$ als</span>
<span id="cb2-636"><a href="#cb2-636" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-637"><a href="#cb2-637" aria-hidden="true" tabindex="-1"></a>  D = -2 \sum_{i=1}^{n} \left<span class="co">[</span><span class="ot"> y_i \cdot \log\left(\widehat{P}_i\right) + (1 - y_i) \cdot \log\left(1 - \widehat{P}_i\right) \right</span><span class="co">]</span>.</span>
<span id="cb2-638"><a href="#cb2-638" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-639"><a href="#cb2-639" aria-hidden="true" tabindex="-1"></a>$D$ quantifiziert die Abweichung eines geschätzten Modells von einem perfekt passenden Modell.^<span class="co">[</span><span class="ot">Im Allgemeinen vergleicht Deviance die Log-Likelihood des geschätzten Modells mit der Log-Likelihood des perfekten Modells.</span><span class="co">]</span> Eine geringere Deviance deutet darauf hin, dass das Modell die Daten besser erklärt. Eine R-Funktion zur Anwendung für Objekte des Typs <span class="in">`glm`</span> ist <span class="in">`deviance()`</span>.</span>
<span id="cb2-640"><a href="#cb2-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-643"><a href="#cb2-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-644"><a href="#cb2-644" aria-hidden="true" tabindex="-1"></a><span class="in"># Deviance berechnen</span></span>
<span id="cb2-645"><a href="#cb2-645" aria-hidden="true" tabindex="-1"></a><span class="in">list(</span></span>
<span id="cb2-646"><a href="#cb2-646" aria-hidden="true" tabindex="-1"></a><span class="in">  "Probit" = mod_probit, </span></span>
<span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a><span class="in">  "Logit" = mod_logit</span></span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;% </span></span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a><span class="in">  map_dbl(.f = deviance)</span></span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>Die Deviance für das Probit-Modell ist tatsächlich etwas geringer als für das Logit-Modell. </span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>Ähnlich wie $R^2$ für lineare Regression misst die Deviance $D$ lediglich die Anpassung des Modells an die beobachteten Daten. Daher eignet sich $D$ nur bedingt als Maß zur Einschätzung der Tauglichkeit eines Modells für Out-of-sample-Vorhersagen. Je nach Ziel der Modellierung kann es hilfreich sein, eine robuste Einschätzung der Vorhersage-Güte unter Berücksichtigung der Modellkomplexität vorzunehmen. Hierfür werden oft Informationskriterien verwendet. Das Akaike-Informationskriterium (AIC) </span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>  \text{AIC} = 2k - 2 \log(\widehat{\mathcal{L}})</span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a>ist ein Maß zur Bewertung der Güte eines Modells unter Berücksichtigung der Modellkomplexität. Das AIC wägt die Anpassung des Modells an die Daten (gemessen durch die maximierte Likelihood-Funktion $\widehat{\mathcal{L}}$^<span class="co">[</span><span class="ot">$\widehat{\mathcal{L}}$ meint die Likelihood-Funktion für die geschätzen Koeffizienten.</span><span class="co">]</span>) und die Komplexität (gemessen als Funktion der Regressoranzahl $k$) gegeneinander ab. Hierbei werden Modelle mit weniger Parametern bevorzugt, wenn sie die Daten ähnlich gut erklären, sodass eine Überanpassung und damit eine schlechte Vorhersage-Fähigkeit vermieden werden. In R können wir das AIC für Modell-Objekte mit <span class="in">`AIC()`</span> berechnen. </span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a><span class="in"># AIC berechnen</span></span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a><span class="in">list(</span></span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a><span class="in">  Probit = mod_probit, </span></span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a><span class="in">  Logit = mod_logit</span></span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;% </span></span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a><span class="in">  map_dbl(.f = AIC)</span></span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>Auch das AIC zeigt an, dass die Schätzung des Probit-Modells in <span class="in">`mod_probit`</span> besser geeignet für die Modiellierung von <span class="in">`simdata`</span> ist als das Logit-Modell <span class="in">`mod_logit`</span>.</span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a><span class="fu">### Beispiel: Klassifikation von Palmer-Piniguinen</span></span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a>Anhand der in diesem Kapitel betrachteten Methoden können wir Modelle zur Klassifikation von Pinguinen in <span class="in">`palmerpenguins::penguins`</span> hinsichtlich ihres Geschlechts konstruieren. Hierfür nutzen wir den bereinigten Datensatz <span class="in">`penguins_cleaned`</span> und transformieren zunächst die abhängige Variable <span class="in">`sex`</span> in ein numerisches Format.</span>
<span id="cb2-676"><a href="#cb2-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-679"><a href="#cb2-679" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-680"><a href="#cb2-680" aria-hidden="true" tabindex="-1"></a><span class="in"># 'sex' transformieren</span></span>
<span id="cb2-681"><a href="#cb2-681" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_cleaned &lt;- penguins_cleaned %&gt;% </span></span>
<span id="cb2-682"><a href="#cb2-682" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb2-683"><a href="#cb2-683" aria-hidden="true" tabindex="-1"></a><span class="in">    # sex in 0,1-codierte Variable umwandeln</span></span>
<span id="cb2-684"><a href="#cb2-684" aria-hidden="true" tabindex="-1"></a><span class="in">    sex = if_else(sex == "female", 1, 0)</span></span>
<span id="cb2-685"><a href="#cb2-685" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb2-686"><a href="#cb2-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-687"><a href="#cb2-687" aria-hidden="true" tabindex="-1"></a><span class="in"># Überprüfen</span></span>
<span id="cb2-688"><a href="#cb2-688" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_cleaned %&gt;%</span></span>
<span id="cb2-689"><a href="#cb2-689" aria-hidden="true" tabindex="-1"></a><span class="in">  select(sex) %&gt;%</span></span>
<span id="cb2-690"><a href="#cb2-690" aria-hidden="true" tabindex="-1"></a><span class="in">  slice_head(n = 10)</span></span>
<span id="cb2-691"><a href="#cb2-691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-692"><a href="#cb2-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-693"><a href="#cb2-693" aria-hidden="true" tabindex="-1"></a>Wir schätznen nachfolgend ein lineares Wahrscheinlichkeitsmodell <span class="in">`penguins_lp`</span>, ein Probit-Modell <span class="in">`penguins_probit`</span> sowie ein Logit-Modell <span class="in">`penguins_logit`</span> die jeweils <span class="in">`sex`</span> anhand der simplen Spezikation des linearen Prädiktors $$z = \beta_0 + \beta_1 \textup{bill<span class="sc">\_</span>depth}$$ erklären.</span>
<span id="cb2-694"><a href="#cb2-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-697"><a href="#cb2-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-698"><a href="#cb2-698" aria-hidden="true" tabindex="-1"></a><span class="in"># Lineares Modell</span></span>
<span id="cb2-699"><a href="#cb2-699" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_lp &lt;- lm(</span></span>
<span id="cb2-700"><a href="#cb2-700" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = sex ~ bill_depth, </span></span>
<span id="cb2-701"><a href="#cb2-701" aria-hidden="true" tabindex="-1"></a><span class="in">  data = penguins_cleaned</span></span>
<span id="cb2-702"><a href="#cb2-702" aria-hidden="true" tabindex="-1"></a><span class="in">) </span></span>
<span id="cb2-703"><a href="#cb2-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-704"><a href="#cb2-704" aria-hidden="true" tabindex="-1"></a><span class="in"># Robuste Zusammenfassung</span></span>
<span id="cb2-705"><a href="#cb2-705" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_lp %&gt;%</span></span>
<span id="cb2-706"><a href="#cb2-706" aria-hidden="true" tabindex="-1"></a><span class="in">  coeftest(vcov = vcovHC, type = "HC1") %&gt;%</span></span>
<span id="cb2-707"><a href="#cb2-707" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy()</span></span>
<span id="cb2-708"><a href="#cb2-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-709"><a href="#cb2-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-712"><a href="#cb2-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-713"><a href="#cb2-713" aria-hidden="true" tabindex="-1"></a><span class="in"># Probit-Modell</span></span>
<span id="cb2-714"><a href="#cb2-714" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_probit &lt;- glm(</span></span>
<span id="cb2-715"><a href="#cb2-715" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = sex ~ bill_depth, </span></span>
<span id="cb2-716"><a href="#cb2-716" aria-hidden="true" tabindex="-1"></a><span class="in">  data = penguins_cleaned, </span></span>
<span id="cb2-717"><a href="#cb2-717" aria-hidden="true" tabindex="-1"></a><span class="in">  family = binomial("probit")</span></span>
<span id="cb2-718"><a href="#cb2-718" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-719"><a href="#cb2-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-720"><a href="#cb2-720" aria-hidden="true" tabindex="-1"></a><span class="in"># Robuste Zusammenfassung</span></span>
<span id="cb2-721"><a href="#cb2-721" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_probit %&gt;% </span></span>
<span id="cb2-722"><a href="#cb2-722" aria-hidden="true" tabindex="-1"></a><span class="in">    coeftest(vcov = vcovHC, type = "HC1") %&gt;%</span></span>
<span id="cb2-723"><a href="#cb2-723" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy()</span></span>
<span id="cb2-724"><a href="#cb2-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-725"><a href="#cb2-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-728"><a href="#cb2-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-729"><a href="#cb2-729" aria-hidden="true" tabindex="-1"></a><span class="in"># Logit-Modell</span></span>
<span id="cb2-730"><a href="#cb2-730" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_logit &lt;- glm(</span></span>
<span id="cb2-731"><a href="#cb2-731" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = sex ~ bill_depth, </span></span>
<span id="cb2-732"><a href="#cb2-732" aria-hidden="true" tabindex="-1"></a><span class="in">  data = penguins_cleaned, </span></span>
<span id="cb2-733"><a href="#cb2-733" aria-hidden="true" tabindex="-1"></a><span class="in">  family = binomial("logit")</span></span>
<span id="cb2-734"><a href="#cb2-734" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-735"><a href="#cb2-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-736"><a href="#cb2-736" aria-hidden="true" tabindex="-1"></a><span class="in"># Robuste Zusammenfassung</span></span>
<span id="cb2-737"><a href="#cb2-737" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_logit %&gt;% </span></span>
<span id="cb2-738"><a href="#cb2-738" aria-hidden="true" tabindex="-1"></a><span class="in">  coeftest(vcov = vcovHC, type = "HC1") %&gt;%</span></span>
<span id="cb2-739"><a href="#cb2-739" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy()</span></span>
<span id="cb2-740"><a href="#cb2-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-741"><a href="#cb2-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-742"><a href="#cb2-742" aria-hidden="true" tabindex="-1"></a>Mit <span class="in">`modelsummary::modelsummary()`</span> können wir die wichtigsten Ergebnisse der Regressionen in einer pubplikationsfähigen Tabelle darstellen. Hierzu übergeben wir dem Argument <span class="in">`models`</span> eine (benannte) Liste der geschätzten Modelle. Bei Angabe von <span class="in">`vcov = "HC1"`</span> werden robuste Standardfehler ausgegeben.</span>
<span id="cb2-743"><a href="#cb2-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-746"><a href="#cb2-746" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-747"><a href="#cb2-747" aria-hidden="true" tabindex="-1"></a><span class="in">library(modelsummary)</span></span>
<span id="cb2-748"><a href="#cb2-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-749"><a href="#cb2-749" aria-hidden="true" tabindex="-1"></a><span class="in"># Geschätzte Modelle</span></span>
<span id="cb2-750"><a href="#cb2-750" aria-hidden="true" tabindex="-1"></a><span class="in">modelsummary(</span></span>
<span id="cb2-751"><a href="#cb2-751" aria-hidden="true" tabindex="-1"></a><span class="in">  models = </span></span>
<span id="cb2-752"><a href="#cb2-752" aria-hidden="true" tabindex="-1"></a><span class="in">    list(</span></span>
<span id="cb2-753"><a href="#cb2-753" aria-hidden="true" tabindex="-1"></a><span class="in">      "LPM" = penguins_lp,</span></span>
<span id="cb2-754"><a href="#cb2-754" aria-hidden="true" tabindex="-1"></a><span class="in">      "Probit" = penguins_probit,</span></span>
<span id="cb2-755"><a href="#cb2-755" aria-hidden="true" tabindex="-1"></a><span class="in">      "Logit" = penguins_logit</span></span>
<span id="cb2-756"><a href="#cb2-756" aria-hidden="true" tabindex="-1"></a><span class="in">    ), </span></span>
<span id="cb2-757"><a href="#cb2-757" aria-hidden="true" tabindex="-1"></a><span class="in">  output = "gt", </span></span>
<span id="cb2-758"><a href="#cb2-758" aria-hidden="true" tabindex="-1"></a><span class="in">  vcov = "HC1", </span></span>
<span id="cb2-759"><a href="#cb2-759" aria-hidden="true" tabindex="-1"></a><span class="in">  stars = TRUE, </span></span>
<span id="cb2-760"><a href="#cb2-760" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb2-761"><a href="#cb2-761" aria-hidden="true" tabindex="-1"></a><span class="in">  tabopts() %&gt;%</span></span>
<span id="cb2-762"><a href="#cb2-762" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(</span></span>
<span id="cb2-763"><a href="#cb2-763" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Modelle für Geschlecht v. Pinguinen",</span></span>
<span id="cb2-764"><a href="#cb2-764" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-765"><a href="#cb2-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-766"><a href="#cb2-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-767"><a href="#cb2-767" aria-hidden="true" tabindex="-1"></a>Die geschätzten negativen und signifikanten Koeffizienten von $\textup{bill<span class="sc">\_</span>depth}$ erfassen den Zusammenhang, dass Pinguine mit größeren Schnäbeln tendenziell männlich sind: Je größer $\textup{bill<span class="sc">\_</span>depth}$, desto geringer die geschätzte Wahrscheinlichkeit, dass ein Pinguin weiblich ist. Ein Vergleich anhand des AIC zeigt, dass das Probit-Modell <span class="in">`penguins_probit`</span> am besten geeignet ist.</span>
<span id="cb2-768"><a href="#cb2-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-769"><a href="#cb2-769" aria-hidden="true" tabindex="-1"></a>Analog zur Vorgehensweise in @sec-logreg können wir die geschätzten Modelle vergleichen, in dem wir geschätzte Wahrscheinlichkeiten $P(Y=\textup{weiblich}\vert\textup{bill<span class="sc">\_</span>depth})$ für eine Menge repräsentativer Werte des Regressors <span class="in">`bill_depth`</span> berechnen und gemeinsam mit den Beobachtungen plotten.</span>
<span id="cb2-770"><a href="#cb2-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-773"><a href="#cb2-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-774"><a href="#cb2-774" aria-hidden="true" tabindex="-1"></a><span class="in"># Sequenz für bill_depth erstellen</span></span>
<span id="cb2-775"><a href="#cb2-775" aria-hidden="true" tabindex="-1"></a><span class="in">bill_depth_new &lt;- seq(</span></span>
<span id="cb2-776"><a href="#cb2-776" aria-hidden="true" tabindex="-1"></a><span class="in">  from = min(penguins_cleaned$bill_depth), </span></span>
<span id="cb2-777"><a href="#cb2-777" aria-hidden="true" tabindex="-1"></a><span class="in">  to = max(penguins_cleaned$bill_depth), </span></span>
<span id="cb2-778"><a href="#cb2-778" aria-hidden="true" tabindex="-1"></a><span class="in">  by = .1</span></span>
<span id="cb2-779"><a href="#cb2-779" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-780"><a href="#cb2-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-781"><a href="#cb2-781" aria-hidden="true" tabindex="-1"></a><span class="in"># Vorhersagen WSK mit 'bill_depth_new'</span></span>
<span id="cb2-782"><a href="#cb2-782" aria-hidden="true" tabindex="-1"></a><span class="in">preds &lt;- tibble(</span></span>
<span id="cb2-783"><a href="#cb2-783" aria-hidden="true" tabindex="-1"></a><span class="in">  bill_depth = bill_depth_new,</span></span>
<span id="cb2-784"><a href="#cb2-784" aria-hidden="true" tabindex="-1"></a><span class="in">  lp = predict(</span></span>
<span id="cb2-785"><a href="#cb2-785" aria-hidden="true" tabindex="-1"></a><span class="in">    object = penguins_lp, </span></span>
<span id="cb2-786"><a href="#cb2-786" aria-hidden="true" tabindex="-1"></a><span class="in">    newdata = tibble(bill_depth = bill_depth_new)</span></span>
<span id="cb2-787"><a href="#cb2-787" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb2-788"><a href="#cb2-788" aria-hidden="true" tabindex="-1"></a><span class="in">  probit = predict(</span></span>
<span id="cb2-789"><a href="#cb2-789" aria-hidden="true" tabindex="-1"></a><span class="in">    object = penguins_probit,</span></span>
<span id="cb2-790"><a href="#cb2-790" aria-hidden="true" tabindex="-1"></a><span class="in">    newdata = tibble(bill_depth = bill_depth_new),</span></span>
<span id="cb2-791"><a href="#cb2-791" aria-hidden="true" tabindex="-1"></a><span class="in">    type = "response"</span></span>
<span id="cb2-792"><a href="#cb2-792" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb2-793"><a href="#cb2-793" aria-hidden="true" tabindex="-1"></a><span class="in">  logit = predict(</span></span>
<span id="cb2-794"><a href="#cb2-794" aria-hidden="true" tabindex="-1"></a><span class="in">    object = penguins_logit,</span></span>
<span id="cb2-795"><a href="#cb2-795" aria-hidden="true" tabindex="-1"></a><span class="in">    newdata = tibble(bill_depth = bill_depth_new),</span></span>
<span id="cb2-796"><a href="#cb2-796" aria-hidden="true" tabindex="-1"></a><span class="in">    type = "response"</span></span>
<span id="cb2-797"><a href="#cb2-797" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-798"><a href="#cb2-798" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-799"><a href="#cb2-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-800"><a href="#cb2-800" aria-hidden="true" tabindex="-1"></a><span class="in"># Prüfen:</span></span>
<span id="cb2-801"><a href="#cb2-801" aria-hidden="true" tabindex="-1"></a><span class="in">slice_head(preds, n = 10)</span></span>
<span id="cb2-802"><a href="#cb2-802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-803"><a href="#cb2-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-806"><a href="#cb2-806" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-807"><a href="#cb2-807" aria-hidden="true" tabindex="-1"></a><span class="in"># Geschätzte bedingte WSK plotten</span></span>
<span id="cb2-808"><a href="#cb2-808" aria-hidden="true" tabindex="-1"></a><span class="in">penguins_cleaned %&gt;%</span></span>
<span id="cb2-809"><a href="#cb2-809" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(</span></span>
<span id="cb2-810"><a href="#cb2-810" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(x = bill_depth, y = sex)</span></span>
<span id="cb2-811"><a href="#cb2-811" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-812"><a href="#cb2-812" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(</span></span>
<span id="cb2-813"><a href="#cb2-813" aria-hidden="true" tabindex="-1"></a><span class="in">    position = position_jitter(</span></span>
<span id="cb2-814"><a href="#cb2-814" aria-hidden="true" tabindex="-1"></a><span class="in">      height = .025,</span></span>
<span id="cb2-815"><a href="#cb2-815" aria-hidden="true" tabindex="-1"></a><span class="in">      seed = 1234</span></span>
<span id="cb2-816"><a href="#cb2-816" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb2-817"><a href="#cb2-817" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = .25,</span></span>
<span id="cb2-818"><a href="#cb2-818" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "blue"</span></span>
<span id="cb2-819"><a href="#cb2-819" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-820"><a href="#cb2-820" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(</span></span>
<span id="cb2-821"><a href="#cb2-821" aria-hidden="true" tabindex="-1"></a><span class="in">    data = preds, </span></span>
<span id="cb2-822"><a href="#cb2-822" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(y = lp, color = "LPM")</span></span>
<span id="cb2-823"><a href="#cb2-823" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-824"><a href="#cb2-824" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(</span></span>
<span id="cb2-825"><a href="#cb2-825" aria-hidden="true" tabindex="-1"></a><span class="in">    data = preds, </span></span>
<span id="cb2-826"><a href="#cb2-826" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(y = probit, color = "Probit")</span></span>
<span id="cb2-827"><a href="#cb2-827" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-828"><a href="#cb2-828" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(</span></span>
<span id="cb2-829"><a href="#cb2-829" aria-hidden="true" tabindex="-1"></a><span class="in">    data = preds, </span></span>
<span id="cb2-830"><a href="#cb2-830" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(y = logit, color = "Logit")</span></span>
<span id="cb2-831"><a href="#cb2-831" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-832"><a href="#cb2-832" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb2-833"><a href="#cb2-833" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "Modelle",</span></span>
<span id="cb2-834"><a href="#cb2-834" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c(</span></span>
<span id="cb2-835"><a href="#cb2-835" aria-hidden="true" tabindex="-1"></a><span class="in">      "LPM" = "steelblue", </span></span>
<span id="cb2-836"><a href="#cb2-836" aria-hidden="true" tabindex="-1"></a><span class="in">      "Probit" = "orange",</span></span>
<span id="cb2-837"><a href="#cb2-837" aria-hidden="true" tabindex="-1"></a><span class="in">      "Logit" = "darkred"</span></span>
<span id="cb2-838"><a href="#cb2-838" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb2-839"><a href="#cb2-839" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-840"><a href="#cb2-840" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Modellierung v. Pinguin-Geschlecht mit Regression") +</span></span>
<span id="cb2-841"><a href="#cb2-841" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_cowplot() +</span></span>
<span id="cb2-842"><a href="#cb2-842" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top")</span></span>
<span id="cb2-843"><a href="#cb2-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-844"><a href="#cb2-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-845"><a href="#cb2-845" aria-hidden="true" tabindex="-1"></a>Die geschätzten Regressionsfunktionen unterscheiden sich für den Bereich beobachteter Werte von $bill<span class="sc">\_</span>depth$ nur wenig. Die Grafik zeigt, dass die Schätzungen mit Probit- und Logit-Ansatz nur wenig Nicht-Linearität aufweisen, sodass eine (leichter interpretierbare) Modellierung mit dem linearen Wahrscheinlichkeitsmodell <span class="in">`penguins_lp`</span> hier zulässig scheint.</span>
<span id="cb2-846"><a href="#cb2-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-847"><a href="#cb2-847" aria-hidden="true" tabindex="-1"></a>Die Klassifizierung der Pinguine im Datensatz hinsichtlich ihres Geschlechts anhand vorhergesagter Wahrscheinlichkeiten $\widehat{P}_i$ kann durch Abgleich mit einem Grenzwert erfolgen. Ein Beispiel ist</span>
<span id="cb2-848"><a href="#cb2-848" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-849"><a href="#cb2-849" aria-hidden="true" tabindex="-1"></a>  \widehat{Y}_i = \begin{cases}</span>
<span id="cb2-850"><a href="#cb2-850" aria-hidden="true" tabindex="-1"></a>    \textup{weiblich}, &amp; \widehat{P}_i \geq .5,<span class="sc">\\</span></span>
<span id="cb2-851"><a href="#cb2-851" aria-hidden="true" tabindex="-1"></a>    \textup{männlich}, &amp; \textup{sonst.}</span>
<span id="cb2-852"><a href="#cb2-852" aria-hidden="true" tabindex="-1"></a>  \end{cases}\label{eq:pengclass}</span>
<span id="cb2-853"><a href="#cb2-853" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-854"><a href="#cb2-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-855"><a href="#cb2-855" aria-hidden="true" tabindex="-1"></a>Wir können diesen Ansatz in R implementieren, indem wir zunächst die für den Datensatz angepassten Wahrscheinlichkeiten <span class="in">`fitted`</span> aus den Modell-Objekten auslesen.</span>
<span id="cb2-856"><a href="#cb2-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-859"><a href="#cb2-859" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-860"><a href="#cb2-860" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb2-861"><a href="#cb2-861" aria-hidden="true" tabindex="-1"></a><span class="in">  WSK &lt;- penguins_cleaned %&gt;%</span></span>
<span id="cb2-862"><a href="#cb2-862" aria-hidden="true" tabindex="-1"></a><span class="in">  select(sex) %&gt;%</span></span>
<span id="cb2-863"><a href="#cb2-863" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb2-864"><a href="#cb2-864" aria-hidden="true" tabindex="-1"></a><span class="in">    list(</span></span>
<span id="cb2-865"><a href="#cb2-865" aria-hidden="true" tabindex="-1"></a><span class="in">      linear = penguins_lp, </span></span>
<span id="cb2-866"><a href="#cb2-866" aria-hidden="true" tabindex="-1"></a><span class="in">      probit = penguins_probit,</span></span>
<span id="cb2-867"><a href="#cb2-867" aria-hidden="true" tabindex="-1"></a><span class="in">      logit = penguins_logit</span></span>
<span id="cb2-868"><a href="#cb2-868" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;% </span></span>
<span id="cb2-869"><a href="#cb2-869" aria-hidden="true" tabindex="-1"></a><span class="in">      map_dfc(.f = ~ .$fitted)     </span></span>
<span id="cb2-870"><a href="#cb2-870" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-871"><a href="#cb2-871" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-872"><a href="#cb2-872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-873"><a href="#cb2-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-874"><a href="#cb2-874" aria-hidden="true" tabindex="-1"></a>Für die Klassifikation der Pinguine anhand der jeweiligen geschätzten Wahrscheinlichkeiten wenden wir die Regel \eqref{eq:pengclass} mit <span class="in">`across()`</span> spaltenweise für die Modelle an und erzeugen neue Spalten mit vorhersagen des Geschlechts. Mit <span class="in">`.names = "{.col}_pred"`</span> erhalten die neuen Spalten das Suffix <span class="in">`_pred`</span>.</span>
<span id="cb2-875"><a href="#cb2-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-878"><a href="#cb2-878" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-879"><a href="#cb2-879" aria-hidden="true" tabindex="-1"></a><span class="in"># Klassifikation f. Geschlecht durchführen</span></span>
<span id="cb2-880"><a href="#cb2-880" aria-hidden="true" tabindex="-1"></a><span class="in">vorh &lt;- WSK %&gt;%</span></span>
<span id="cb2-881"><a href="#cb2-881" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb2-882"><a href="#cb2-882" aria-hidden="true" tabindex="-1"></a><span class="in">    across(</span></span>
<span id="cb2-883"><a href="#cb2-883" aria-hidden="true" tabindex="-1"></a><span class="in">      c(linear:logit), </span></span>
<span id="cb2-884"><a href="#cb2-884" aria-hidden="true" tabindex="-1"></a><span class="in">      .fns = ~ (. &gt; 0.5) == sex,</span></span>
<span id="cb2-885"><a href="#cb2-885" aria-hidden="true" tabindex="-1"></a><span class="in">      .names = "{.col}_pred")</span></span>
<span id="cb2-886"><a href="#cb2-886" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb2-887"><a href="#cb2-887" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-888"><a href="#cb2-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-889"><a href="#cb2-889" aria-hidden="true" tabindex="-1"></a>Mit <span class="in">`summarise()`</span> berechnen wir nun den Anteil korrekter Vorhersagen.</span>
<span id="cb2-890"><a href="#cb2-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-893"><a href="#cb2-893" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-894"><a href="#cb2-894" aria-hidden="true" tabindex="-1"></a><span class="in"># Genauigkeit der Vorhersage berechnen</span></span>
<span id="cb2-895"><a href="#cb2-895" aria-hidden="true" tabindex="-1"></a><span class="in">vorh %&gt;% </span></span>
<span id="cb2-896"><a href="#cb2-896" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb2-897"><a href="#cb2-897" aria-hidden="true" tabindex="-1"></a><span class="in">    across(linear_pred:logit_pred, mean)</span></span>
<span id="cb2-898"><a href="#cb2-898" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-899"><a href="#cb2-899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-900"><a href="#cb2-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-901"><a href="#cb2-901" aria-hidden="true" tabindex="-1"></a>In diesem Beispiel unterscheiden sich die Vorhersagen der drei Modelle für den Grenzwert 0.5 nicht.</span>
<span id="cb2-902"><a href="#cb2-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-903"><a href="#cb2-903" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modellierung von Zählvariablen {#sec-poissonreg}</span></span>
<span id="cb2-904"><a href="#cb2-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-905"><a href="#cb2-905" aria-hidden="true" tabindex="-1"></a>Eine weitere Klasse von $Y$ für die sich der Regressionsansatz von einfacher linearer Regression unterscheidet, sind *Zählvariablen*: Variablen, die diskrete, nicht-negative Werte annehmen. Wenn die abhängige Variable $Y$ Ereignisse in einem bestimmten Zeitraum misst (wie z.B. die Anzahl der Verkehrsunfälle in Essen innerhalb eines Monats) und weitere Bedingungen erfüllt sind, folgt $Y$ einer Poisson-Verteilung und kann mit Poisson-Regression modelliert werden. Wir erläutern nachfolgend die wesentlichen Komponenten von Poisson-Regression und diskutieren ein R-Beispiel mit fiktiven Daten.</span>
<span id="cb2-906"><a href="#cb2-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-907"><a href="#cb2-907" aria-hidden="true" tabindex="-1"></a><span class="fu">### Poisson-Verteilung</span></span>
<span id="cb2-908"><a href="#cb2-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-909"><a href="#cb2-909" aria-hidden="true" tabindex="-1"></a>Die Zufallsvariable $Y$ folgt einer Poisson-Verteilung mit Parameter $\lambda$, wenn:</span>
<span id="cb2-910"><a href="#cb2-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-911"><a href="#cb2-911" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Ereignisse unabhängig voneinander auftreten:** Das Auftreten eines Ereignisses beeinflusst nicht die Wahrscheinlichkeit, dass ein weiteres Ereignis auftritt.</span>
<span id="cb2-912"><a href="#cb2-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-913"><a href="#cb2-913" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Ereignisse einzeln auftreten:** Die Wahrscheinlichkeit, dass in einem sehr kleinen Intervall (im Sinne von $<span class="co">[</span><span class="ot">a,b</span><span class="co">]</span>$ für $a \to b$) mehr als ein Ereignis auftritt, ist vernachlässigbar.</span>
<span id="cb2-914"><a href="#cb2-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-915"><a href="#cb2-915" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**die Rate der Ereignisse konstant ist:** Die durchschnittliche Anzahl der Ereignisse pro Zeiteinheit oder pro Raumeinheit $\lambda$ ist konstant.</span>
<span id="cb2-916"><a href="#cb2-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-917"><a href="#cb2-917" aria-hidden="true" tabindex="-1"></a>Die Wahrscheinlichkeitsfunktion von $Y$ ist</span>
<span id="cb2-918"><a href="#cb2-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-919"><a href="#cb2-919" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-920"><a href="#cb2-920" aria-hidden="true" tabindex="-1"></a>P(Y = y) = \frac{\lambda^y e^{-\lambda}}{y!} \quad \text{für} \quad y = 0, 1, 2, \ldots,\label{eq:poissonpmf}</span>
<span id="cb2-921"><a href="#cb2-921" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-922"><a href="#cb2-922" aria-hidden="true" tabindex="-1"></a>wobei $\lambda$ sowohl der Erwartungswert als auch die Varianz der Verteilung ist, $$\textup{E}(Y) = \textup{Var}(Y) = \lambda.$$</span>
<span id="cb2-923"><a href="#cb2-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-924"><a href="#cb2-924" aria-hidden="true" tabindex="-1"></a>Die nächste Grafik zeigt die diskrete (Wahrscheinlichkeitsmasse-)Funktion \eqref{eq:poissonpmf} für eine Poisson-verteilte Zufallsvariable $Y$ mit $\lambda = 5$ für den Wertebereich von 0 bis 15.</span>
<span id="cb2-925"><a href="#cb2-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-928"><a href="#cb2-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-929"><a href="#cb2-929" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-poissondensity</span></span>
<span id="cb2-930"><a href="#cb2-930" aria-hidden="true" tabindex="-1"></a><span class="in">tibble(</span></span>
<span id="cb2-931"><a href="#cb2-931" aria-hidden="true" tabindex="-1"></a><span class="in">    x = 0:15,</span></span>
<span id="cb2-932"><a href="#cb2-932" aria-hidden="true" tabindex="-1"></a><span class="in">    dens = dpois(x, lambda = 5)</span></span>
<span id="cb2-933"><a href="#cb2-933" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb2-934"><a href="#cb2-934" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb2-935"><a href="#cb2-935" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot( </span></span>
<span id="cb2-936"><a href="#cb2-936" aria-hidden="true" tabindex="-1"></a><span class="in">        mapping = aes(x = x, y = dens)</span></span>
<span id="cb2-937"><a href="#cb2-937" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb2-938"><a href="#cb2-938" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(</span></span>
<span id="cb2-939"><a href="#cb2-939" aria-hidden="true" tabindex="-1"></a><span class="in">      stat = "identity", </span></span>
<span id="cb2-940"><a href="#cb2-940" aria-hidden="true" tabindex="-1"></a><span class="in">      fill = "steelblue",</span></span>
<span id="cb2-941"><a href="#cb2-941" aria-hidden="true" tabindex="-1"></a><span class="in">      color = "white"</span></span>
<span id="cb2-942"><a href="#cb2-942" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb2-943"><a href="#cb2-943" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_continuous(breaks = 0:15) + </span></span>
<span id="cb2-944"><a href="#cb2-944" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(</span></span>
<span id="cb2-945"><a href="#cb2-945" aria-hidden="true" tabindex="-1"></a><span class="in">        title = "Poisson-Dichtefunktion für lambda = 5", </span></span>
<span id="cb2-946"><a href="#cb2-946" aria-hidden="true" tabindex="-1"></a><span class="in">        y = "Dichte"</span></span>
<span id="cb2-947"><a href="#cb2-947" aria-hidden="true" tabindex="-1"></a><span class="in">    ) +</span></span>
<span id="cb2-948"><a href="#cb2-948" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_cowplot()</span></span>
<span id="cb2-949"><a href="#cb2-949" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-950"><a href="#cb2-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-951"><a href="#cb2-951" aria-hidden="true" tabindex="-1"></a><span class="fu">### Poisson-Regression</span></span>
<span id="cb2-952"><a href="#cb2-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-953"><a href="#cb2-953" aria-hidden="true" tabindex="-1"></a>Wie für die bisher betrachteten Regressionsansätzen modelliert Poisson-Regression den Erwartungswert (und damit gleichzeitig die Varianz) $\lambda$ der abhängigen Variable $Y$ als eine Funktion der Regressoren $\mathbf{X} = (X_1, X_2, \ldots, X_k)$. Unter Annahme einer Poisson-Verteilung kann Poisson-Regression als generalisiertes lineares Modell verstanden werden, wobei eine logarithmische Verknüpfungsfunktion für den linearen Prädiktor $\mathbf{X}_i^\top \boldsymbol{\beta}$ verwendet wird:</span>
<span id="cb2-954"><a href="#cb2-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-955"><a href="#cb2-955" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-956"><a href="#cb2-956" aria-hidden="true" tabindex="-1"></a>\log(\lambda_i) &amp;= \mathbf{X}_i^\top \boldsymbol{\beta},</span>
<span id="cb2-957"><a href="#cb2-957" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-958"><a href="#cb2-958" aria-hidden="true" tabindex="-1"></a>sodass</span>
<span id="cb2-959"><a href="#cb2-959" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-960"><a href="#cb2-960" aria-hidden="true" tabindex="-1"></a>\lambda_i &amp;= \exp(\mathbf{X}_i^\top \boldsymbol{\beta}),</span>
<span id="cb2-961"><a href="#cb2-961" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-962"><a href="#cb2-962" aria-hidden="true" tabindex="-1"></a>wobei</span>
<span id="cb2-963"><a href="#cb2-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-964"><a href="#cb2-964" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\lambda_i = \textup{E}(Y_i\vert \mathbf{X}_i) = \textup{Var}(Y_i\vert \mathbf{X}_i)$ für Beobachtung $i$,</span>
<span id="cb2-965"><a href="#cb2-965" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mathbf{X}_i$ der Vektor der unabhängigen Variablen für Beobachtung $i$ ist, und</span>
<span id="cb2-966"><a href="#cb2-966" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\boldsymbol{\beta}$ der Vektor der Regressionskoeffizienten ist.</span>
<span id="cb2-967"><a href="#cb2-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-968"><a href="#cb2-968" aria-hidden="true" tabindex="-1"></a><span class="fu">### Schätzung</span></span>
<span id="cb2-969"><a href="#cb2-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-970"><a href="#cb2-970" aria-hidden="true" tabindex="-1"></a>Die Likelihood-Funktion für $n$ Beobachtungen ist </span>
<span id="cb2-971"><a href="#cb2-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-972"><a href="#cb2-972" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-973"><a href="#cb2-973" aria-hidden="true" tabindex="-1"></a>L(\boldsymbol{\beta}) = \prod_{i=1}^n \frac{\lambda_i^{y_i} e^{-\lambda_i}}{y_i!}.</span>
<span id="cb2-974"><a href="#cb2-974" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-975"><a href="#cb2-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-976"><a href="#cb2-976" aria-hidden="true" tabindex="-1"></a>Die Log-Likelihood-Funktion ist daher</span>
<span id="cb2-977"><a href="#cb2-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-978"><a href="#cb2-978" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-979"><a href="#cb2-979" aria-hidden="true" tabindex="-1"></a>\mathcal{L}(\boldsymbol{\beta}) = \sum_{i=1}^n \left( y_i \log(\lambda_i) - \lambda_i - \log(y_i!). \right)</span>
<span id="cb2-980"><a href="#cb2-980" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-981"><a href="#cb2-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-982"><a href="#cb2-982" aria-hidden="true" tabindex="-1"></a>Da $\lambda_i = \exp(\mathbf{X}_i^\top \boldsymbol{\beta})$, wird die Log-Likelihood-Funktion zu</span>
<span id="cb2-983"><a href="#cb2-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-984"><a href="#cb2-984" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb2-985"><a href="#cb2-985" aria-hidden="true" tabindex="-1"></a>\mathcal{L}(\boldsymbol{\beta}) = \sum_{i=1}^n \left( y_i (\mathbf{X}_i^\top \boldsymbol{\beta}) - \exp(\mathbf{X}_i^\top \boldsymbol{\beta}) - \log(y_i!) \right)</span>
<span id="cb2-986"><a href="#cb2-986" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb2-987"><a href="#cb2-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-988"><a href="#cb2-988" aria-hidden="true" tabindex="-1"></a>Den ML-Schätzer $\widehat{\boldsymbol{\beta}}$ erhalten wir durch Maximierung der Log-Likelihoodfunktion $\mathcal{L}(\boldsymbol{\beta})$. Die R-Implementierung von Poisson-Regression in <span class="in">`stats::glm()`</span> wird mit <span class="in">`family = poisson(link = "log")`</span></span>
<span id="cb2-989"><a href="#cb2-989" aria-hidden="true" tabindex="-1"></a>aufgerufen.</span>
<span id="cb2-990"><a href="#cb2-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-991"><a href="#cb2-991" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpretation der Koeffizienten</span></span>
<span id="cb2-992"><a href="#cb2-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-993"><a href="#cb2-993" aria-hidden="true" tabindex="-1"></a>Die Koeffizienten $\boldsymbol{\beta}$ in der Poisson-Regression haben eine log-lineare Beziehung zur Zählvariable. Für einen bestimmten Koeffizienten $\beta_j$ ist die Interpretation wiefolgt:</span>
<span id="cb2-994"><a href="#cb2-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-995"><a href="#cb2-995" aria-hidden="true" tabindex="-1"></a>Eine Änderung der unabhängigen Variable $X_j$ um eine Einheit führt zu einer Änderung des *Logarithmus* des Erwartungswertes von $Y$ um $\beta_j$. Der Erwartungswert $\lambda$ ändert sich also *multiplikativ* um den Faktor $\exp(\beta_j)$.</span>
<span id="cb2-996"><a href="#cb2-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-997"><a href="#cb2-997" aria-hidden="true" tabindex="-1"></a>Als Beispiel betrachten wir den linearen Prädiktor</span>
<span id="cb2-998"><a href="#cb2-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-999"><a href="#cb2-999" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-1000"><a href="#cb2-1000" aria-hidden="true" tabindex="-1"></a>  \log(\lambda) = \beta_0 + \beta_1 X.</span>
<span id="cb2-1001"><a href="#cb2-1001" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-1002"><a href="#cb2-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1003"><a href="#cb2-1003" aria-hidden="true" tabindex="-1"></a>Für eine Änderung von $X$ um $\Delta X$ erhalten wir</span>
<span id="cb2-1004"><a href="#cb2-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1005"><a href="#cb2-1005" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-1006"><a href="#cb2-1006" aria-hidden="true" tabindex="-1"></a>   \lambda =&amp;\, \exp(\beta_0 + \beta_1 X) <span class="sc">\\</span></span>
<span id="cb2-1007"><a href="#cb2-1007" aria-hidden="true" tabindex="-1"></a>    \lambda + \delta\lambda =&amp;\, \exp(\beta_0 + \beta_1 (X + \Delta X)) <span class="sc">\\</span></span>
<span id="cb2-1008"><a href="#cb2-1008" aria-hidden="true" tabindex="-1"></a>    =&amp;\, \exp(\beta_0 + \beta_1 X) \cdot \exp(\beta\Delta X) <span class="sc">\\</span></span>
<span id="cb2-1009"><a href="#cb2-1009" aria-hidden="true" tabindex="-1"></a>    =&amp;\, \lambda \cdot \exp(\beta\Delta X)</span>
<span id="cb2-1010"><a href="#cb2-1010" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-1011"><a href="#cb2-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1012"><a href="#cb2-1012" aria-hidden="true" tabindex="-1"></a>Angenommen $X$ ist die Anzahl durchgeführter Werbekampagnen und die abhängige Zählvariable $Y$ misst die Anzahl der Verkäufe des beworbenen Produkts pro Monat.</span>
<span id="cb2-1013"><a href="#cb2-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1014"><a href="#cb2-1014" aria-hidden="true" tabindex="-1"></a>Wenn $\beta_1 = 0.5$, bedeutet dies, dass jede zusätzliche Werbekampagne ($\Delta X = 1$) die erwartete Anzahl der Verkäufe pro Monat um einen Faktor von $\exp(0.5) \approx 1.65$ erhöht:</span>
<span id="cb2-1015"><a href="#cb2-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1016"><a href="#cb2-1016" aria-hidden="true" tabindex="-1"></a>Das heißt, die *Rate* der Verkäufe steigt um 65\% für jede zusätzliche Werbekampagne.</span>
<span id="cb2-1017"><a href="#cb2-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1018"><a href="#cb2-1018" aria-hidden="true" tabindex="-1"></a>Zur Veranschaulichung der Schätzung einer Poisson-Regression für dieses Beispiel erzeugen wir Poisson-verteilte Daten für</span>
<span id="cb2-1019"><a href="#cb2-1019" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb2-1020"><a href="#cb2-1020" aria-hidden="true" tabindex="-1"></a>  \log(\lambda) = 2 + 0.4 \cdot X</span>
<span id="cb2-1021"><a href="#cb2-1021" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb2-1022"><a href="#cb2-1022" aria-hidden="true" tabindex="-1"></a>und ziehen $X$ gleichverteilt aus $<span class="sc">\{</span>1,2,\dots,8<span class="sc">\}</span>$.</span>
<span id="cb2-1023"><a href="#cb2-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1026"><a href="#cb2-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-1027"><a href="#cb2-1027" aria-hidden="true" tabindex="-1"></a><span class="in"># Setze den Zufallszahlengenerator für Reproduzierbarkeit</span></span>
<span id="cb2-1028"><a href="#cb2-1028" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(1234)</span></span>
<span id="cb2-1029"><a href="#cb2-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1030"><a href="#cb2-1030" aria-hidden="true" tabindex="-1"></a><span class="in"># Anzahl der Beobachtungen</span></span>
<span id="cb2-1031"><a href="#cb2-1031" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 500</span></span>
<span id="cb2-1032"><a href="#cb2-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1033"><a href="#cb2-1033" aria-hidden="true" tabindex="-1"></a><span class="in"># Züge für unabhängige Variable X (Anzahl der Werbekampagnen)</span></span>
<span id="cb2-1034"><a href="#cb2-1034" aria-hidden="true" tabindex="-1"></a><span class="in">X &lt;- sample(1:8, replace = T, size = n)</span></span>
<span id="cb2-1035"><a href="#cb2-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1036"><a href="#cb2-1036" aria-hidden="true" tabindex="-1"></a><span class="in"># Erwartungswerte</span></span>
<span id="cb2-1037"><a href="#cb2-1037" aria-hidden="true" tabindex="-1"></a><span class="in">lambda &lt;- exp(2 + 0.4 * X)</span></span>
<span id="cb2-1038"><a href="#cb2-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1039"><a href="#cb2-1039" aria-hidden="true" tabindex="-1"></a><span class="in"># Abhängige Variable Y (Anzahl der Verkäufe) als Poisson-verteilte Zufallsvariable, gegeben lambda</span></span>
<span id="cb2-1040"><a href="#cb2-1040" aria-hidden="true" tabindex="-1"></a><span class="in">Y &lt;- map_dbl(</span></span>
<span id="cb2-1041"><a href="#cb2-1041" aria-hidden="true" tabindex="-1"></a><span class="in">  .x = 1:n, </span></span>
<span id="cb2-1042"><a href="#cb2-1042" aria-hidden="true" tabindex="-1"></a><span class="in">  .f = ~ rpois(</span></span>
<span id="cb2-1043"><a href="#cb2-1043" aria-hidden="true" tabindex="-1"></a><span class="in">    n = 1, lambda = lambda[.x]</span></span>
<span id="cb2-1044"><a href="#cb2-1044" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-1045"><a href="#cb2-1045" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-1046"><a href="#cb2-1046" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb2-1047"><a href="#cb2-1047" aria-hidden="true" tabindex="-1"></a><span class="in"># Danten in tibble sammeln</span></span>
<span id="cb2-1048"><a href="#cb2-1048" aria-hidden="true" tabindex="-1"></a><span class="in">dat &lt;- tibble(</span></span>
<span id="cb2-1049"><a href="#cb2-1049" aria-hidden="true" tabindex="-1"></a><span class="in">  Kampagnen = X, </span></span>
<span id="cb2-1050"><a href="#cb2-1050" aria-hidden="true" tabindex="-1"></a><span class="in">  Verkaeufe = Y</span></span>
<span id="cb2-1051"><a href="#cb2-1051" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-1052"><a href="#cb2-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1053"><a href="#cb2-1053" aria-hidden="true" tabindex="-1"></a><span class="in"># Überblick</span></span>
<span id="cb2-1054"><a href="#cb2-1054" aria-hidden="true" tabindex="-1"></a><span class="in">slice_head(dat, n = 10)</span></span>
<span id="cb2-1055"><a href="#cb2-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-1056"><a href="#cb2-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1057"><a href="#cb2-1057" aria-hidden="true" tabindex="-1"></a>Die Züge aus der abhängigen Variablen visualieren wir mit einem Häufigkeits-Histogramm.</span>
<span id="cb2-1058"><a href="#cb2-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1061"><a href="#cb2-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-1062"><a href="#cb2-1062" aria-hidden="true" tabindex="-1"></a><span class="in"># Histogramm der Abh. Variable</span></span>
<span id="cb2-1063"><a href="#cb2-1063" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(</span></span>
<span id="cb2-1064"><a href="#cb2-1064" aria-hidden="true" tabindex="-1"></a><span class="in">  data = dat, </span></span>
<span id="cb2-1065"><a href="#cb2-1065" aria-hidden="true" tabindex="-1"></a><span class="in">  mapping = aes(x = Verkaeufe)</span></span>
<span id="cb2-1066"><a href="#cb2-1066" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-1067"><a href="#cb2-1067" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(binwidth = 2) +</span></span>
<span id="cb2-1068"><a href="#cb2-1068" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb2-1069"><a href="#cb2-1069" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Poisson-verteilte Daten"</span></span>
<span id="cb2-1070"><a href="#cb2-1070" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-1071"><a href="#cb2-1071" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_cowplot()</span></span>
<span id="cb2-1072"><a href="#cb2-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-1073"><a href="#cb2-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1074"><a href="#cb2-1074" aria-hidden="true" tabindex="-1"></a>Wir schätzen das Modell und extrahieren die robuste Zusammenfassung mit <span class="in">`broom::tidy()`</span>.</span>
<span id="cb2-1075"><a href="#cb2-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1078"><a href="#cb2-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-1079"><a href="#cb2-1079" aria-hidden="true" tabindex="-1"></a><span class="in"># Poisson-Regression schätzen</span></span>
<span id="cb2-1080"><a href="#cb2-1080" aria-hidden="true" tabindex="-1"></a><span class="in">mod_poisson &lt;- glm(</span></span>
<span id="cb2-1081"><a href="#cb2-1081" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = Verkaeufe ~ Kampagnen, </span></span>
<span id="cb2-1082"><a href="#cb2-1082" aria-hidden="true" tabindex="-1"></a><span class="in">  family = poisson(link = "log"), </span></span>
<span id="cb2-1083"><a href="#cb2-1083" aria-hidden="true" tabindex="-1"></a><span class="in">  data = dat</span></span>
<span id="cb2-1084"><a href="#cb2-1084" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-1085"><a href="#cb2-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1086"><a href="#cb2-1086" aria-hidden="true" tabindex="-1"></a><span class="in"># Zusammenfassung des gesch. Modells</span></span>
<span id="cb2-1087"><a href="#cb2-1087" aria-hidden="true" tabindex="-1"></a><span class="in">mod_poisson %&gt;%</span></span>
<span id="cb2-1088"><a href="#cb2-1088" aria-hidden="true" tabindex="-1"></a><span class="in">  coeftest(vcov = vcovHC, type = "HC1") %&gt;%</span></span>
<span id="cb2-1089"><a href="#cb2-1089" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy()</span></span>
<span id="cb2-1090"><a href="#cb2-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-1091"><a href="#cb2-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1092"><a href="#cb2-1092" aria-hidden="true" tabindex="-1"></a>Die ML-Schätzung des Poisson-Modells liefert für die verwendete Stichprobe von 500 Beobachtungen Koeffizienten-Schätzungen nahe der wahren Parameter. Zur Veranschaulichung des geschätzten Modells überlagern wir die simulierten Datenpunkte aus <span class="in">`dat`</span> mit der anhand von <span class="in">`mod_poisson`</span> geschätzten Anzahl der Verkäufe je Anzahl an Werbekampagnen. </span>
<span id="cb2-1093"><a href="#cb2-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1096"><a href="#cb2-1096" aria-hidden="true" tabindex="-1"></a><span class="in">```{webr}</span></span>
<span id="cb2-1097"><a href="#cb2-1097" aria-hidden="true" tabindex="-1"></a><span class="in"># Vektor für Kampagnen</span></span>
<span id="cb2-1098"><a href="#cb2-1098" aria-hidden="true" tabindex="-1"></a><span class="in">Kampagnen_new &lt;- tibble(Kampagnen = 1:8)</span></span>
<span id="cb2-1099"><a href="#cb2-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1100"><a href="#cb2-1100" aria-hidden="true" tabindex="-1"></a><span class="in"># Vorhersagen mit Modell</span></span>
<span id="cb2-1101"><a href="#cb2-1101" aria-hidden="true" tabindex="-1"></a><span class="in">pred &lt;- tibble(</span></span>
<span id="cb2-1102"><a href="#cb2-1102" aria-hidden="true" tabindex="-1"></a><span class="in">  Kampagnen = 1:8,</span></span>
<span id="cb2-1103"><a href="#cb2-1103" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted = predict(</span></span>
<span id="cb2-1104"><a href="#cb2-1104" aria-hidden="true" tabindex="-1"></a><span class="in">    mod_poisson, </span></span>
<span id="cb2-1105"><a href="#cb2-1105" aria-hidden="true" tabindex="-1"></a><span class="in">    newdata = Kampagnen_new,</span></span>
<span id="cb2-1106"><a href="#cb2-1106" aria-hidden="true" tabindex="-1"></a><span class="in">    type = "response"</span></span>
<span id="cb2-1107"><a href="#cb2-1107" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb2-1108"><a href="#cb2-1108" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb2-1109"><a href="#cb2-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1110"><a href="#cb2-1110" aria-hidden="true" tabindex="-1"></a><span class="in"># Simulierte Daten und Schätzungen</span></span>
<span id="cb2-1111"><a href="#cb2-1111" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb2-1112"><a href="#cb2-1112" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(</span></span>
<span id="cb2-1113"><a href="#cb2-1113" aria-hidden="true" tabindex="-1"></a><span class="in">    data = dat,</span></span>
<span id="cb2-1114"><a href="#cb2-1114" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(</span></span>
<span id="cb2-1115"><a href="#cb2-1115" aria-hidden="true" tabindex="-1"></a><span class="in">      x = Kampagnen, </span></span>
<span id="cb2-1116"><a href="#cb2-1116" aria-hidden="true" tabindex="-1"></a><span class="in">      y = Verkaeufe</span></span>
<span id="cb2-1117"><a href="#cb2-1117" aria-hidden="true" tabindex="-1"></a><span class="in">    ), </span></span>
<span id="cb2-1118"><a href="#cb2-1118" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "gray",</span></span>
<span id="cb2-1119"><a href="#cb2-1119" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha = 0.25, </span></span>
<span id="cb2-1120"><a href="#cb2-1120" aria-hidden="true" tabindex="-1"></a><span class="in">    position = position_jitter(width = .1)</span></span>
<span id="cb2-1121"><a href="#cb2-1121" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-1122"><a href="#cb2-1122" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(</span></span>
<span id="cb2-1123"><a href="#cb2-1123" aria-hidden="true" tabindex="-1"></a><span class="in">    data = pred,</span></span>
<span id="cb2-1124"><a href="#cb2-1124" aria-hidden="true" tabindex="-1"></a><span class="in">    mapping = aes(</span></span>
<span id="cb2-1125"><a href="#cb2-1125" aria-hidden="true" tabindex="-1"></a><span class="in">      x = Kampagnen,</span></span>
<span id="cb2-1126"><a href="#cb2-1126" aria-hidden="true" tabindex="-1"></a><span class="in">      y = predicted</span></span>
<span id="cb2-1127"><a href="#cb2-1127" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb2-1128"><a href="#cb2-1128" aria-hidden="true" tabindex="-1"></a><span class="in">    color = "red"</span></span>
<span id="cb2-1129"><a href="#cb2-1129" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-1130"><a href="#cb2-1130" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(breaks = 1:8) +</span></span>
<span id="cb2-1131"><a href="#cb2-1131" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb2-1132"><a href="#cb2-1132" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Datensatz und Poisson-Schätzungen der Verkäufe",</span></span>
<span id="cb2-1133"><a href="#cb2-1133" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Anzahl der Werbekampagnen",</span></span>
<span id="cb2-1134"><a href="#cb2-1134" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Anzahl der Verkäufe"</span></span>
<span id="cb2-1135"><a href="#cb2-1135" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb2-1136"><a href="#cb2-1136" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_cowplot() +</span></span>
<span id="cb2-1137"><a href="#cb2-1137" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top")</span></span>
<span id="cb2-1138"><a href="#cb2-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="In die Zwischenablage kopieren" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>