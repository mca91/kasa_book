<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Regularisierte Regression – Kausalanalyse mit R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Machine Learning.html" rel="next">
<link href="./SyntheticControl.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./RegReg.html">Machine Learning</a></li><li class="breadcrumb-item"><a href="./RegReg.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Regularisierte Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a><a href="./index.html">Kausalanalyse mit R</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Lesemodus umschalten">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Einführung</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Grundlagen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_Einfuehrung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistische Programmierung mit R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Übungsaufgaben</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Reg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Simulation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Kausale Inferenz</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Matching</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FixedEffects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Panel-Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./IV.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">IV-Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./DiD.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Difference-in-Differences</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EventStudies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Event Studies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RDD.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Regression Discontiniuty Designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./SyntheticControl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Synthetic Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RegReg.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Regularisierte Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Machine Learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Literatur.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Literatur</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
  <li><a href="#ridge-regression" id="toc-ridge-regression" class="nav-link active" data-scroll-target="#ridge-regression"><span class="header-section-number">13.1</span> Ridge Regression</a>
  <ul class="collapse">
  <li><a href="#eigenschaften-des-schätzers" id="toc-eigenschaften-des-schätzers" class="nav-link" data-scroll-target="#eigenschaften-des-schätzers"><span class="header-section-number">13.1.1</span> Eigenschaften des Schätzers</a></li>
  <li><a href="#ridge-regression-mit-glmnet" id="toc-ridge-regression-mit-glmnet" class="nav-link" data-scroll-target="#ridge-regression-mit-glmnet"><span class="header-section-number">13.1.2</span> Ridge Regression mit <code>glmnet</code></a></li>
  <li><a href="#beispiel-vorhersage-von-abschlussnoten-in-mathe" id="toc-beispiel-vorhersage-von-abschlussnoten-in-mathe" class="nav-link" data-scroll-target="#beispiel-vorhersage-von-abschlussnoten-in-mathe"><span class="header-section-number">13.1.3</span> Beispiel: Vorhersage von Abschlussnoten in Mathe</a></li>
  </ul></li>
  <li><a href="#lasso-regression" id="toc-lasso-regression" class="nav-link" data-scroll-target="#lasso-regression"><span class="header-section-number">13.2</span> Lasso Regression</a>
  <ul class="collapse">
  <li><a href="#lasso-ist-soft-thresholding" id="toc-lasso-ist-soft-thresholding" class="nav-link" data-scroll-target="#lasso-ist-soft-thresholding"><span class="header-section-number">13.2.1</span> Lasso ist Soft Thresholding</a></li>
  <li><a href="#berechnung-der-lasso-lösung-mit-dem-lars-algorithmus" id="toc-berechnung-der-lasso-lösung-mit-dem-lars-algorithmus" class="nav-link" data-scroll-target="#berechnung-der-lasso-lösung-mit-dem-lars-algorithmus"><span class="header-section-number">13.2.2</span> Berechnung der Lasso-Lösung mit dem LARS-Algorithmus</a></li>
  <li><a href="#wahl-des-regularisierungsparameters-lambda-für-den-lasso-schätzer" id="toc-wahl-des-regularisierungsparameters-lambda-für-den-lasso-schätzer" class="nav-link" data-scroll-target="#wahl-des-regularisierungsparameters-lambda-für-den-lasso-schätzer"><span class="header-section-number">13.2.3</span> Wahl des Regularisierungsparameters <span class="math inline">\(\lambda\)</span> für den Lasso-Schätzer</a></li>
  </ul></li>
  <li><a href="#vergleich-von-lasso--und-ridge-regression-mit-simulation" id="toc-vergleich-von-lasso--und-ridge-regression-mit-simulation" class="nav-link" data-scroll-target="#vergleich-von-lasso--und-ridge-regression-mit-simulation"><span class="header-section-number">13.3</span> Vergleich von Lasso- und Ridge-Regression mit Simulation</a>
  <ul class="collapse">
  <li><a href="#sec-pdz" id="toc-sec-pdz" class="nav-link" data-scroll-target="#sec-pdz"><span class="header-section-number">13.3.1</span> Prognosegüte in diversen Szenarien</a></li>
  <li><a href="#visualisierung-des-bias-variance-tradeoffs-bei-prognosen" id="toc-visualisierung-des-bias-variance-tradeoffs-bei-prognosen" class="nav-link" data-scroll-target="#visualisierung-des-bias-variance-tradeoffs-bei-prognosen"><span class="header-section-number">13.3.2</span> Visualisierung des Bias-Variance-Tradeoffs bei Prognosen</a></li>
  </ul></li>
  <li><a href="#inferenz-für-treatment-effekt-schätzung-mit-vielen-variablen" id="toc-inferenz-für-treatment-effekt-schätzung-mit-vielen-variablen" class="nav-link" data-scroll-target="#inferenz-für-treatment-effekt-schätzung-mit-vielen-variablen"><span class="header-section-number">13.4</span> Inferenz für Treatment-Effekt-Schätzung mit vielen Variablen</a>
  <ul class="collapse">
  <li><a href="#case-study-makroökonomisches-wachstum" id="toc-case-study-makroökonomisches-wachstum" class="nav-link" data-scroll-target="#case-study-makroökonomisches-wachstum"><span class="header-section-number">13.4.1</span> Case Study: Makroökonomisches Wachstum</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./RegReg.html">Machine Learning</a></li><li class="breadcrumb-item"><a href="./RegReg.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Regularisierte Regression</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Regularisierte Regression</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In diesem Kapitel betrachten wir Varianten von Koeffizientenschätzern im linearen Modell <span class="math display">\[\begin{align}
Y_i = \beta_1 X_{1,i} + \dots + \beta_k X_{k,i} + u_i, \quad i = 1,\dots,n,\label{eq:slm}
\end{align}\]</span> deren Motivation die Schätzung von <span class="math inline">\(\boldsymbol{\beta} := (\beta_1, \dots,\beta_k)'\)</span> in Anwendungen ist, in denen der KQ-Schätzer <span class="math display">\[\begin{align}
  \begin{split}
  \widehat{\boldsymbol{\beta}} =&amp;\, \arg\min_{\boldsymbol{\beta}}\mathrm{RSS}(\boldsymbol{\beta})\\
  =&amp;\,  \arg\min_{\boldsymbol{\beta}}  \sum_{i=1}^n\left(Y_i-\beta_1 X_{1,i} + \dots + \beta_k X_{k,i}\right)^2
  \end{split}\label{eq:KQLoss}
\end{align}\]</span> keine stabile Schätzung zulässt oder nicht eindeutig definiert ist, und damit gar nicht erst berechnet werden kann. Solche Szenarien ergeben sich in der empirischen Forschung, wenn die Regressoren stark korreliert sind und/oder das Modell viele Regressoren enthält (<span class="math inline">\(k\lesssim n\)</span>), oder das Regressionsproblem hoch-dimensional ist (<span class="math inline">\(k&gt;n\)</span>).</p>
<p>Regularisierte Regressionsschätzer begegnen dieser Problematik mit einer Modifikation der Verlustfunktion <span class="math inline">\(\mathrm{RSS}\)</span> in <span class="math inline">\(\eqref{eq:KQLoss}\)</span>, <span class="math display">\[\begin{align}
  \mathrm{RSS}(\boldsymbol{\beta}, p, \lambda) := \mathrm{RSS}(\boldsymbol{\beta}) + \lambda\lVert\boldsymbol{\beta}\rVert_p.
\end{align}\]</span> Hierbei ist <span class="math inline">\(\lambda&gt;0\)</span> ein Tuning-Parameter und <span class="math inline">\(p\geq1\)</span> definiert die <span class="math inline">\(p\)</span>-Norm des Koeffizientenvektors, <span class="math display">\[\begin{align}
  \lVert\boldsymbol{\beta}\rVert_p := \left(\sum_{j=1}^k \lvert\beta_j\rvert^{p}\right)^{1/p}&gt;0.\label{eq:pnorm}
\end{align}\]</span></p>
<p>Wegen <span class="math inline">\(\lambda\lVert\boldsymbol{\beta}\rVert_p&gt;0\)</span> kann die <span class="math inline">\(p\)</span>-Norm des Koeffizientenvektors <span class="math inline">\(\boldsymbol{\beta}\)</span> das Optimierungsproblem <span class="math display">\[\min_{\boldsymbol{\beta}} \mathrm{RSS}(\boldsymbol{\beta}, p, \lambda) \vert\, p,\, \lambda\]</span> derart restringieren, dass die geschätzten Koeffizienten <span class="math display">\[\begin{align*}
  \widehat{\boldsymbol{\beta}}_{p,\,\lambda} := \arg\min_{\boldsymbol{\beta}} \mathrm{RSS}(\boldsymbol{\beta}, p, \lambda)
\end{align*}\]</span> im Erwartungswert absolut kleiner ausfallen als bei der KQ-Schätzung: Der Schätzer ist in Richtung 0 verzerrt.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Dieser Effekt der Regularisierung wird in der Literatur als <em>Shrinkage</em> bezeichnet.</p>
<p>Die grundlegenden Eigenschaften des Schätzers <span class="math inline">\(\widehat{\boldsymbol{\beta}}_{p,\,\lambda}\)</span> werden maßgeblich durch den Parameter <span class="math inline">\(p\)</span> bestimmt, der hinsichtlich des zu lösenden Regressionsproblems <em>a priori</em> gewählt wird.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>Shrinkage ist eine Motivation für die Anwendung regularisierter Schätzer in Modellen, die auch mit KQ geschätzt werden könnten. Um dies zu verstehen, nehmen wir an, dass die Gauss-Markov-Annahmen in <span class="math inline">\(\eqref{eq:slm}\)</span> gelten. Dann hat der KQ-Schätzer die kleinste Varianz unter allen <em>unverzerrten</em> Schätzern. Aufgrund der Shrinkage fallen regularisierte Schätzer zwar nicht unter das Gauss-Markov-Theorem, können dafür aber eine geringere Varianz haben als KQ. Schätzer mit solchen Eigenschaften sind nützlich, wenn eine unverzerrte Schätzung von <span class="math inline">\(\boldsymbol{\beta}\)</span> nicht unser primäres Ziel ist: Für Vorhersagen kann es hilfreich sein, etwas Verzerrung bei der Koeffizientenschätzung in Kauf zu nehmen, um eine hinreichend große Varianzreduktion zu erreichen, sodass ein geringerer erwarteter Vorhersagefehler als für KQ resultiert. Hierbei liegt, eine Abwägung zwischen Verzerrung und Varianz (<em>Bias Variance Tradeoff</em>) vor, der durch den Regularisierungsparameter <span class="math inline">\(\lambda\)</span> beeinflusst wird.</p>
<p>Für die Berechnung des Schätzers in empirischen Anwendungen wird <span class="math inline">\(\lambda\)</span> meist datengetrieben (mit <a href="https://de.wikipedia.org/wiki/Kreuzvalidierungsverfahren">Cross Validation</a> oder einem Informationskriterium) geschätzt oder mit einer analytisch fundierten Faustregel gewählt.</p>
<p>Nachfolgend betrachten wir zwei häufig verwendete regularisierte Schätzer, die sich durch die Wahl <span class="math inline">\(p=1\)</span> (Lasso Regression) bzw. <span class="math inline">\(p=2\)</span> (Ridge Regression) ergeben und illustrieren ihre Anwendung mit R.</p>
<section id="ridge-regression" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="ridge-regression"><span class="header-section-number">13.1</span> Ridge Regression</h2>
<p>Ridge Regression wurde von <span class="citation" data-cites="HoerlKennard1970">Hoerl und Kennard (<a href="Literatur.html#ref-HoerlKennard1970" role="doc-biblioref">1970</a>)</span> als Alternative zur KQ-Schätzung bei hoch-korrelierten Regressoren eingeführt. Die Verlustfunktion lautet <span class="math display">\[\begin{align}
  \mathrm{RSS}(\boldsymbol{\beta},p=2,\lambda) = \mathrm{RSS}(\boldsymbol{\beta}) + \lambda \lVert\boldsymbol{\beta}\rVert_2,\label{eq:ridgeloss}
\end{align}\]</span> d.h. der Parameter <span class="math inline">\(\lambda\)</span> reguliert den Einfluss eines <span class="math inline">\(\ell_2\)</span>-Strafterms <span class="math display">\[\begin{align*}
  \lVert\boldsymbol{\beta}\rVert_2 = \sqrt{\sum_{j=1}^k\beta_j^2}
\end{align*}\]</span> auf die Verlustfunktion <span class="math inline">\(\mathrm{RSS}(\boldsymbol{\beta},p=2,\lambda)\)</span>. Der Ridge-Schätzer ergibt sich als <span class="math display">\[\begin{align}
  \widehat{\boldsymbol{\beta}}^{\mathrm{R}}_\lambda := \arg\min_{\boldsymbol{\beta}}\mathrm{RSS}(\boldsymbol{\beta}) + \lambda \lVert\boldsymbol{\beta}\rVert_2.\label{eq:ridgereg}
\end{align}\]</span></p>
<p>Für Das Optimierungsproblem <span class="math inline">\(\eqref{eq:ridgereg}\)</span> kann wir aus den Bedingungen 1. Ordnung <span class="math display">\[\begin{align}
  -2\boldsymbol{X}'(\boldsymbol{Y} - \boldsymbol{X}\boldsymbol{\beta}) + 2\lambda\boldsymbol{\beta} = \boldsymbol{0}
\end{align}\]</span> die analytische Lösung <span class="math display">\[\begin{align}
  \widehat{\boldsymbol{\beta}}^{\mathrm{R}}_\lambda = (\boldsymbol{X}'\boldsymbol{X} + \lambda\boldsymbol{I}_p)^{-1}\boldsymbol{X}'\boldsymbol{Y},\label{eq:ridgecf}
\end{align}\]</span> bestimmt werden, wobei <span class="math inline">\(\boldsymbol{I}_k\)</span> die <span class="math inline">\(k\times k\)</span> Einheitsmatrix ist. Aus Gleichung <span class="math inline">\(\eqref{eq:ridgecf}\)</span> kann die Wirkungsweise des Strafterms <span class="math inline">\(\lambda \lVert\boldsymbol{\beta}\rVert_2\)</span> abgeleitet werden: Ridge Regression modifiziert die Diagonale der zu invertierenden Matrix <span class="math inline">\(\boldsymbol{X}'\boldsymbol{X}\)</span> durch Addition von <span class="math inline">\(\lambda&gt;0\)</span>. Dies ist hilfreich, wenn</p>
<ul>
<li><p><span class="math inline">\(k\geq n\)</span> und damit <span class="math inline">\(\boldsymbol{X}'\boldsymbol{X}\)</span> nicht invertiertbar (singulär) ist. Dann kann der KQ-Schätzer nicht berechnet werden.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Die Inverse <span class="math inline">\((\boldsymbol{X}'\boldsymbol{X} + \lambda\boldsymbol{I}_p)^{-1}\)</span> hingegen existiert unter milden Bedingungen.</p></li>
<li><p>hohe Kollinearität vorliegt, sodass <span class="math inline">\((\boldsymbol{X}'\boldsymbol{X})^{-1}\)</span> zwar existiert, aber zu einer instablilen KQ-Schätzung mit hoher Varianz führt.</p></li>
</ul>
<p>Für eine grafische Betrachtung des Optimierungskalküls <span class="math inline">\(\eqref{eq:ridgereg}\)</span> betrachten wir die äquivalente Darstellung als Lagrange-Problem <span class="math display">\[\begin{align}
  \widehat{\boldsymbol{\beta}}^{\mathrm{R}}_\lambda := \arg\min_{\lVert\boldsymbol{\beta}\rVert&lt;t}\mathrm{RSS}(\boldsymbol{\beta}).\label{eq:ridgeLg}
\end{align}\]</span> In der folgenden interaktiven Grafik illustrieren wir das Optimierungsproblem <span class="math inline">\(\eqref{eq:ridgeLg}\)</span> sowie den resultierenden Schätzer der Koeffizienten <span class="math inline">\((\beta_1, \beta_2)\)</span> in einem multiplen Regressionsmodell mit den Regressoren <span class="math inline">\(X_1\)</span> und <span class="math inline">\(X_2\)</span>.</p>
<ul>
<li><p>Die blaue Ellipse ist die Menge aller Schätzwerte <span class="math inline">\(\left(\widehat\beta_{1},\, \widehat\beta_{2}\right)\)</span> für den angegebenen Wert von <span class="math inline">\(\mathrm{RSS}\)</span>. Im Zentrum der Ellipse liegt der KQ-Schätzer, welcher <span class="math inline">\(\mathrm{RSS}\)</span> minimiert.</p></li>
<li><p>Der blaue Kreis ist die Menge aller Koeffizienten-Paare <span class="math inline">\((\beta_1, \beta_2)\)</span>, welche die Restriktion <span class="math inline">\(\beta_1^2 + \beta_2^2\leq t\)</span> erfüllen. Beachte, dass die Größe des Kreises nur durch den Parameter <span class="math inline">\(t\)</span> bestimmt wird, welcher für einen vorgegebenen Wertebereich variiert werden kann.</p></li>
<li><p>Der blaue Punkt ist der Ridge-Schätzer <span class="math inline">\((\widehat\beta^R_{1,t},\, \widehat\beta^R_{2,t})\)</span>. Dieser ergibt sich als Schnittpunkt zwischen der blauen <span class="math inline">\(\mathrm{RSS}\)</span>-Ellipse und der Restriktionsregion und variiert mit <span class="math inline">\(t\)</span>. Die gestrichelte rote Kurve zeigt den Ridge-Lösungspfad.</p></li>
<li><p>Für kleine Werte <span class="math inline">\(t\)</span> drückt die Shrinkage die geschätzten Koeffizienten Richtung 0, wobei der Lösungspfad i.d.R. nicht-linear verläuft, d.h. die Shrinkage auf den Koeffizienten ist grundsätzlich unterschiedlich. Die Lösung <span class="math inline">\((\widehat\beta^R_{1,t},\, \widehat\beta^R_{2,t}) = (0,0)\)</span> existiert nur als Grenzwert für <span class="math inline">\(t\to0\)</span>.</p></li>
<li><p>Beachte, dass der Effekt von <span class="math inline">\(t\)</span> auf die Schätzung umgekehrt für <span class="math inline">\(\lambda\)</span> verläuft: Größere <span class="math inline">\(\lambda\)</span> führen zu stärkerer Regularisierung.</p></li>
</ul>
<iframe width="100%" height="500" frameborder="0" src="https://observablehq.com/embed/45a59e74a4330581?cells=viewof+m%2Cchart114">
</iframe>
<section id="eigenschaften-des-schätzers" class="level3" data-number="13.1.1">
<h3 data-number="13.1.1" class="anchored" data-anchor-id="eigenschaften-des-schätzers"><span class="header-section-number">13.1.1</span> Eigenschaften des Schätzers</h3>
<p>Der Ridge-Schätzer <span class="math inline">\(\widehat{\boldsymbol{\beta}}^{\mathrm{R}}_\lambda\)</span> ist nicht invariant gegenüber der Skalierung der Regressoren. Für empirische Daten sollte daher vorab eine Standardisierung der erklärenden Variablen durchgeführt werden.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Um die Eigenschaften des Ridge-Schätzers besser zu verstehen, betrachten wir hier den Fall orthonormaler Regressoren <span class="math inline">\(\boldsymbol{X}_j\)</span>.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Dann ist <span class="math display">\[\begin{align}
  \widehat{\beta}^{\mathrm{R}}_{\lambda,\,j} = (1+\lambda)^{-1} \cdot\widehat{\beta}_j,\quad j = 1,\dots,k,\label{eq:ridgeortho}
\end{align}\]</span> d.h. der Ridge-Schätzer skaliert die KQ-Lösung mit einem von <span class="math inline">\(\lambda\)</span> abhängigen Faktor.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>Wir illustrieren dies, indem wir den Zusammenhang zwischen KQ- und Ridge-Schätzer im orthonormalen Fall als R-Funktion <code>ridge_ortho()</code> implementieren und für die Parameterwerte <span class="math inline">\(\lambda\in\{0,0.5,2\}\)</span> plotten.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion für Rige Regression bei orthonormalen Regressoren</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>ridge_ortho <span class="ot">&lt;-</span> <span class="cf">function</span>(KQ, lambda) {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> lambda) <span class="sc">*</span> KQ</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ-Schätzer gegen Ridge-Schätzer plotten</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">KQ =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, .<span class="dv">01</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat) <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> ridge_ortho, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">lambda =</span>  <span class="dv">0</span>), </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> ridge_ortho, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">lambda =</span> .<span class="dv">5</span>), </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> ridge_ortho, </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">lambda =</span> <span class="dv">2</span>), </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span>.<span class="dv">4</span>, .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"KQ-Schätzer von beta_1"</span>) <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Ridge-Schätzer von beta_1"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ridgeortho" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ridgeortho-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-ridgeortho-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ridgeortho-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.1: Shrinkage des OLS-Schätzers bei Ridge Regression
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-ridgeortho" class="quarto-xref">Abbildung&nbsp;<span>13.1</span></a> zeigt, dass der Ridge-Schätzer eine lineare Transformation des KQ-Schätzers (gestrichelte Linie) ist. Größere Werte des Regularisierungsparameters <span class="math inline">\(\lambda\)</span> führen zu stärkerer Shrinkage des Koeffizientenschätzers in Richtung 0. Die <span class="math inline">\(\ell_2\)</span>-Norm führt zu proportional zum Absolutwert des KQ-Schätzers verlaufender Shrinkage: Größere Koeffizienten werden stärker bestraft als kleine Koeffizienten.</p>
<p>Die Eigenschaft <span class="math display">\[\mathrm{E}\left(\widehat{\boldsymbol{\beta}}^{\mathrm{R}}_{\lambda,\,j}\right) = (1+\lambda)^{-1} \cdot \beta_j\]</span> zeigt, dass <span class="math inline">\(\widehat{\boldsymbol{\beta}}^{\mathrm{R}}_{\lambda,\,j}\)</span> (für fixes <span class="math inline">\(\lambda&gt;0\)</span>) nicht erwartungstreu für <span class="math inline">\(\beta_j\)</span> ist. Weiterhin ist <span class="math display">\[\begin{align*}
  \mathrm{Var}\left(\widehat{\beta}^{\mathrm{R}}_{\lambda,\,j}\right) =&amp;\,
  \mathrm{Var}\left(\widehat{\beta}_j\right) \cdot \left(\frac{\lambda}{1+\lambda^2}\right)\\
    =&amp;\, \sigma^2\cdot \left(\frac{\lambda}{1+\lambda^2}\right),
\end{align*}\]</span> wobei <span class="math inline">\(\sigma^2\)</span> die Varianz des Regressionsfehlers <span class="math inline">\(u\)</span> ist. Wegen <span class="math inline">\(\lambda&lt;(1+\lambda)^2\)</span> für <span class="math inline">\(\lambda&gt;0\)</span> gilt <span class="math display">\[\mathrm{Var}\left(\widehat{\beta}^{\mathrm{R}}_{\lambda,\,j}\right)&lt;\mathrm{Var}\left(\widehat{\beta}_j\right).\]</span> Der Ridge-Schätzer hat also eine kleinere Varianz als der KQ-Schätzer. Diese Eigenschaften können auch für korrelierte Regressoren gezeigt werden.</p>
</section>
<section id="ridge-regression-mit-glmnet" class="level3" data-number="13.1.2">
<h3 data-number="13.1.2" class="anchored" data-anchor-id="ridge-regression-mit-glmnet"><span class="header-section-number">13.1.2</span> Ridge Regression mit <code>glmnet</code></h3>
<p>Wir zeigen nun anhand simulierter Daten, wie der Ridge-Lösungspfad mit dem R-Paket <code>glmnet</code> berechnet werden kann. Wir erzeugen zunächst Daten gemäß der Vorschrift <span class="math display">\[\begin{align}
  \begin{split}
  Y_i =&amp;\, \boldsymbol{X}_i' \boldsymbol{\beta} + u_i,\\
  \\
  \beta_j =&amp;\,  \frac{5}{j^2}, \qquad\qquad\ j=1,\dots,5,\\
  \beta_j =&amp;\, -\frac{5}{(j-5)^2}, \quad j=6,\dots,10,\\
  \\
  \boldsymbol{X}_i \sim&amp;\, N(\boldsymbol{0}, \boldsymbol{\Sigma}), \quad u_i \overset{u.i.v.}{\sim} N(0, 1), \quad i = 1,\dots,25.
  \end{split} \label{eq:ridgedgp1}
\end{align}\]</span> Hierbei wird <span class="math inline">\(\boldsymbol{\Sigma}\)</span> so definiert, dass jeder Regressor <span class="math inline">\(N(0,1)\)</span>-verteilt ist und eine Korrelation von <span class="math inline">\(0.8\)</span> mit allen anderen Regressoren aufweist. Mit der Vorschrift für die <span class="math inline">\(\beta_j\)</span> stellen wir sicher, dass es wenige Variablen gibt, die <span class="math inline">\(Y\)</span> stark beeinflussen, da der Absolutbetrag der Koeffizienten in <span class="math inline">\(j\)</span> abnimmt.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gendata)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter definieren</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">:</span>(k<span class="sc">/</span><span class="dv">2</span>))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">c</span>(coefs, <span class="sc">-</span>coefs)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Beobachtungen simulieren</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">genmvnorm</span>(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">k =</span> k, </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor =</span> <span class="fu">rep</span>(.<span class="dv">8</span>, (k<span class="sc">^</span><span class="dv">2</span><span class="sc">-</span>k)<span class="sc">/</span><span class="dv">2</span>), </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> N)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> X <span class="sc">%*%</span> beta <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir schätzen nun ein Modell mit allen 10 Regressoren mit <code>glmnet</code>. Beachte, dass für den Ridge-Strafterm <code>alpha = 0</code> gesetzt werden muss.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge-Regression anpassen</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>ridge_fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> X, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> Y, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">0</span> <span class="co"># für Ridge-Strafterm</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Der Lösungspfad der Ridge-Schätzung kann nach Transformation der geschätzen Koeffizienten und der zugehörigen <span class="math inline">\(\lambda\)</span>-Werte in ein langes Format überführt und komfortabel mit <code>ggplot2</code> dargestellt werden.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda-Sequenz auslesen</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> ridge_fit<span class="sc">$</span>lambda</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge-Schätzung für Lambdas im langen Format </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(ridge_fit<span class="sc">$</span>beta) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda =</span> lambdas) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Grafik mit ggplot erzeugen</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> lambda, </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> value, </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> Variable</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"gesch. Koeffizienten"</span>) <span class="sc">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"log_10(lambda)"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ridgesolpath" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ridgesolpath-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-ridgesolpath-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ridgesolpath-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.2: Lösungspfad für Ridge-Schätzung
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-ridgesolpath" class="quarto-xref">Abbildung&nbsp;<span>13.2</span></a> zeigt den nicht-linearen Verlauf der Shrinkage auf den geschätzten Modellkoeffizienten. Die Koeffizienten werden mit zunehmendem <span class="math inline">\(\lambda\)</span> von der KQ-Lösung ausgehend (linkes Ende der Skala) in Richtung 0 gezwungen.</p>
<p>Über die Funktion <code>cv.glmnet()</code> kann ein optimales <span class="math inline">\(\lambda\)</span> mit Cross Validation (CV) ermittelt werden. Ähnlich wie bei <code>glmnet()</code> wird für die Validierung automatisch eine <span class="math inline">\(\lambda\)</span>-Sequenz erzeugt. Wir nutzen <code>autoplot()</code> aus dem R-Paket <code>ggfortify</code> für die Visualisierung der Ergebnisse mit <code>ggplot2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validierte Bestimmung von lambda</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ridge_cvfit <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> Y, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> X, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">intercept =</span> F,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnisse plotten</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>ridge_cvfit <span class="sc">%&gt;%</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">label.n =</span> <span class="dv">0</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ridgecvplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ridgecvplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-ridgecvplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ridgecvplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.3: Lösungspfad für Ridge-Schätzung
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-ridgecvplot" class="quarto-xref">Abbildung&nbsp;<span>13.3</span></a> zeigt <code>ridge_cvfit$lambda.min</code>, das optimale <span class="math inline">\(\lambda\)</span> mit dem geringsten CV Mean-Squarred-Error (linke gestrichelte Linie) und <code>ridge_cvfit$lambda.1se</code>, das größte <span class="math inline">\(\lambda\)</span>, welches innerhalb einer Standardabweichung entfernt ist (rechte gestrichelte Linie).<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> Wir berechnen die Schätzung für <code>lambda.min</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  ridge_coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> ridge_cvfit, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">s =</span> ridge_cvfit<span class="sc">$</span>lambda.min</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>11 x 1 sparse Matrix of class "dgCMatrix"
                    s1
(Intercept)  .        
X1           4.1302194
X2           1.0245661
X3           0.3139297
X4           0.5697498
X5           0.2928664
X6          -4.1693524
X7          -0.7509305
X8          -0.3844761
X9          -0.3841997
X10         -0.4078514</code></pre>
</div>
</div>
<p>Wir schätzen das Modell nun mit KQ und vergleichen die Koeffizienten mit der Ridge-Schätzung.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ-Schätzung durchführen</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>KQ_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Koeffizienten auslesen und transformieren:</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Ridge =</span> <span class="fu">as.matrix</span>(ridge_coefs)[<span class="dv">2</span><span class="sc">:</span><span class="dv">11</span>, ],</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">KQ =</span> KQ_fit<span class="sc">$</span>coefficients</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">j =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> Ridge<span class="sc">:</span>KQ, </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Methode"</span>, </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Koeffizient"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar-Plot für Koeffizientenvergleich erzeugen  </span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> j, </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> Koeffizient, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> Methode</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"dodge"</span>, </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"identity"</span>, </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> .<span class="dv">5</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-KoefRidgeVsKQ" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-KoefRidgeVsKQ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-KoefRidgeVsKQ-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-KoefRidgeVsKQ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.4: Koeffizientenvergleich: Ridge vs.&nbsp;KQ
</figcaption>
</figure>
</div>
</div>
</div>
<p>Der Vergleich anhand von <a href="#fig-KoefRidgeVsKQ" class="quarto-xref">Abbildung&nbsp;<span>13.4</span></a> zeigt deutlich, dass Ridge Regression im Vergleich mit KQ zu absolut kleineren Koeffizientenschätzungen tendiert. Inwiefern dies Konsequenzen für die Prognosegüte der Schätzung hat, können wir Anhand eines Testdatensatzes bestimmen. Hierzu vergleichen wir die mittleren Fehler (MSE) bei der Prognose von <span class="math inline">\(Y\)</span> für die Beobachtungen im Testdatensatz. Für die Simulation des Testdatensatzes nutzen wir erneut die Vorschrift <span class="math inline">\(\eqref{eq:ridgedgp1}\)</span> um 80 neue Beobachtungen zu erzeugen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test-Datensatz erstellen</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4321</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Regressoren</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>new_X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">genmvnorm</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">k =</span> k, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor =</span> <span class="fu">rep</span>(.<span class="dv">85</span>, (k<span class="sc">^</span><span class="dv">2</span><span class="sc">-</span>k)<span class="sc">/</span><span class="dv">2</span>), </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> N</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Abh. Variable</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>new_Y <span class="ot">&lt;-</span> new_X <span class="sc">%*%</span> beta <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Für beide Methoden können wir <code>predict()</code> für die Prognosen von <span class="math inline">\(Y\)</span> für den Testdatensatz (<code>new_Y</code>) nutzen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge: Vorhersage von new_Y für Test-Datensatz</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Y_predict_ridge <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> ridge_cvfit, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">newx =</span> new_X, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">s =</span> ridge_cvfit<span class="sc">$</span>lambda.min</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge: MSE für Test-Datensatz berechnen</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Y_predict_ridge <span class="sc">-</span> new_Y)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.288457</code></pre>
</div>
</div>
<p>Die Vorhersage für <code>lm()</code> benötigt dieselben Variablennamen wie im angepassten Modell, s. <code>KQ_fit$coefficients</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test-Datensatz für predict.lm() formatieren</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>new_X <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(new_X)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(new_X) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">1</span><span class="sc">:</span>k)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ: Vorhersage von new_Y für Test-Datensatz</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>Y_predict_KQ <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> KQ_fit, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> new_X</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ: MSE für Test-Datensatz berechnen</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Y_predict_KQ <span class="sc">-</span> new_Y)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 29.33797</code></pre>
</div>
</div>
<p>Die Ergebnisse zeigen, dass der Ridge-Schätzer trotz seiner Verzerrung einen deutlich geringeren mittleren Vorhersagefehler für die Testdaten erzielt als der KQ-Schätzer. Diese Eigenschaft der Koeffizientenschätzung kann die Prognosegüte von Ridge Regression gegenüber der KQ-Regression verbessern.</p>
</section>
<section id="beispiel-vorhersage-von-abschlussnoten-in-mathe" class="level3" data-number="13.1.3">
<h3 data-number="13.1.3" class="anchored" data-anchor-id="beispiel-vorhersage-von-abschlussnoten-in-mathe"><span class="header-section-number">13.1.3</span> Beispiel: Vorhersage von Abschlussnoten in Mathe</h3>
<p>Zur Illustration von Ridge Regression nutzen wir den Datensatz <code>SP</code> aus <span class="citation" data-cites="CortezSilva2008">Cortez und Silva (<a href="Literatur.html#ref-CortezSilva2008" role="doc-biblioref">2008</a>)</span>.<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> <code>SP</code> enhält Beobachtungen zu Leistungen von insgesamt 100 Schülerinnen und Schülern im Fach Mathematik in der Sekundarstufe an zwei portugiesischen Schulen. Neben der Abschlussnote in Mathe (<code>G3</code>, Skala von 0 bis 20) beinhaltet <code>SP</code> diverse demografische, soziale und schulbezogene Merkmale, die mithilfe von Schulberichten und Fragebögen erhoben wurden. Ziel ist es, ein Modell für die Prognose von <code>G3</code> anzupassen.</p>
<p>Wir lesen zunächst die Daten (im .csv-Format) ein.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten einlesen</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>SP <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"datasets/SP.csv"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ein Überblick zeigt, dass der Großteil der Regressoren aus kategorialen Variablen mit sozio-ökonomischen Informationen besteht.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Überblick</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(SP)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 100
Columns: 31
$ school     &lt;chr&gt; "GP", "GP", "GP", "MS", "GP", "GP", "GP", "GP", "GP", "GP",…
$ sex        &lt;chr&gt; "M", "M", "F", "F", "M", "F", "F", "F", "F", "F", "M", "M",…
$ age        &lt;dbl&gt; 17, 18, 19, 17, 16, 16, 19, 16, 16, 16, 18, 16, 15, 17, 17,…
$ address    &lt;chr&gt; "R", "R", "U", "U", "U", "U", "U", "U", "U", "R", "U", "U",…
$ famsize    &lt;chr&gt; "GT3", "GT3", "LE3", "GT3", "LE3", "GT3", "GT3", "GT3", "GT…
$ Pstatus    &lt;chr&gt; "T", "T", "T", "T", "A", "T", "T", "T", "A", "T", "T", "T",…
$ Medu       &lt;dbl&gt; 1, 4, 3, 2, 3, 2, 0, 2, 3, 4, 4, 2, 1, 2, 2, 3, 3, 4, 4, 2,…
$ Fedu       &lt;dbl&gt; 2, 3, 2, 2, 4, 3, 1, 1, 1, 4, 4, 2, 2, 3, 2, 3, 1, 3, 4, 2,…
$ Mjob       &lt;chr&gt; "at_home", "teacher", "services", "other", "services", "oth…
$ Fjob       &lt;chr&gt; "other", "services", "other", "at_home", "other", "other", …
$ reason     &lt;chr&gt; "home", "course", "reputation", "home", "home", "reputation…
$ guardian   &lt;chr&gt; "mother", "mother", "other", "mother", "mother", "mother", …
$ traveltime &lt;dbl&gt; 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 1,…
$ studytime  &lt;dbl&gt; 2, 3, 2, 3, 2, 2, 2, 1, 2, 2, 1, 2, 2, 2, 1, 1, 2, 3, 1, 2,…
$ failures   &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 3, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ schoolsup  &lt;chr&gt; "no", "no", "no", "no", "yes", "yes", "no", "no", "no", "no…
$ famsup     &lt;chr&gt; "no", "no", "yes", "no", "yes", "yes", "yes", "no", "yes", …
$ paid       &lt;chr&gt; "no", "no", "yes", "no", "no", "yes", "no", "no", "yes", "n…
$ activities &lt;chr&gt; "no", "no", "no", "yes", "yes", "yes", "no", "no", "no", "y…
$ nursery    &lt;chr&gt; "yes", "yes", "no", "yes", "yes", "yes", "no", "yes", "yes"…
$ higher     &lt;chr&gt; "yes", "yes", "yes", "yes", "yes", "yes", "no", "yes", "yes…
$ internet   &lt;chr&gt; "no", "yes", "yes", "no", "yes", "no", "no", "yes", "yes", …
$ romantic   &lt;chr&gt; "no", "yes", "yes", "yes", "no", "no", "no", "yes", "no", "…
$ famrel     &lt;dbl&gt; 3, 5, 4, 3, 5, 4, 3, 4, 2, 2, 1, 5, 4, 5, 3, 5, 4, 4, 5, 5,…
$ freetime   &lt;dbl&gt; 1, 3, 2, 4, 3, 4, 4, 5, 3, 4, 4, 4, 3, 3, 4, 4, 5, 2, 3, 4,…
$ goout      &lt;dbl&gt; 3, 2, 2, 3, 3, 3, 2, 2, 3, 4, 2, 4, 2, 3, 4, 2, 4, 2, 3, 4,…
$ Dalc       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 2, 1, 1, 1,…
$ Walc       &lt;dbl&gt; 5, 2, 2, 1, 1, 3, 1, 1, 2, 3, 2, 4, 1, 3, 3, 1, 3, 2, 1, 1,…
$ health     &lt;dbl&gt; 3, 4, 1, 3, 5, 4, 5, 5, 4, 4, 1, 5, 5, 3, 5, 5, 1, 3, 5, 5,…
$ absences   &lt;dbl&gt; 4, 9, 22, 8, 4, 6, 2, 20, 5, 6, 5, 0, 2, 2, 12, 0, 17, 0, 4…
$ G3         &lt;dbl&gt; 10, 16, 11, 11, 11, 10, 9, 12, 7, 11, 16, 12, 9, 12, 12, 13…</code></pre>
</div>
</div>
<p>Um die Prognosegüte des Modells beurteilen zu können, partitionieren wir <code>SP</code> zufällig in einen Test- sowie einen Trainingsdatensatz (mit 30 und 70 Beobachtungen), jeweils für die Regressoren und die abhängige Variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ID für Beobachtungen im Testdatensatz zufällig erzeugen</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ID <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(SP), <span class="at">size =</span> <span class="dv">30</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Regressoren aufteilen</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>SP_test <span class="ot">&lt;-</span> SP[ID,]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>SP_train <span class="ot">&lt;-</span> SP[<span class="sc">-</span>ID,]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Abh. Variable aufteilen</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>Y_test <span class="ot">&lt;-</span> SP_test<span class="sc">$</span>G3</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>Y_train <span class="ot">&lt;-</span> SP_train<span class="sc">$</span>G3</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Als nächstes passen wir ein Ridge-Regressionsmodell für alle Regressoren in <code>SP_train</code> an und ermitteln ein optimales <span class="math inline">\(\lambda\)</span> mit Cross Validation. Beachte, dass <code>cv.glmnet</code> nicht für Regressoren im <code>data.frame</code>/<code>tibble</code>-Format ausgelegt ist, sondern ein <code>matrix</code>-Format erwartet. Wir transformieren <code>SP_train</code> daher mit <code>data.matrix()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge-Regression und CV für Trainingsdaten</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>SP_fit_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">data.matrix</span>(SP_train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>G3)), </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> Y_train, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># CV-Ergebnisse für lambda visualisieren</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>SP_fit_cv <span class="sc">%&gt;%</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">label.n =</span> <span class="dv">0</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="RegReg_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Wie für das Beispiel mit simulierten Daten erhalten wir mit <code>predict()</code> Vorhersagen für die erzielte Punktzahl. Beachte, dass wir den MSE nicht für die Trainingsdaten <code>SP_train</code>, sondern für die Testdaten <code>SP_test</code> berechnen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prognose von G3 anhand des Ridge-Modells</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Y_predict_ridge <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> SP_fit_cv, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">newx =</span> <span class="fu">data.matrix</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    SP_test <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>G3)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">s =</span> SP_fit_cv<span class="sc">$</span>lambda.min</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE für Testdaten berechnen</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Y_predict_ridge <span class="sc">-</span> Y_test)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21.13249</code></pre>
</div>
</div>
<p>Auch in diesem empirischen Beispiel zeigt ein Vergleich der MSEs, dass Ridge Regression dem KQ-Schätzer hinsichtlich der Vorhersagegüte überlegen ist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modell mit KQ schätzen</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>SP_fit_KQ <span class="ot">&lt;-</span> <span class="fu">lm</span>(G3 <span class="sc">~</span> ., SP_train)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prognose</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>Y_predict_KQ <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> SP_fit_KQ, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> SP_test <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>G3)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Testset-MSE berechnen</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Y_predict_KQ <span class="sc">-</span> Y_test)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 29.76893</code></pre>
</div>
</div>
<p>Der MSE für Ridge ist mit <span class="math inline">\(21.13\)</span> deutlich kleiner als <span class="math inline">\(29.77\)</span>, der MSE für KQ.</p>
<p>Für die Interpretation der Ridge-Schätzung erweitern den Code für die <code>ggplot2</code>-Grafik der Koeffizienten-Pfade um eine vertikale Linie des mit CV ermittelten <span class="math inline">\(\lambda\)</span> und fügen mit dem Paket <code>ggrepel</code> Labels für die Pfade der größten Koeffizienten hinzu.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda-Sequenz auslesen</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> SP_fit_cv<span class="sc">$</span>lambda</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge-Schätzung für Lambdas im langen Format </span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(SP_fit_cv<span class="sc">$</span>glmnet.fit<span class="sc">$</span>beta) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> <span class="fu">rownames</span>(SP_fit_cv<span class="sc">$</span>glmnet.fit<span class="sc">$</span>beta)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda =</span> lambdas) </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafik mit ggplot erzeugen</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> lambda, </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> value, </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> Variable</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(lambda <span class="sc">==</span> <span class="fu">min</span>(lambdas)),</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> Variable), </span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="dv">8</span>, </span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="sc">-</span>.<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"gesch. Koeffizienten"</span>) <span class="sc">+</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="st">"log_10(lambda)"</span>) <span class="sc">+</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> SP_fit_cv<span class="sc">$</span>lambda.min, </span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"red"</span>, </span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">2</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ridgAppPlot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ridgAppPlot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-ridgAppPlot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ridgAppPlot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.5: Lösungspfad für Ridge-Schätzung
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-ridgAppPlot" class="quarto-xref">Abbildung&nbsp;<span>13.5</span></a> gibt Hinweise darauf, dass neben der Schulzugehörigkeit und Indikatoren für schulische Leistung (bspw. <code>failures</code>) sozio-ökonomische Prädiktoren wie <code>internet</code> (Internetzugang zuhause), <code>Pstatus</code> (Zusammenleben der Eltern) und <code>address</code>/<code>traveltime</code> (sozialer Status) relevante Variablen zu sein scheinen.</p>
<p>Das optimale <span class="math inline">\(\lambda_\mathrm{cv} \approx 0.21\)</span> (gestrichelte rote Linie in <a href="#fig-ridgAppPlot" class="quarto-xref">Abbildung&nbsp;<span>13.5</span></a>) führt zu deutlicher Shrinkage, was eine mögliche Erklärung für den besseren Testset-MSE von Ridge Regression ist: Die Koeffizienten von Variablen mit wenig Erklärungskraft werden durch die Regularisierung in Richtung 0 gezwungen und reduzieren so die Varianz der Vorhersage gegenüber der (idealerweise) unverzerrten KQ-Schätzung.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Facts zu Ridge Regression
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Ridge-Regression regularisiert den KQ-Schätzer mit der <span class="math inline">\(\ell_2\)</span>-Norm der Koeffizienten. Diese Form von Regularisierung ist eine Alternative für KQ in Anwendungen mit mehr Regressoren als Beobachtugen (<span class="math inline">\(k\geq n\)</span>) und/oder wenn KQ aufgrund starker Kollinearität eine hohe Varianz aufweist.</p></li>
<li><p>Der Ridge-Schätzer <span class="math inline">\(\widehat{\boldsymbol{\beta}}^{\mathrm{R}}_\lambda\)</span> ist <em>nicht</em> erwartungstreu. Die geschätzten Koeffizienten sind auch für <span class="math inline">\(n\to\infty\)</span> verzerrt.</p></li>
<li><p>Aufgrund der verzerrten Schätzung ist statistische Inferenz für Koeffizienten mit <span class="math inline">\(\widehat{\boldsymbol{\beta}}^{\mathrm{R}}_\lambda\)</span> problematisch. Anstatt für strukturelle Modelle oder die Schätzung kausaler Effekte wird Ridge Regression in der Praxis daher überwiegend für Prognosen verwendet.</p></li>
<li><p>Die Wahl von <span class="math inline">\(\lambda\)</span> impliziert einen Tradeoff zwischen Verzerrung und Varianz: Große <span class="math inline">\(\lambda\)</span> schrumpfen die Koeffizientenschätzer Richtung 0 (mehr Verzerrung), führen aber zu einer kleineren Varianz der Schätzung. Entsprechend können Vorhersagen mit mehr Verzerrung aber weniger Varianz als mit KQ getroffen werden.</p></li>
<li><p>Ridge Regression kann in R mit dem Paket <code>glmnet</code> berechnet werden.</p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="lasso-regression" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="lasso-regression"><span class="header-section-number">13.2</span> Lasso Regression</h2>
<p>Least Absolute Shrinkage and Selection Operator (Lasso) ist ein von <span class="citation" data-cites="Tibshirani1996">Tibshirani (<a href="Literatur.html#ref-Tibshirani1996" role="doc-biblioref">1996</a>)</span> vorgeschlagener Schätzer, der die Verlustfunktion des KQ-Schätzers um einen Strafterm für die Summe der (absoluten) Größe der Koeffizienten <span class="math inline">\(\boldsymbol\beta = (\beta_1, \dots,\beta_k)'\)</span> erweitert. Die Verlustfunktion des Lasso-Schätzers von <span class="math inline">\(\boldsymbol{\beta}\)</span> lautet <span class="math display">\[\begin{align}
\mathrm{RSS}(\boldsymbol{\beta},p=1,\lambda) = \mathrm{RSS}(\boldsymbol{\beta}) + \lambda \lVert\boldsymbol{\beta}\rVert_1.\label{eq:lassoloss}
\end{align}\]</span> Für den Strafterm wird also die <span class="math inline">\(\ell_1\)</span>-norm <span class="math display">\[
\lVert\boldsymbol{\beta}\rVert_1 = \sum_{j=1}^k \lvert\beta_j \rvert
\]</span> verwendet. Der Lasso-Schätzer <span class="math inline">\(\widehat{\boldsymbol{\beta}}^{\mathrm{L}}_\lambda\)</span> für <span class="math inline">\(\boldsymbol{\beta}\)</span> minimiert <span class="math inline">\(\eqref{eq:lassoloss}\)</span>, <span class="math display">\[\begin{align}
\boldsymbol{\beta}^{\mathrm{L}}_\lambda = \arg\min_{\boldsymbol{\beta}} \ \mathrm{RSS}(\boldsymbol{\beta},p=1,\lambda).
\end{align}\]</span> Entsprechend erhalten wir in Abhängigkeit von <span class="math inline">\(\lambda\)</span> ein Kontinuum an Lösungen <span class="math display">\[\begin{align}
  \left\{\widehat{\boldsymbol{\beta}}^{\mathrm{L}}_\lambda\right\}_{\lambda=0}^{\lambda=\infty},\label{eq:LassoPath}
\end{align}\]</span> der sogenannte <em>Lasso-Pfad</em>.</p>
<p>Das Optimierungsproblem <span class="math inline">\(\eqref{eq:lassoloss}\)</span> hat die äquivalente Darstellung <span class="math display">\[\begin{align}
  \begin{split}
    \widehat{\boldsymbol{\beta}}^{\mathrm{L}}_\lambda =&amp;\, \arg\min_{\boldsymbol{\beta}} \mathrm{RSS}(\boldsymbol{\beta}) + \lambda\left(\lVert\boldsymbol{\beta}\rVert_1 - t\right)\\
    =&amp;\, \arg\min_{\lVert\boldsymbol{\beta}\rVert_1\leq t} \mathrm{RSS}(\boldsymbol{\beta}),
  \end{split}\label{eq:lassolagrange}
\end{align}\]</span> welche über den <a href="https://de.wikipedia.org/wiki/Lagrange-Multiplikator#Beispiel_mit_Anwendungsbezug">Lagrange-Ansatz</a> unter der Nebenbedingung <span class="math inline">\(\lVert\boldsymbol{\beta}\rVert_1 \leq t\)</span> gelöst werden kann.</p>
<p>Ähnlich wie der KQ-Schätzer ist der Lasso-Schätzer <span class="math inline">\(\widehat{\boldsymbol{\beta}}^{\mathrm{L}}_\lambda\)</span> durch Bedingungen 1. Ordnung bestimmt. Diese Bedingungen lassen sich komfortabel in Matrix-Schreibweise darstellen als <span class="math display">\[\begin{align}
  -2\boldsymbol{X}_j'(\boldsymbol{Y} - \boldsymbol{X}\boldsymbol{\beta}) + \lambda\cdot\mathrm{sgn}(\beta_j) = 0, \quad j = 1,\dots,k.\label{eq:LassoFOC}
\end{align}\]</span> Aus Gleichung <span class="math inline">\(\eqref{eq:LassoFOC}\)</span> folgt, dass der Lasso-Schätzer aufgrund des Strafterms im Allgemeinen nicht algebraisch bestimmt werden kann.<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a></p>
<p>In Abhängigkeit von <span class="math inline">\(\lambda\)</span> zwingt der Lasso-Schätzer die KQ-Schätzung von <span class="math inline">\(\beta_j\)</span> zu einem (absolut) kleineren Wert: Ähnlich wie bei Ridge Regression bewirkt der <span class="math inline">\(\ell_1\)</span>-Strafterm eine mit <span class="math inline">\(\lambda\)</span> zunehmende Schrumpfung der geschätzen Koeffizienten in Richtung 0. Charakteristisch für die Lösung des Lasso-Schätzers ist, dass <span class="math inline">\(\widehat{\boldsymbol{\beta}}^{\mathrm{L}}_j = 0\)</span>, wenn die Bedingung <span class="math display">\[\begin{align}
  \left\lvert\boldsymbol{X}_j'(\boldsymbol{Y} - \boldsymbol{X}\widehat{\boldsymbol{\beta}}^{\mathrm{L}}_\lambda)\right\rvert - \lambda/2 \leq 0 \label{eq:lassoselection}
\end{align}\]</span> erfüllt ist. In Abhängigkeit von <span class="math inline">\(\lambda\)</span> kann der Lasso-Schätzer folglich geschätzte Regressionskoeffizienten nicht nur in Richtung <span class="math inline">\(0\)</span>, sondern diese auch <em>exakt</em> mit <span class="math inline">\(0\)</span> schätzen und damit <em>Variablenselektion</em> betreiben. Aufgrund der mit <span class="math inline">\(\lambda\)</span> zunehmenden Shrinkage bis die Bedingung <span class="math inline">\(\eqref{eq:lassoselection}\)</span> erfüllt und der Koeffizient gleich <span class="math inline">\(0\)</span> gesetzt wird, bezeichnet man Lasso auch als einen <em>Soft Thresholding Operator</em>. Im nächsten Abschnitt betrachten wir die Eigenschaften von Lasso-Regularisierung unter vereinfachten Annahmen bzgl. der Regressoren.</p>
<section id="lasso-ist-soft-thresholding" class="level3" data-number="13.2.1">
<h3 data-number="13.2.1" class="anchored" data-anchor-id="lasso-ist-soft-thresholding"><span class="header-section-number">13.2.1</span> Lasso ist Soft Thresholding</h3>
<p>Wir betrachten nun eine mathematische Darstellung von Selektions- und Shrinkage-Eigenschaft des Lasso-Schätzers in einem vereinfachten Modell. Wenn die Regressoren <span class="math inline">\(\boldsymbol{X}\)</span> orthonormal zueinander sind, existiert eine analytische Lösung des Lasso-Schätzers, <span class="math display">\[\begin{align}
  \widehat{\boldsymbol{\beta}}^{\mathrm{L}}_\lambda =
  \begin{cases}
    \widehat{\boldsymbol{\beta}}_j - \lambda/2 &amp;, \ \ \widehat{\boldsymbol{\beta}}_j &gt; \lambda/2\\
    0 &amp;, \ \ \lvert\widehat{\boldsymbol{\beta}}_j\rvert\leq\lambda/2\\
    \widehat{\boldsymbol{\beta}}_j + \lambda/2 &amp;, \ \ \widehat{\boldsymbol{\beta}}_j &lt; \lambda/2
  \end{cases},\label{eq:lassoST}
\end{align}\]</span> wobei <span class="math inline">\(\widehat{\boldsymbol{\beta}}_j\)</span> der KQ-Schätzer von <span class="math inline">\(\beta_j\)</span> ist. Anhand von <span class="math inline">\(\eqref{eq:lassoST}\)</span> können wir die Selektionseigenschaft sowie die Schrumpfung der KQ-Koeffizientenschätzung in Abhängigkeit der durch <span class="math inline">\(\lambda\)</span> regulierten <span class="math inline">\(\ell_1\)</span>-Strafe erkennen. Für eine Visualisierung implementieren wir <span class="math inline">\(\eqref{eq:lassoST}\)</span> als R-Funktion <code>lasso_st()</code> und zeichnen die resultierenden Koeffizientenschätzungen für die Parameterwerte <span class="math inline">\(\lambda\in\{0, 0.2, 0.4\}\)</span>.</p>
<p>Wir definieren zunächst die Funktion <code>lasso_st()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Funktion für Lasso soft-thresholding definieren</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>lasso_st <span class="ot">&lt;-</span> <span class="cf">function</span>(KQ, lambda) {</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    KQ <span class="sc">&gt;</span> lambda<span class="sc">/</span><span class="dv">2</span>         <span class="sc">~</span> KQ <span class="sc">-</span> lambda<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abs</span>(KQ) <span class="sc">&lt;=</span> lambda<span class="sc">/</span><span class="dv">2</span>   <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    KQ <span class="sc">&lt;</span> <span class="sc">-</span>lambda<span class="sc">/</span><span class="dv">2</span>        <span class="sc">~</span> KQ <span class="sc">+</span> lambda<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Im nächsten Schritt zeichnen wir <code>lasso_st()</code> für eine Sequenz von KQ-Schätzwerten gegeben <span class="math inline">\(\lambda\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sequenz von KQ-Schätzwerten für Illustration definieren</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">KQ =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, .<span class="dv">01</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso-Schätzer als Funktion des KQ-Schätzers plotten</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> lasso_st, </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">lambda =</span> <span class="dv">0</span>), </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">2</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> lasso_st, </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">lambda =</span> .<span class="dv">2</span>),</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"red"</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> lasso_st, </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">lambda =</span> .<span class="dv">4</span>), </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"blue"</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span>.<span class="dv">4</span>, .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"KQ-Schätzer von beta_1"</span>) <span class="sc">+</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Lasso-Schätzer von beta_1"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-lassoST" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lassoST-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-lassoST-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lassoST-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.6: Shrinkage und Selektion von OLS-Koeffizienten mit Lasso
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-lassoST" class="quarto-xref">Abbildung&nbsp;<span>13.6</span></a> zeigt, dass der <span class="math inline">\(\ell_1\)</span>-Strafterm des Lasso-Schätzers zu einem linearen Verlauf der auf den KQ-Schätzer (gezeichnet für <span class="math inline">\(\lambda = 0\)</span>, gestrichelte Linie) applizierten Shrinkage führt: Der Lasso-Schätzer ist eine abschnittsweise-lineare Funktion des KQ-Schätzers in <span class="math inline">\(\lambda\)</span>: Je größer der Parameter <span class="math inline">\(\lambda\)</span>, desto größer ist das Intervall von KQ-Schätzwerten <span class="math inline">\([-\lambda/2,\lambda/2]\)</span>, wo der Lasso-Schätzer zu Variablenselektion führt, d.h. hier den Koeffizienten <span class="math inline">\(\beta_j\)</span> als <span class="math inline">\(0\)</span> schätzt (rote bzw. blaue Linie).</p>
<p>Anhand von <a href="#fig-lassoST" class="quarto-xref">Abbildung&nbsp;<span>13.6</span></a> kann abgeleitet werden, dass der Lasso-Schätzer nicht invariant gegenüber der Skalierung der Regressoren ist: Die Stärke der Regularisierung durch <span class="math inline">\(\lambda\)</span> ist hängt von der Magnitude des KQ-Schätzers ab. Daher müssen die Regressoren vor Berechnung der Schätzung standardsiert werden. Üblich ist hierbei eine Normierung auf einen Mittelwert von <span class="math inline">\(0\)</span> und eine Varianz von <span class="math inline">\(1\)</span>.</p>
<p>Die nachstehende interaktive Grafik illustriert das Lasso-Optimierungsproblem <span class="math inline">\(\eqref{eq:lassolagrange}\)</span> sowie den resultierenden Schätzer der Koeffizienten <span class="math inline">\((\beta_1, \beta_2)\)</span> in einem multiplen Regressionsmodell mit korrelierten Regressoren <span class="math inline">\(X_1\)</span> und <span class="math inline">\(X_2\)</span>.</p>
<ul>
<li><p>Die blaue Ellipse ist die Menge aller Schätzwerte <span class="math inline">\(\left(\widehat\beta_{1},\, \widehat\beta_{2}\right)\)</span> für den angegebenen Wert von <span class="math inline">\(\mathrm{RSS}\)</span>. Im Zentrum der Ellipse liegt der KQ-Schätzer, welcher <span class="math inline">\(\mathrm{RSS}\)</span> minimiert.</p></li>
<li><p>Das graue Quadrat ist die Menge aller Koeffizienten-Paare <span class="math inline">\((\beta_1, \beta_2)\)</span>, welche die Restriktion <span class="math inline">\(\lvert\beta_1\rvert+\lvert\beta_2\rvert\leq t\)</span> erfüllen. Beachte, dass die Größe dieser Region nur durch den Parameter <span class="math inline">\(t\)</span> bestimmt wird.</p></li>
<li><p>Der blaue Punkt ist der Lasso-Schätzer <span class="math inline">\((\widehat{\boldsymbol{\beta}}^L_{1,t},\, \widehat{\boldsymbol{\beta}}^L_{2,t})\)</span>. Dieser ergibt sich als Schnittpunkt zwischen der blauen <span class="math inline">\(\mathrm{RSS}\)</span>-Ellipse und der Restriktionsregion und variiert mit <span class="math inline">\(t\)</span>. Die gestrichelte rote Linie zeigt den Lasso-Lösungspfad.</p></li>
<li><p>Für kleine Werte, erhalten wir starke Shrinkage auf <span class="math inline">\(\widehat\beta_{1,t}\)</span> bis zum Wertebereich <span class="math inline">\(t\leq50\)</span>, wo <span class="math inline">\(\widehat{\boldsymbol{\beta}}^L_{1,t}=0\)</span>. Hier erfolgt Variablenselektion: Die Regularisierung führt zu einem geschätzten Modell, das lediglich <span class="math inline">\(X_2\)</span> als erklärende Variable enthält. In diesem Bereich von <span class="math inline">\(t\)</span> bewirkt die Shrinkage, dass <span class="math inline">\(\widehat{\boldsymbol{\beta}}^L_{2,t}\to0\)</span> für <span class="math inline">\(t\to0\)</span>.</p></li>
</ul>
<iframe width="100%" height="567" frameborder="0" scroll="false" src="https://observablehq.com/embed/2e11f2b535e23c25@16?cells=viewof+s%2Cchart115">
</iframe>
<p>Beachte, dass der rote Lasso-Pfad (die Menge aller Lasso-Lösungen) äquivalent als Funktion von <span class="math inline">\(\lambda\)</span> im Optimierungsproblem <span class="math inline">\(\eqref{eq:lassoloss}\)</span> dargestellt werden kann. Implementierungen mit statistischer Software berechnen die Lasso-Lösung häufig in Abhängigkeit von <span class="math inline">\(\lambda\)</span>. Ein Algorithmus hierfür ist LARS.</p>
</section>
<section id="berechnung-der-lasso-lösung-mit-dem-lars-algorithmus" class="level3" data-number="13.2.2">
<h3 data-number="13.2.2" class="anchored" data-anchor-id="berechnung-der-lasso-lösung-mit-dem-lars-algorithmus"><span class="header-section-number">13.2.2</span> Berechnung der Lasso-Lösung mit dem LARS-Algorithmus</h3>
<p>Für die Berechnung des Lasso-Lösungspfads kann der <a href="https://en.wikipedia.org/wiki/Least-angle_regression">LARS-Algorithmus</a> von <span class="citation" data-cites="Efronetal2004">Efron u.&nbsp;a. (<a href="Literatur.html#ref-Efronetal2004" role="doc-biblioref">2004</a>)</span> im Lasso-Modus genutzt werden.<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a> Der Lasso-Lösungspfad beinhaltet geschätzte Koeffizienten über ein Intervall für <span class="math inline">\(\lambda\)</span>, welches sämtliche Modellkomplexitäten zwischen der (trivialen) Lösung mit maximaler Shrinkage auf allen Koeffizienten (<span class="math inline">\(\lambda\)</span> groß, alle gesch. Koeffizienten sind <span class="math inline">\(0\)</span>) und der unregularisierten Lösung (<span class="math inline">\(\lambda = 0\)</span>, KQ-Schätzung) abbildet. Der LARS-Algorithmus erzeugt den Lösungspfad sequentiell, sodass die Schätzung als Funktion von <span class="math inline">\(\lambda\)</span> veranschaulicht werden kann, ähnlich wie bei Ridge Regression.</p>
<p>Wir zeigen nun anhand simulierter Daten, wie Lasso-Lösungen mit dem R-Paket <code>lars</code> berechnet werden können. Hierfür erzeugen wir Daten gemäß der Vorschrift <span class="math display">\[\begin{align}
  \begin{split}
  Y_i =&amp;\, \boldsymbol{X}_i' \boldsymbol{\beta}_v + u_i\\
  \\
  \boldsymbol{\beta}_v =&amp;\, (-1.25, -.75, 0, 0, 0, 0, 0, .75, 1.25)'\\
  \\
  \boldsymbol{X}_i \sim&amp;\, N(\boldsymbol{0}, \boldsymbol{I}_{9\times9}), \quad u_i \overset{u.i.v.}{\sim} N(0, 1), \quad i = 1,\dots,25.
  \end{split}\label{eq:larsdgp}
\end{align}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lars)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter definieren</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>beta_v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.25</span>, <span class="sc">-</span>.<span class="dv">75</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, .<span class="dv">75</span>, <span class="fl">1.25</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Beobachtungen simulieren</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(N <span class="sc">*</span> <span class="dv">9</span>), <span class="at">ncol =</span> <span class="dv">9</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> X <span class="sc">%*%</span> beta_v <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Entsprechend des DGP passen wir ein Modell ohne Konstante an. Damit <code>lars::lars()</code> den Lösungspfad des Lasso-Schätzers berechnet, muss <code>type = "lasso"</code> gewählt werden.<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lösungen des Lasso-Schätzers mit LARS berechnen</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  fit_lars <span class="ot">&lt;-</span> <span class="fu">lars</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> X, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> Y, </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> F,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"lasso"</span> <span class="co"># Wichtig: Lasso-Modus</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lars(x = X, y = Y, type = "lasso", intercept = F)
R-squared: 0.858 
Sequence of LASSO moves:
                      
Var  9 2 8 1 3 5 4 7 6
Step 1 2 3 4 5 6 7 8 9</code></pre>
</div>
</div>
<p>Die Zusammenfassung zeigt, dass der LARS-Algorithmus als erstes die (relevante) Variable <span class="math inline">\(X_9\)</span> aktiviert.<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a> Mit abnehmender Regularisierung (kleinere <span class="math inline">\(\lambda\)</span>) werden in den nächsten 3 Schritten die übrigen relevanten Variablen <span class="math inline">\(X_2\)</span>, <span class="math inline">\(X_8\)</span> und <span class="math inline">\(X_1\)</span> aktiviert. Über die weiteren Schritte nähert der Algorithmus die Lösung an die <em>saturierte</em> Schätzung (das Modell mit allen neun Regressoren) an und aktiviert schrittweise die übrigen, irrelevanten Variablen.</p>
<p>Wir visualisieren die geschätzen Koeffizienten an jedem Schritt des Lösungspfads als Funktion von <span class="math inline">\(\lambda\)</span>. In der Praxis wird der Regularisierungsparameter häufig auf der natürlichen log-Skala dargestellt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformation in ein weites Format</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>fit_lars<span class="sc">$</span>beta <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lambda =</span> <span class="fu">c</span>(fit_lars<span class="sc">$</span>lambda, <span class="fl">1e-2</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Variable"</span>, </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"gesch. Koeffizient"</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisierung mit ggplot  </span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">log</span>(lambda), </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">`</span><span class="at">gesch. Koeffizient</span><span class="st">`</span>, </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> Variable</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-larssolpath" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-larssolpath-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-larssolpath-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-larssolpath-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.7: LARS-Lösungspfad für Lasso-Schätzung
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-larssolpath" class="quarto-xref">Abbildung&nbsp;<span>13.7</span></a> zeigt, dass die Shrinkage der geschätzten Koeffizienten nach der Aktivierung rasch abnimmt und sich für kleine Werte von <span class="math inline">\(\lambda\)</span> der KQ-Lösung annähert. Wir sehen auch, dass es einen Bereich von <span class="math inline">\(\lambda\)</span>-Werten gibt, für die das wahre Modell mit den Variablen <span class="math inline">\(X_1\)</span>, <span class="math inline">\(X_2\)</span>, <span class="math inline">\(X_8\)</span> und <span class="math inline">\(X_9\)</span> selektiert werden kann. Je nach Ziel der Analyse kann es sinnvoll sein, ein <span class="math inline">\(\lambda\)</span> in diesem Intervall zu schätzen.</p>
</section>
<section id="wahl-des-regularisierungsparameters-lambda-für-den-lasso-schätzer" class="level3" data-number="13.2.3">
<h3 data-number="13.2.3" class="anchored" data-anchor-id="wahl-des-regularisierungsparameters-lambda-für-den-lasso-schätzer"><span class="header-section-number">13.2.3</span> Wahl des Regularisierungsparameters <span class="math inline">\(\lambda\)</span> für den Lasso-Schätzer</h3>
<p>Wie zuvor bei Ridge Regression muss in empirischen Anwendungen ein Wert für den Tuning-Parameter <span class="math inline">\(\lambda\)</span> gewählt werden. Hierbei besteht die Herausforderung darin, einen geeigneten Wert zu finden, der zu wünschenswerten Eigenschaften des resultierenden Modells führt. So ist für gute Vorhersagen wichtig, dass das Modell nicht zu sehr an die Daten angepasst ist (<em>Overfitting</em>), um eine gute Generalisierung auf neue Daten zu ermöglichen. Gleichzeitig muss das Modell flexibel genug sein, um wesentliche Eigenschaften des datenerzeugenden Prozesses hinreichend gut zu erfassen. In der Regel wird hierbei eine sparsame Modellierung angestrebt, die nur eine Teilmenge der Prädiktoren nutzt.</p>
<p>In der Praxis werden verschiedene Verfahren verwendet, um den Wert für den Tuning-Parameter <span class="math inline">\(\lambda\)</span> zu bestimmen. Gängige Methoden sind <em>Cross Validation</em> (CV) und Informationskriterien. In Abhängigkeit der Methode und der Daten ergeben sich ober- oder unterparameterisierte Modelle. Aufgrund der Implementierung im R-Paket <code>lars</code> betrachten wir CV.<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a> Wir zeigen nachfolgend anhand der simulierten Daten aus dem letzten Abschnitt, wie für die LARS-Schätzung ein optimales <span class="math inline">\(\lambda\)</span> mit leave-one-out CV (LOO-CV) bestimmt werden kann. Hierzu nutzen wir <code>lars::cv.lars()</code> unter Verwendung derselben Argumente wie zuvor im Aufruf von <code>lars()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LARS-Lösungen mit CV evaluieren</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>fit_lars_cv <span class="ot">&lt;-</span> <span class="fu">cv.lars</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> X, </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> Y, </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">intercept =</span> F,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">normalize =</span> T,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"lasso"</span>, </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.it =</span> F, </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> N <span class="co"># für LOO-CV</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das Objekt <code>fit_lars_cv</code> ist eine Liste mit den CV-Ergebnissen. Wir können diese einfach mit <code>ggplot</code> visualisieren. <code>index</code> ist hierbei das Verhältnis der <span class="math inline">\(\ell_1\)</span>-Norm des Lasso-Schätzers für einen spezifischen Wert von <span class="math inline">\(\lambda\)</span> und der <span class="math inline">\(\ell_1\)</span>-Norm des KQ-Schätzers. Das optimale <span class="math inline">\(\lambda\)</span> wird so implizit geschätzt. <code>cv.error</code> ist der mit CV geschätzte MSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CV-MSE</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fit_lars_cv <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> index, </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> cv.error</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"|beta_lambda| / |beta|"</span>) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"CV-MSE"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-larscv" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-larscv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-larscv-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-larscv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.8: CV-MSE und relative Position von <span class="math inline">\(\lambda\)</span> auf dem Lassopfad
</figcaption>
</figure>
</div>
</div>
</div>
<p>In der Grafik erkennen wir ein Minimum des CV-MSEs bei etwa 0.73.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CV-MSE-minimierendes Lambda bestimmen</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>ID <span class="ot">&lt;-</span> <span class="fu">which.min</span>(fit_lars_cv<span class="sc">$</span>cv.error) <span class="co"># Index</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  fraction_opt <span class="ot">&lt;-</span> fit_lars_cv<span class="sc">$</span>index[ID]</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7272727</code></pre>
</div>
</div>
<p>Die geschätzten Koeffizienten für die optimale Regularisierung können mit <code>coef()</code> ausgelesen werden.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LARS-Lasso-Fit für optimales lambda bestimmen</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> fit_lars, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">s =</span> fraction_opt, </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"fraction"</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.6513191 -0.6060906 -0.1946089  0.0000000  0.0000000  0.0000000  0.0000000
[8]  0.4977908  1.3122407</code></pre>
</div>
</div>
<p>Das Ergebnis veranschaulicht die Selektionseigenschaft von Lasso: Gemäß DGP <span class="math inline">\(\eqref{eq:larsdgp}\)</span> sind die Variablen <span class="math inline">\(X_3\)</span> bis <span class="math inline">\(X_7\)</span> <em>irrelevante</em> Prädiktoren für <span class="math inline">\(Y\)</span>; ihre wahren Koeffizienten sind <span class="math inline">\(0\)</span>. In der kreuzvalidierten Lasso-Schätzung erreicht die Regularisierung, dass die Koeffizienten der Variablen <span class="math inline">\(X_4\)</span> bis <span class="math inline">\(X_7\)</span> tatsächlich mit 0 geschätzt werden. Wir schätzen für das mit CV bestimmte <span class="math inline">\(\lambda\)</span> also ein leicht überspezifiziertes Modell mit den Regressoren <span class="math inline">\(X_1\)</span>, <span class="math inline">\(X_2\)</span>, <span class="math inline">\(X_3\)</span>, <span class="math inline">\(X_8\)</span> und <span class="math inline">\(X_9\)</span>. Beachte, dass die Lasso-Schätzung einen Kompromiss impliziert: Die Varianz der Schätzung ist geringer als die des KQ-Schätzers im Modell mit allen Variablen.<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a> Aufgrund der Regularisierung sind die mit Lasso geschätzten Koeffizienten der relevanten Variablen jedoch in Richtung <span class="math inline">\(0\)</span> verzerrt.</p>
<p>Einen positiven Effekt dieses Kompromisses beobachten wir anhand des mittleren Vorhersagefehlers für Daten, die <em>nicht</em> zur Berechnung des Schätzers verwendet wurden. Wir vergleichen den Vorhersagefehler nachfolgend anhand eines solchen simulierten Test-Datensatzes mit 25 neuen Beobachtungen. Den Vorhersagefehler bestimmen wir als MSE zwischen den vorhergesagten und den tatsächlichen Ausprägungen für <span class="math inline">\(Y\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test-Datensatz erstellen</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4321</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>new_X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(N <span class="sc">*</span> <span class="dv">9</span>), <span class="at">ncol =</span> <span class="dv">9</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>new_Y <span class="ot">&lt;-</span> new_X <span class="sc">%*%</span> beta_v <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso: Vorhersage von new_Y für Test-Datensatz</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>Y_predict_lars <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> fit_lars, </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">s =</span> fraction_opt, </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"fit"</span>, </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"fraction"</span>, </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">newx =</span> new_X</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>fit</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso: MSE für Test-Datensatz berechnen</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Y_predict_lars <span class="sc">-</span> new_Y)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.419817</code></pre>
</div>
</div>
<p>Wir schätzen nun das große Modell mit allen 9 Variablen mit KQ und berechnen ebenfalls den MSE der Prognosen für den Test-Datensatz.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ-Schätzung des großen Modells durchführen</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>KQ_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test-Datensatz für predict.lm() formatieren</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>new_X <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(new_X)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(new_X) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"X"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ: Vorhersage von new_Y für Test-Datensatz</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>Y_predict_KQ <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> KQ_fit, </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> new_X</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ: MSE für Test-Datensatz berechnen</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Y_predict_KQ <span class="sc">-</span> new_Y)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.851932</code></pre>
</div>
</div>
<p>Offenbar führt die Lasso-Schätzung zu einem deutlich geringeren MSE der Vorhersage von <code>Y</code> für den Test-Datensatz als die KQ-Schätzung und damit zu einer höheren Vorhersagegüte. Das “sparsame” mit Lasso-Regression geschätzte Modell ist dem “großen” mit KQ geschätztem Modell in dieser Hinsicht also überlegen.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Facts zu Lasso-Regression
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Lasso-Regression bestraft die Verlustfunktion des KQ-Schätzers mit der <span class="math inline">\(\ell_1\)</span>-Norm der Koeffizienten.</p></li>
<li><p>Neben Koeffizientenschätzung mit Shrinkage in Richtung <span class="math inline">\(0\)</span> kann der Lasso-Schätzer Variablenselektion durchführen: Regressionskoeffizienten können exakt mit <span class="math inline">\(0\)</span> geschätzt und so ein “sparsames”, leichter zu interpretierendes Modell gewählt werden.</p></li>
<li><p>Wie bei Ridge Regression impliziert die Wahl von <span class="math inline">\(\lambda\)</span> einen Bias-Variance-Tradeoff, der für Vorhersagen nützlich ist: Für größere <span class="math inline">\(\lambda\)</span> wird mehr Verzerrung induziert und möglicherweise relevante Variablen mit kleinen Koeffizienten aus dem Modell entfernt. Ein solches sparsames Modell kann eine höhere Prognosegüte haben als ein komplexes, unregularisiertes Modell.</p></li>
<li><p>Der Lasso-Schätzer <span class="math inline">\(\widehat{\boldsymbol{\beta}}_\lambda^L\)</span> ist <em>nicht</em> erwartungstreu.</p></li>
<li><p>Lasso Regression kann bspw. mit dem LARS-Algorithmus (Paket <code>lars</code>) oder mit <code>glmnet</code> berechnet werden.</p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="vergleich-von-lasso--und-ridge-regression-mit-simulation" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="vergleich-von-lasso--und-ridge-regression-mit-simulation"><span class="header-section-number">13.3</span> Vergleich von Lasso- und Ridge-Regression mit Simulation</h2>
<p>In diesem Kapitel illustrieren wir Vor- und Nachteile von Lasso- und Ridge-Regression in Prognose-Anwendungen anhand von Monte-Carlo-Simulationen. Wir betrachten hierbei datenerzeugende Prozesse, die sich hinsichtlich der Anzahl relevanter Variablen sowie der Korrelation dieser Variablen unterscheiden.</p>
<p>Die grundlegende Vorschrift für die Simulationen ist <span class="math display">\[\begin{align*}
  Y_i = \sum_{j=1}^{k=40} \beta_j X_{i,j} + u_i, \quad u_i \overset{u.i.v.}{\sim} N(0,1), \quad i=1,\dots,100,
\end{align*}\]</span> wobei die Regressoren <span class="math inline">\(X_j\)</span> eine Varianz von <span class="math inline">\(1\)</span> haben und aus einer multivariaten Normalverteilung mit Korrelation <span class="math display">\[\rho\in(0,0.5,0.8)\]</span> gezogen werden.</p>
<p>Für die Koeffizienten <span class="math inline">\(\boldsymbol{\beta}\)</span> unterscheiden wir zwei Szenarien. In Szenario A ist <span class="math display">\[\boldsymbol{\beta} = (1,\dots,1)',\]</span> d.h. alle Variablen sind relevant und haben denselben Einfluss auf <span class="math inline">\(Y\)</span>. In Szenario B erzeugen wir <span class="math inline">\(\boldsymbol{\beta}\)</span> einmalig vorab so, dass <span class="math display">\[\beta_j = \begin{cases}1,\quad \text{mit Wsk.  }p\\ 0,\quad \text{mit Wsk.  }1-p, \end{cases}\]</span> d.h. nur eine Teilmenge der Variablen beeinflusst <span class="math inline">\(Y\)</span> jeweils mit demselben Effekt <span class="math inline">\(\beta_j = 1\)</span>. Die übrigen Variablen sind irrelevant.</p>
<p>Wir schätzen und validieren die Modelle mit <code>glmnet()</code>.</p>
<section id="sec-pdz" class="level3" data-number="13.3.1">
<h3 data-number="13.3.1" class="anchored" data-anchor-id="sec-pdz"><span class="header-section-number">13.3.1</span> Prognosegüte in diversen Szenarien</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulationsparameter definieren</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>)   <span class="co"># Korrelation</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">40</span>                 <span class="co"># Anz. Regressoren</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span>                <span class="co"># Anz. Beobachtungen</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">100</span>            <span class="co"># Anz. Simulationen</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Damit der Code für die Simulation möglichst wenig repetitiv ist, definieren wir eine Funktion <code>cv.glmnet_MSE()</code>, die unter Angabe der Daten <code>X</code> und <code>Y</code>, des Trainingssets <code>train</code> sowie des Parameters <code>alpha</code> den gewünschten regularisierten Schätzer under Verwendung von Cross Validation anpasst und den Testset-MSE zurückgibt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># allg. Funktion für Testset-MSE nach CV</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>cv.glmnet_MSE <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y, train, alpha) {</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Modell mit glmnet schätzen; lambda per CV bestimmen</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  fit_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> X[train,],</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span>Y[train],</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> alpha</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vorhersagen treffen</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  Y_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> fit_cv, </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">s =</span> fit_cv<span class="sc">$</span>lambda.min, </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">newx =</span> X[<span class="sc">-</span>train,])</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Testset-MSE berechnen</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>      (Y[<span class="sc">-</span>train] <span class="sc">-</span> Y_pred)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir initialisieren zunächst Matrizen, in welche die MSEs aus den 100 Simulationsdurchläufen reihenweise geschrieben werden. <code>lasso_mse</code> und <code>ridge_mse</code> haben je eine Spalte für jede Korrelation in <code>rho</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrizen für simulierte MSEs initialisieren...</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>lasso_mse <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="cn">NA</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> n_sim, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="fu">length</span>(rho)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>ridge_mse <span class="ot">&lt;-</span> lasso_mse</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ... und benennen</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lasso_mse) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Kor="</span>, rho)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ridge_mse) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(lasso_mse)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Für die Simulation iterieren wir mit <code>purrr::walk</code> über den Vektor <code>rho</code> sowie über die Laufvariable <code>1:n_sim</code>. Beide Schleifen nutzen den Syntax für anonyme Funktionen:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Die anonyme Funktion</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) <span class="fu">return</span>(x)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ist äquivalent definiert als</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>\(x) <span class="fu">return</span>(x)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In jeden Simulationsdurchlauf erzeugen wir den Datensatz entsprechend der obigen Vorschrift, teilen die Daten auf und berechnen MSEs für Lasso- und Ridge-Regression mit <code>cv.glmnet_MSE()</code>.</p>
<p><strong>Szenario A</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Koeffizienten-Vektor definieren</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, k) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation durchführen</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(rho), \(j) {</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Korrelationsmatrix definieren</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rho[j], </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> k, </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> k</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diag</span>(Sigma) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk</span>(<span class="dv">1</span><span class="sc">:</span>n_sim, \(i) {</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Daten simulieren</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> N, </span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">rep</span>(<span class="dv">0</span>, k), </span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma =</span> Sigma</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> X <span class="sc">%*%</span> beta <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Trainingsdaten definieren</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>  ID_train <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>N), </span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> N<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Modelle mit CV schätzen und MSEs berechnen</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ridge-Regression</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>  ridge_mse[i, j] <span class="ot">&lt;&lt;-</span> <span class="fu">cv.glmnet_MSE</span>(</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> X, </span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> Y, </span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">train =</span> ID_train, </span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">0</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lasso-Regression</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>  lasso_mse[i, j] <span class="ot">&lt;&lt;-</span> <span class="fu">cv.glmnet_MSE</span>(</span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> X, </span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> Y, </span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">train =</span> ID_train, </span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Beachte, dass hier der Super-Assignment-Operator <code>&lt;&lt;-</code> genutzt wird, damit <code>walk</code> die Matrizen <code>ridge_mse</code> und <code>lasso_mse</code> in der globalen Umgebung überschreibt.<a href="#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a></p>
<p>Wir berechnen jeweils den mittleren MSEs, sammeln die Ergebnisse in einer <code>tibble()</code> und nutzen <code>gt()</code> für die tabellarische Darstellung.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnisse tabellarisch darstellen</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Methode =</span> <span class="fu">c</span>(</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lasso-Regression"</span>, </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ridge-Regression"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colMeans</span>(lasso_mse),</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colMeans</span>(ridge_mse)  </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    )    </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  tabopts</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-lrsimA" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lrsimA-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;13.1: Durchschnittliche Testset-MSEs für Setting A
</figcaption>
<div aria-describedby="tbl-lrsimA-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="vvecpmnxyr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vvecpmnxyr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vvecpmnxyr thead, #vvecpmnxyr tbody, #vvecpmnxyr tfoot, #vvecpmnxyr tr, #vvecpmnxyr td, #vvecpmnxyr th {
  border-style: none;
}

#vvecpmnxyr p {
  margin: 0;
  padding: 0;
}

#vvecpmnxyr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vvecpmnxyr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vvecpmnxyr .gt_title {
  color: #000000;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vvecpmnxyr .gt_subtitle {
  color: #000000;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vvecpmnxyr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vvecpmnxyr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vvecpmnxyr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #000000;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vvecpmnxyr .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vvecpmnxyr .gt_column_spanner_outer {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vvecpmnxyr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vvecpmnxyr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vvecpmnxyr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vvecpmnxyr .gt_spanner_row {
  border-bottom-style: hidden;
}

#vvecpmnxyr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vvecpmnxyr .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vvecpmnxyr .gt_from_md > :first-child {
  margin-top: 0;
}

#vvecpmnxyr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vvecpmnxyr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vvecpmnxyr .gt_stub {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_stub_row_group {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vvecpmnxyr .gt_row_group_first td {
  border-top-width: 2px;
}

#vvecpmnxyr .gt_row_group_first th {
  border-top-width: 2px;
}

#vvecpmnxyr .gt_summary_row {
  color: #000000;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vvecpmnxyr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vvecpmnxyr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vvecpmnxyr .gt_grand_summary_row {
  color: #000000;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vvecpmnxyr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vvecpmnxyr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vvecpmnxyr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
}

#vvecpmnxyr .gt_footnotes {
  color: #000000;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vvecpmnxyr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_sourcenotes {
  color: #000000;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vvecpmnxyr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_left {
  text-align: left;
}

#vvecpmnxyr .gt_center {
  text-align: center;
}

#vvecpmnxyr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vvecpmnxyr .gt_font_normal {
  font-weight: normal;
}

#vvecpmnxyr .gt_font_bold {
  font-weight: bold;
}

#vvecpmnxyr .gt_font_italic {
  font-style: italic;
}

#vvecpmnxyr .gt_super {
  font-size: 65%;
}

#vvecpmnxyr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vvecpmnxyr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vvecpmnxyr .gt_indent_1 {
  text-indent: 5px;
}

#vvecpmnxyr .gt_indent_2 {
  text-indent: 10px;
}

#vvecpmnxyr .gt_indent_3 {
  text-indent: 15px;
}

#vvecpmnxyr .gt_indent_4 {
  text-indent: 20px;
}

#vvecpmnxyr .gt_indent_5 {
  text-indent: 25px;
}

#vvecpmnxyr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#vvecpmnxyr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Methode" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Methode</th>
<th id="Kor=0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Kor=0</th>
<th id="Kor=0.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Kor=0.5</th>
<th id="Kor=0.8" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Kor=0.8</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Methode">Lasso-Regression</td>
<td class="gt_row gt_right" headers="Kor=0">7.17</td>
<td class="gt_row gt_right" headers="Kor=0.5">10.398</td>
<td class="gt_row gt_right" headers="Kor=0.8">7.581</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Methode">Ridge-Regression</td>
<td class="gt_row gt_right" headers="Kor=0">4.841</td>
<td class="gt_row gt_right" headers="Kor=0.5">1.615</td>
<td class="gt_row gt_right" headers="Kor=0.8">1.517</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-lrsimA" class="quarto-xref">Tabelle&nbsp;<span>13.1</span></a> zeigt, dass Ridge-Regression gegenüber Lasso-Regression für jede der drei betrachteten Korrelationen überlegen ist. Insbesondere bei stärker korrelierten Regressoren ist Ridge vorteilhaft.</p>
<p>Für Szenario B überschreiben wir <code>beta</code> nach Multiplikation mit einem zufälligen binären Vektor, sodass einige der Koeffizienten <span class="math inline">\(0\)</span> und die zugehörigen Variablen irrelevant für <span class="math inline">\(Y\)</span> sind.</p>
<p><strong>Szenario B</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wsk. für Relevanz einer Variable</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> .<span class="dv">3</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Koeffizienten-Vektor definieren</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> beta <span class="sc">*</span> <span class="fu">sample</span>(</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> k, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> T, </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>p, p)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Koeffizienten prüfen</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(beta, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 1 0 1 1 0 0 1 0 0</code></pre>
</div>
</div>
<p>Eine wiederholung der Simulation für die modifizierten Koeffizienten <code>beta</code> und liefert folgende tabellarische Auswertung.</p>
<div class="cell">
<div id="tbl-lrsimB" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lrsimB-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;13.2: Durchschnittliche Testset-MSEs für Szenario B
</figcaption>
<div aria-describedby="tbl-lrsimB-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="vvecpmnxyr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vvecpmnxyr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vvecpmnxyr thead, #vvecpmnxyr tbody, #vvecpmnxyr tfoot, #vvecpmnxyr tr, #vvecpmnxyr td, #vvecpmnxyr th {
  border-style: none;
}

#vvecpmnxyr p {
  margin: 0;
  padding: 0;
}

#vvecpmnxyr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vvecpmnxyr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vvecpmnxyr .gt_title {
  color: #000000;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vvecpmnxyr .gt_subtitle {
  color: #000000;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vvecpmnxyr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vvecpmnxyr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vvecpmnxyr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #000000;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vvecpmnxyr .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vvecpmnxyr .gt_column_spanner_outer {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vvecpmnxyr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vvecpmnxyr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vvecpmnxyr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vvecpmnxyr .gt_spanner_row {
  border-bottom-style: hidden;
}

#vvecpmnxyr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vvecpmnxyr .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vvecpmnxyr .gt_from_md > :first-child {
  margin-top: 0;
}

#vvecpmnxyr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vvecpmnxyr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vvecpmnxyr .gt_stub {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_stub_row_group {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vvecpmnxyr .gt_row_group_first td {
  border-top-width: 2px;
}

#vvecpmnxyr .gt_row_group_first th {
  border-top-width: 2px;
}

#vvecpmnxyr .gt_summary_row {
  color: #000000;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vvecpmnxyr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vvecpmnxyr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vvecpmnxyr .gt_grand_summary_row {
  color: #000000;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vvecpmnxyr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vvecpmnxyr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vvecpmnxyr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
}

#vvecpmnxyr .gt_footnotes {
  color: #000000;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vvecpmnxyr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_sourcenotes {
  color: #000000;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vvecpmnxyr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vvecpmnxyr .gt_left {
  text-align: left;
}

#vvecpmnxyr .gt_center {
  text-align: center;
}

#vvecpmnxyr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vvecpmnxyr .gt_font_normal {
  font-weight: normal;
}

#vvecpmnxyr .gt_font_bold {
  font-weight: bold;
}

#vvecpmnxyr .gt_font_italic {
  font-style: italic;
}

#vvecpmnxyr .gt_super {
  font-size: 65%;
}

#vvecpmnxyr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vvecpmnxyr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vvecpmnxyr .gt_indent_1 {
  text-indent: 5px;
}

#vvecpmnxyr .gt_indent_2 {
  text-indent: 10px;
}

#vvecpmnxyr .gt_indent_3 {
  text-indent: 15px;
}

#vvecpmnxyr .gt_indent_4 {
  text-indent: 20px;
}

#vvecpmnxyr .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Methode" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Methode</th>
<th id="Kor=0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Kor=0</th>
<th id="Kor=0.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Kor=0.5</th>
<th id="Kor=0.8" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Kor=0.8</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Methode">Lasso</td>
<td class="gt_row gt_right" headers="Kor=0">2.51</td>
<td class="gt_row gt_right" headers="Kor=0.5">2.143</td>
<td class="gt_row gt_right" headers="Kor=0.8">1.923</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Methode">Ridge</td>
<td class="gt_row gt_right" headers="Kor=0">3.331</td>
<td class="gt_row gt_right" headers="Kor=0.5">2.562</td>
<td class="gt_row gt_right" headers="Kor=0.8">2.014</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>Die Ergebnisse in <a href="#tbl-lrsimB" class="quarto-xref">Tabelle&nbsp;<span>13.2</span></a> zeigen, dass Ridge-Regression in Szenario B bis auf den Fall unkorrelierter Regressoren etwas schlechter abschneidet als in Szenario A. Die hohe Anzahl irrelevanter Variablen verbessert die Leistung von Lasso deutlich: Hier ist es plausibel, dass Lasso aufgrund der Thresholding-Eigenschaft die Koeffizienten einiger irrelevanten Variablen häufig exakt <span class="math inline">\(0\)</span> setzt und damit ein sparsameres Modell schätzt als Ridge. Entsprechend erzielt Lasso in diesem Szenario insbesondere für <span class="math inline">\(\rho = 0\)</span> genauere Vorhersagen als Ridge Regression.</p>
</section>
<section id="visualisierung-des-bias-variance-tradeoffs-bei-prognosen" class="level3" data-number="13.3.2">
<h3 data-number="13.3.2" class="anchored" data-anchor-id="visualisierung-des-bias-variance-tradeoffs-bei-prognosen"><span class="header-section-number">13.3.2</span> Visualisierung des Bias-Variance-Tradeoffs bei Prognosen</h3>
<p>Für ein besseres Verständnis, wie sich der Regularisierungsparameter <span class="math inline">\(\lambda\)</span> auf den Bias-Variance-Tradeoff bei Prognosen mit Ridge- und Lasso-Regression auswirkt, vergleichen wir für beide Methoden nachfolgend die Abhängigkeit des MSEs der Prognose <span class="math inline">\(\widehat{Y}_0\)</span> für den Wert <span class="math inline">\(Y_0\)</span> der abhängigen Variable eines Datenpunkts anhand seiner Regressoren <span class="math inline">\(\boldsymbol{X}_0'\)</span>, wobei <span class="math display">\[\begin{align}
  \text{MSE}(\widehat{Y}_0) = \text{Bias}(\widehat{Y}_0)^2 + \text{Var}(\widehat{Y}_0) + \text{Var}(Y_0) \label{eq:pbvdecomp}
\end{align}\]</span> Beachte, dass <span class="math inline">\(\text{Var}(Y_0)\)</span> die durch den datenerzeugenden Prozess (und damit unvermeidbare) Varianz von <span class="math inline">\(Y_0\)</span> ist, wohingegen <span class="math inline">\(\text{Bias}(\widehat{Y}_0)^2\)</span> und <span class="math inline">\(\text{Var}(\widehat{Y}_0)\)</span> von dem verwendeten Schätzer für <span class="math inline">\(\widehat{Y}_0\)</span> abhängt.</p>
<p>Für die Simulation betrachten wir erneut Szenario A aus <a href="#sec-pdz" class="quarto-xref"><span>Kapitel 13.3.1</span></a> mit <span class="math inline">\(50\)</span> Beobachtungen für ein Modell mit <span class="math inline">\(40\)</span> unkorrelierten Regressoren. Wir legen zunächst die Simulationsparameter fest und erzeugen den vorherzusagenden Datenpunkt (<code>X_0</code>, <code>Y_0</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter festlegen</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># Anz. Iterationen</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">50</span>  <span class="co"># Anz. Beobachtungen</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">40</span>  <span class="co"># Anz. Variablen</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Korrelationsmatrix definieren</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(k) <span class="co"># Diagonalmatrix</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="at">x =</span> <span class="dv">1</span>, k)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Prognose-Ziel vorab zufällig generieren:</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Regressoren</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>X_0 <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span>, </span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">rep</span>(<span class="at">x =</span> <span class="dv">0</span>, k)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Abh. Variable</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>Y_0 <span class="ot">&lt;-</span> X_0 <span class="sc">%*%</span> beta <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Anhand der Simulationsergebnisse wollen wir die von der verwendeten Schätzfunktion abhängigen Komponenten von <span class="math inline">\(\eqref{eq:pbvdecomp}\)</span> untersuchen. Wir initialisieren hierzu die Listen <code>ridge_fits</code> und <code>lasso_fits</code>, in die unsere Simulationsergebnisse geschrieben werden.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Listen für Simulationsergebnisse initialisieren</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ridge_fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>lasso_fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Weiterhin definieren wir separate <span class="math inline">\(\lambda\)</span>-Sequenzen für Lasso- und Ridge-Schätzer.<a href="#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda-Sequenzen festlegen</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>lambdas_r <span class="ot">&lt;-</span> <span class="fu">seq</span>(.<span class="dv">25</span>, <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>lambdas_l <span class="ot">&lt;-</span> <span class="fu">seq</span>(.<span class="dv">05</span>, <span class="fl">0.5</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Für die Simulation iterieren wir mit <code>walk()</code> über simulierte Datensätze und schreiben jeweils den vollständigen Output von <code>glmnet()</code> in die zuvor definierten Listen <code>ridge_fits</code> und <code>lasso_fits</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(<span class="dv">1</span><span class="sc">:</span>n, \(i) {</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Daten simulieren</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> N, </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">rep</span>(<span class="dv">0</span>, k), </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma =</span> Sigma</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> X <span class="sc">%*%</span> beta <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Modelle mit glmnet schätzen</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ridge-Regression</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  ridge_fits[[i]] <span class="ot">&lt;&lt;-</span> <span class="fu">glmnet</span>(</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> X, </span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> Y, </span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">0</span>, </span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> F</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lasso-Regression</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  lasso_fits[[i]] <span class="ot">&lt;&lt;-</span> <span class="fu">glmnet</span>(</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> X, </span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> Y, </span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>, </span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> F</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir nutzen Funktionen aus <code>purrr</code> und <code>dplyr</code>, um über die in den Simulationsdurchläufen angepassten Modelle zu iterieren. Mit <code>predict()</code> erhalten wir Punktvorhersagen für <code>Y_0</code> für jedes <span class="math inline">\(\lambda\)</span> der zuvor definierten <span class="math inline">\(\lambda\)</span>-Sequenzen. Beachte, dass <code>map()</code> jeweils eine Liste mit 200 Punktvorhersagen für jedes der 100 zurückgibt. Mit <code>list_rbind()</code> können wir die Ergebnisse komfortabel jeweils in einer <code>tibble</code> sammeln.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prognosen für Ridge-Regression</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pred_r <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> ridge_fits, </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">as_tibble</span>(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">object =</span> ., </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">s =</span> lambdas_r, </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">newx =</span> X_0</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>() </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Prognosen für Lasso-Regression</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>pred_l <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> lasso_fits, </span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">as_tibble</span>(</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">object =</span> ., </span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">s =</span> lambdas_l, </span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">newx =</span> X_0)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_rbind</span>() </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Für die statistische Auswertung berechnen wir jeweils <span class="math inline">\(\text{MSE}(\widehat{Y}_0)\)</span>, <span class="math inline">\(\text{Bias}(\widehat{Y}_0)^2\)</span> und <span class="math inline">\(\text{Var}(\widehat{Y}_0)\)</span> und führen die Ergebnisse mit <code>pivot_longer()</code> in ein langes Format <code>sim_data_r</code> über. Wir berechnen weiterhin mit <code>MSE_min_r</code> das <span class="math inline">\(\lambda\)</span>, für das wir über die Simulationsdurchläufe durchschnittlich den geringsten <span class="math inline">\(\text{MSE}\)</span> beobachten.</p>
<p><strong>Ridge-Regression</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnisse für Ridge-Regression zusammenfassen</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>sim_data_r <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda =</span> lambdas_r,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MSE"</span> <span class="ot">=</span> <span class="fu">map_dbl</span>(</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.x =</span> pred_r,  </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">mean</span>((.x <span class="sc">-</span> Y_0)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bias^2"</span> <span class="ot">=</span> <span class="fu">map_dbl</span>(</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.x =</span> pred_r, </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="sc">~</span> (<span class="fu">mean</span>(.x) <span class="sc">-</span> Y_0)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Varianz"</span> <span class="ot">=</span> <span class="fu">map_dbl</span>(</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">.x =</span> pred_r, </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">var</span>(.x)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>lambda, </span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Wert"</span>,</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Statistik"</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda bei MSE-Minimum bestimmen</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>MSE_min_r <span class="ot">&lt;-</span> sim_data_r <span class="sc">%&gt;%</span> </span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>    Statistik <span class="sc">==</span> <span class="st">"MSE"</span>,</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>    Wert <span class="sc">==</span> <span class="fu">min</span>(Wert)</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Lasso-Regression</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnisse zusammenfassen</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>sim_data_l <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda =</span> lambdas_l,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MSE"</span> <span class="ot">=</span> <span class="fu">map_dbl</span>(</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.x =</span> pred_l,  </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">mean</span>((. <span class="sc">-</span> Y_0)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bias^2"</span> <span class="ot">=</span> <span class="fu">map_dbl</span>(</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.x =</span> pred_l, </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="sc">~</span> (<span class="fu">mean</span>(.) <span class="sc">-</span> Y_0)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Varianz"</span> <span class="ot">=</span> <span class="fu">map_dbl</span>(</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">.x =</span> pred_l, </span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">var</span>(.)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>lambda, </span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Wert"</span>, </span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Statistik"</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda bei MSE-Minimum bestimmen</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>MSE_min_l <span class="ot">&lt;-</span> sim_data_l <span class="sc">%&gt;%</span> </span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    Statistik <span class="sc">==</span> <span class="st">"MSE"</span>,</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    Wert <span class="sc">==</span> <span class="fu">min</span>(Wert)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Die Datensätze im langen Format, <code>sim_data_r</code> und <code>sim_data_l</code>, werden nun für die Visualisierung der Ergebnisse mit <code>ggplo2</code> genutzt.</p>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MSE, Bias^2 und Varianz gegen Lambda plotten</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge-Regression</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>sim_data_r <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> lambda, </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> Wert, </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> Statistik</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> MSE_min_r)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso-Regression</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>sim_data_l <span class="sc">%&gt;%</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> lambda, </span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> Wert, </span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> Statistik</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> MSE_min_l)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-MSEBVT" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-MSEBVT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-MSEBVT" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-MSEBVT-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-MSEBVT-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-MSEBVT-1.png" class="img-fluid figure-img" data-ref-parent="fig-MSEBVT" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-MSEBVT-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Ridge Regression
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-MSEBVT" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-MSEBVT-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-MSEBVT-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-MSEBVT-2.png" class="img-fluid figure-img" data-ref-parent="fig-MSEBVT" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-MSEBVT-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Lasso Regression
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-MSEBVT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.9: Simulierte MSE-Komponenten in Abhängigkeit von Lambda
</figcaption>
</figure>
</div>
<p>Anhand von <a href="#fig-MSEBVT" class="quarto-xref">Abbildung&nbsp;<span>13.9</span></a> lässt sich der Bias-Variance-Tradeoff bei der Vorhersage von <span class="math inline">\(Y_0\)</span> gut erkennen: Bereits für kleine <span class="math inline">\(\lambda\)</span> erzielen beide Methode eine deutliche Reduktion des MSE. Dies wir durch etwas zusätzlichen Bias, aber eine überproportionale Verringerung der Varianz erreicht. Der erkennbare funktionale Zusammenhang zeigt, dass der MSE eine konvexe Funktion von <span class="math inline">\(\lambda\)</span> ist. Damit existieren optimale <span class="math inline">\(\lambda\)</span> mit minimalem MSE (grüne Punkte), die wir mit Cross Validation schätzen können.</p>
</section>
</section>
<section id="inferenz-für-treatment-effekt-schätzung-mit-vielen-variablen" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="inferenz-für-treatment-effekt-schätzung-mit-vielen-variablen"><span class="header-section-number">13.4</span> Inferenz für Treatment-Effekt-Schätzung mit vielen Variablen</h2>
<p>In empirischen Studien des Effekts einer Behandlungsvariable <span class="math inline">\(B\)</span> auf eine Outcome-Variable <span class="math inline">\(Y\)</span> steht häufig eine Vielzahl potentieller Kontrollvariablen zur Verfügung. Häufig ist unklar, welche Variablen in das Modell aufgenommen werden sollten, um das Risiko einer verzerrten Schätzung durch ausgelassene Variablen zu vermindern und gleichzeitig eine Schätzung mit geringer Varianz zu gewährleisten. Ist der Beobachtungsumfang <span class="math inline">\(N\)</span> relativ zur Variablenanzahl <span class="math inline">\(k\)</span> groß, so kann die KQ-Schätzung einer langen Regression (ein Modell mit allen <span class="math inline">\(k\)</span> Kontrollvariablen) gute Ergebnisse liefern. In der Praxis liegt diese wünschenswerte Situation jedoch oft nicht vor und es ist <span class="math inline">\(k\lesssim N\)</span> oder sogar <span class="math inline">\(k&gt;N\)</span>. Dann ist eine KQ-Schätzung des Behandlungseffekts anhand aller <span class="math inline">\(k\)</span> Variablen mit hoher Varianz behaftet bzw. gar nicht möglich.<a href="#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a> Ein weiteres Szenario ist <span class="math inline">\(k(N)&gt;N\)</span>, d.h. die Anzahl der Regressoren kann mit dem Beobachtungsumfang wachsen.<a href="#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a> Lasso-Verfahren können dann hilfreich sein, um Determinanten von <span class="math inline">\(Y\)</span> <em>und</em> <span class="math inline">\(B\)</span> zu identifizieren und damit eine Menge an Kontrollvariablen zu selektieren, für die eine erwartungstreue und konsistente Schätzung des interessierenden Effekts wahrscheinlich ist.</p>
<p>Betrachte zunächst das Modell mit allen Kontrollvariablen <span class="math inline">\(X_j\)</span>, <span class="math display">\[\begin{align}
  Y_i = \beta_0 + \alpha_0 B_i + \sum_{j=1}^k \beta_{j} X_{i,j} + u_i, \label{eq:lassotmt}
\end{align}\]</span> wobei einige <span class="math inline">\(\beta_{j}=0\)</span> sind und wir annehmen, dass <span class="math inline">\(B\)</span> lediglich mit ein paar der <span class="math inline">\(X_j\)</span> korrelliert. Die Shrinkage der geschätzten Koeffizienten aus einer naiven Lasso-Regression von <span class="math inline">\(\eqref{eq:lassotmt}\)</span> führt grundsätzlich zu einer verzerrten Schätzung des Behandlungseffekts <span class="math inline">\(\alpha_0\)</span> und damit zu ungültiger Inferenz.<a href="#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a></p>
<p>Die Verzerrung von geschätzten Koeffizienten kann vermieden werden, indem Lasso lediglich zur Selektion von Kontrollvariablen verwendet wird. Dabei wird mit einer Lasso-Regression von <span class="math inline">\(Y\)</span> auf die <span class="math inline">\(X_j\)</span> eine Teilmenge von Regressoren <span class="math inline">\(\mathcal{S}\)</span> selektiert und der Treatment-Effekt anschließend mit der KQ-Schätzung von <span class="math display">\[\begin{align}
  Y_i = \beta_0 + \alpha_0 B_i + \sum_{j\in\mathcal{S}} \beta_{j} X_{i,j} + e_i,
\end{align}\]</span> basierend auf der Selektion <span class="math inline">\(\mathcal{S}\)</span> berechnet wird.<a href="#fn22" class="footnote-ref" id="fnref22" role="doc-noteref"><sup>22</sup></a> Ein solcher <em>Post-Lasso-Selection-Schätzer</em> <span class="citation" data-cites="BelloniChernozhukov2013">(<a href="Literatur.html#ref-BelloniChernozhukov2013" role="doc-biblioref">Belloni und Chernozhukov 2013</a>)</span> ist jedoch im Allgemeinen und insbesondere in hoch-dimensionalen Settings nicht konsistent für <span class="math inline">\(\alpha_0\)</span> und nicht asymptotisch normalverteilt, da weiterhin die Gefahr einer verzerrten Schätzung durch in <span class="math inline">\(\mathcal{S}\)</span> ausgelassene Variablen besteht, die mit <span class="math inline">\(B\)</span> korrelieren: Lasso selektiert Variablen <span class="math inline">\(X_j\)</span>, die “gut” <span class="math inline">\(Y\)</span> erklären. Dabei kann nicht ausgeschlossen werden, das ein Modell gewählt wird, dass relevante Determinanten von <span class="math inline">\(B\)</span> auslässt. Selbst wenn wir ein mit Lasso gewähltes Modell mit KQ (d.h. ohne Shrinkage) schätzen, würde <span class="math inline">\(\alpha_0\)</span> verzerrt geschätzt!</p>
<p><span class="citation" data-cites="Bellonietal2014">Belloni, Chernozhukov, und Hansen (<a href="Literatur.html#ref-Bellonietal2014" role="doc-biblioref">2014</a>)</span> schlagen ein alternatives Verfahren vor, dass auf Selektion der Determinanten <span class="math inline">\(X_j\)</span> von <span class="math inline">\(Y\)</span> und <span class="math inline">\(B\)</span> basiert. Dieses Verfahren wird als <em>Post-Double Selection</em> bezeichnet und kann wiefolgt implementiert werden:</p>
<p><strong>Post-Double-Selection-Schätzer</strong></p>
<ol type="1">
<li><p>Bestimme die Determinanten <span class="math inline">\(X_j\)</span> von <span class="math inline">\(Y\)</span> mit Lasso-Regression und bezeichne die Menge der selektierten Variablen als <span class="math inline">\(\mathcal{S}_Y\)</span>.</p></li>
<li><p>Bestimme die Determinanten <span class="math inline">\(X_j\)</span> von <span class="math inline">\(B\)</span> mit Lasso-Regression und bezeichne die Menge der selektierten Variablen als <span class="math inline">\(\mathcal{S}_B\)</span>.</p></li>
<li><p>Bestimme die Schnittmenge <span class="math inline">\(\mathcal{S}_{YB} = \mathcal{S}_Y \cap \mathcal{S}_B\)</span>. Schätze den Treatment-Effekt als <span class="math inline">\(\widehat{\alpha}_0\)</span> in der KQ-Regression <span class="math display">\[\begin{align}
  Y_i = \beta_0 + \alpha_0 B_i + \sum_{j\in\mathcal{S}_{YB}} \beta_{j} X_{i,j} + v_i.
\end{align}\]</span></p></li>
</ol>
<p><span class="citation" data-cites="Bellonietal2014">Belloni, Chernozhukov, und Hansen (<a href="Literatur.html#ref-Bellonietal2014" role="doc-biblioref">2014</a>)</span> zeigen, dass <span class="math inline">\(\widehat{\alpha}_0\)</span> aus diesem Verfahren ein asymptotisch normalverteiler Schätzer für <span class="math inline">\(\alpha_0\)</span> ist und herkömmliche t-Tests und Konfidenzintervalle gültige Inferenz erlauben.</p>
<p>Wir illustrieren die in diesem Abschnitt betrachteten Schätzer nun anhand simulierter Daten mit R. Die fiktive Problemstellung ist die Schätzung eines wahren Treatment-Effekts <span class="math inline">\(\alpha_0 = 2\)</span>, wenn so viele potenzielle Kontrollvariablen vorliegen, dass der KQ-Schätzer gerade noch berechnet werden kann, aber aufgrund hoher Varianz unzuverlässig ist. Hierzu erzeugen wir <span class="math inline">\(Y\)</span> gemäß der Vorschrift <span class="math display">\[\begin{align*}
  Y_i =&amp;\, \alpha_0 B_i + \sum_{j=1}^{k_Y} \beta_{j}^Y X_{i,j}^Y + \sum_{l=1}^{k_{YB}} \beta_{l}^{YB} X_{i,l}^{YB} + u_i,\\
  \\
  \beta_j^{YB} \overset{u.i.v}{\sim}&amp;\,N(10,1), \quad \beta_j^{Y} \overset{u.i.v}{\sim}U(0,1), \quad u_i \overset{u.i.v}{\sim}N(0,1).\\
  \\
  i=&amp;\,1,\dots,550
\end{align*}\]</span></p>
<p>Die Behandlungsvariable <span class="math inline">\(B_i\)</span> entspricht der Vorschrift <span class="math display">\[\begin{align*}
  B_i =&amp;\, \sum_{l=1}^{k_{YB}} \beta_{l}^{YB} X_{i,l}^{YB} + e_i,\\
  \\
  \beta_j^{YB} \overset{u.i.v}{\sim}&amp;\,N(2,0.2), \quad e_i \overset{u.i.v}{\sim}N(0,1).
\end{align*}\]</span> Wir wählen <span class="math inline">\(k_{YB} = k_{Y} = 25\)</span>. Zusätzlich zu <span class="math inline">\(B\)</span>, den Determinanten von <span class="math inline">\(Y\)</span> <em>und</em> <span class="math inline">\(B\)</span> (<span class="math inline">\(X^{YB}\)</span>) sowie den Variablen, die ausschließlich <span class="math inline">\(Y\)</span> beeinflussen (<span class="math inline">\(X^{Y}\)</span>) gibt es <span class="math inline">\(k_U = 499\)</span> Variablen <span class="math inline">\(X^U\)</span>, die weder <span class="math inline">\(Y\)</span> noch <span class="math inline">\(B\)</span> beeinflussen und damit irrelevant für die Schätzung des Behandlungseffekts sind. Wir haben also <span class="math inline">\(N=550\)</span> Beobachtungen und insgesamt <span class="math inline">\(k = 1+k_{Y} + k_{YB} + k_{U} = 550\)</span> potenzielle Kontrollvariablen von denen <span class="math inline">\(k_{YB} = 25\)</span> für eine unverzerrte Schätzung von <span class="math inline">\(\alpha_0\)</span> relevant sind.</p>
<p>Der nachstehende Code generiert die Daten gemäß der Vorschrift.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4321</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">550</span>      <span class="co"># Beobachtungen</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>p_Y <span class="ot">&lt;-</span> <span class="dv">25</span>     <span class="co"># Determinanten Y</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>p_B <span class="ot">&lt;-</span> <span class="dv">25</span>     <span class="co"># Determinanten B *und* Y</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>p_U <span class="ot">&lt;-</span> <span class="dv">499</span>    <span class="co"># irrelevante Variablen </span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Variablen generieren</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>XB <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(<span class="at">n =</span> n, <span class="at">sigma =</span> <span class="fu">diag</span>(p_B))</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>XU <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(<span class="at">n =</span> n, <span class="at">sigma =</span> <span class="fu">diag</span>(p_U))</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>XY <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(<span class="at">n =</span> n, <span class="at">sigma =</span> <span class="fu">diag</span>(p_Y))</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Stetige Behandlungsvariable erzeugen</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> XB <span class="sc">%*%</span> <span class="fu">rnorm</span>(p_B, <span class="dv">2</span>, <span class="at">sd =</span> .<span class="dv">2</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Abh. Variable erzeugen, Behandlungseffekt (ATE) ist 2</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> B <span class="sc">+</span> </span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  XB <span class="sc">%*%</span> <span class="fu">rnorm</span>(p_B, <span class="at">mean =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  XY <span class="sc">%*%</span> <span class="fu">runif</span>(p_Y) <span class="sc">+</span> </span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(n)</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Variablen in tibble sammeln</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(B, XB, XU, XY) <span class="sc">%&gt;%</span> </span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Namen zuweisen</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"B"</span>, </span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"XB"</span>, <span class="dv">1</span><span class="sc">:</span>p_B), </span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"XU"</span>, <span class="dv">1</span><span class="sc">:</span>p_U),</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"XY"</span>, <span class="dv">1</span><span class="sc">:</span>p_Y) </span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wünschenswert wäre die KQ-Schätzung des wahren Modells. Diese ergibt eine Schätzung nahe des wahren Treatment-Effekts <span class="math inline">\(\alpha_0 = 2\)</span>. Unter realen Bedingungen wäre diese Regression jedoch nicht implementierbar, weil die relevanten Kovariablen <code>XB</code> unbekannt sind.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ: Wahres Modell schätzen</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Y <span class="sc">~</span> B <span class="sc">+</span> XB <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">$</span>coefficients[<span class="st">"B"</span>]</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       B 
1.937031 </code></pre>
</div>
</div>
<p>Wir schätzen daher zunächst die “lange” Regression mit allen <span class="math inline">\(k\)</span> verfügbaren Variablen mit KQ. Beachte, dass der KQ-Schätzer für <span class="math inline">\(\alpha_0\)</span> zwar implementierbar und erwartungstreu ist, jedoch eine hohe Varianz aufweist. Wegen <span class="math inline">\(k=N=550\)</span> erhalten wir eine perfekte Anpassung an die Daten und können mangels Freiheitsgraden keine Hypothesentests durchführen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ: Lange Regression schätzen</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Y <span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> X)<span class="sc">$</span>coefficients[<span class="st">"B"</span>]</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       B 
3.079497 </code></pre>
</div>
</div>
<p>Die KQ-Schätzung von <span class="math inline">\(\alpha_0\)</span> anhand der langen Regression weicht deutlich vom wahren Wert <span class="math inline">\(\alpha_0 = 2\)</span> ab.</p>
<p>Eine “kurze” KQ-Regression nur mit der Behandlungsvariable <span class="math inline">\(B\)</span> führt wegen Korrelation mit den ausgelassenen Determinanten in <code>XB</code> zu einer deutlich verzerrten Schätzung.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KQ: Kurze Regression</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Y <span class="sc">~</span> B <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">$</span>coefficients[<span class="st">"B"</span>]</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       B 
6.716837 </code></pre>
</div>
</div>
<p>Die Methoden von <span class="citation" data-cites="BelloniChernozhukov2013">Belloni und Chernozhukov (<a href="Literatur.html#ref-BelloniChernozhukov2013" role="doc-biblioref">2013</a>)</span> und <span class="citation" data-cites="Bellonietal2014">Belloni, Chernozhukov, und Hansen (<a href="Literatur.html#ref-Bellonietal2014" role="doc-biblioref">2014</a>)</span> sind im R-Paket <code>hdm</code> implementiert. Mit den Funktionen <code>hrm::rlasso()</code> und <code>hdm::rlassoEffect</code> kann Lasso-Regression sowie Post- und Double-Post-Selection durchgeführt werden.<a href="#fn23" class="footnote-ref" id="fnref23" role="doc-noteref"><sup>23</sup></a></p>
<p>Wir berechnen zunächst den naiven Lasso-Schätzer in einem Modell mit allen Variablen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hdm)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Naiver Post-Lasso-Schätzer</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>lasso <span class="ot">&lt;-</span> <span class="fu">rlasso</span>(</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> X, </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> Y, </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">intercept =</span> F, </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">post =</span> F</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Koeffizientenschätzer auslesen</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>lasso<span class="sc">$</span>coefficients[<span class="st">"B"</span>] </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       B 
6.368456 </code></pre>
</div>
</div>
<p>Auch dieser Schätzer ist deutlich verzerrt. Problematisch ist hier nicht nur die Shrinkage auf <span class="math inline">\(\widehat{\alpha}_0\)</span>, sondern die Selektion der Variablen in <code>XB</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Welche Variablen in XB selektiert Lasso *nicht*?</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>nselektiert <span class="ot">&lt;-</span> <span class="fu">which</span>(lasso<span class="sc">$</span>coef[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>] <span class="sc">==</span> <span class="dv">0</span>)   <span class="co"># ID</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Namen auslesen</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lasso<span class="sc">$</span>coef[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>])[nselektiert]</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "XB8"  "XB10" "XB16" "XB18" "XB20"</code></pre>
</div>
</div>
<p>Durch das Auslassen dieser Determinanten von <span class="math inline">\(Y\)</span> und <span class="math inline">\(B\)</span> leidet der Lasso-Schätzer unter OVB.</p>
<p>Als nächstes berechnen wir den Post-Lasso-Selection-Schätzer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-Lasso-Selection-Schätzer berechnen</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>p_lasso <span class="ot">&lt;-</span> <span class="fu">rlasso</span>(</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> X,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> Y, </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">intercept =</span> F, </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">post =</span> T</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Schätzung für alpha_0</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>p_lasso<span class="sc">$</span>coef[<span class="st">"B"</span>]</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       B 
6.362409 </code></pre>
</div>
</div>
<p>Die Ähnlichkeit der Post-Lasso-Schätzung von <span class="math inline">\(\alpha_0\)</span> zur Lasso-Schätzung zeigt deutlich, dass die Verzerrung des Lasso-Schätzers überwiegend durch ausgelassene Variablen anstatt durch Shrinkage verursacht wird.</p>
<p>Mit <code>rlassoEffect()</code> können wir den Post-Double-Selection-Schätzer berechnen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-Double-Selection-Schätzer</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>pds_lasso <span class="ot">&lt;-</span> <span class="fu">rlassoEffect</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> X <span class="sc">%&gt;%</span> </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>B) <span class="sc">%&gt;%</span> </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(),</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> Y, </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> B, </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"double selection"</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Schnittmenge der selektierten Determinanten </span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="co"># von Y und B</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  S_BY <span class="ot">&lt;-</span> <span class="fu">names</span>(</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">which</span>(pds_lasso<span class="sc">$</span>selection.index)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "XB1"   "XB2"   "XB3"   "XB4"   "XB5"   "XB6"   "XB7"   "XB8"   "XB9"  
[10] "XB10"  "XB11"  "XB12"  "XB13"  "XB14"  "XB15"  "XB16"  "XB17"  "XB18" 
[19] "XB19"  "XB20"  "XB21"  "XB22"  "XB23"  "XB24"  "XB25"  "XU209" "XU241"
[28] "XU295" "XY3"   "XY7"   "XY8"   "XY12"  "XY13"  "XY15"  "XY16"  "XY19" 
[37] "XY23" </code></pre>
</div>
</div>
<p>Double Selection führt ebenfalls zu einem Post-Lasso-KQ-Schätzer mit allen 25 relevaten Variablen in <code>XB</code>. Wir selektieren allerdings deutlich weniger irrelevante Variablen aus <code>XU</code> als mit Single Selection und dennoch einige Determinanten von <span class="math inline">\(Y\)</span> aus <code>XY</code>. Double Selection führt also zu einer unverzerrten Schätzen mit geringerer Varianz. Mit <code>summary()</code> erhalten wir gültige Inferenz bzgl. des Treatment-Effekts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pds_lasso)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimates and significance testing of the effect of target variables"
   Estimate. Std. Error t value Pr(&gt;|t|)    
d1   1.94977    0.07127   27.36   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Der Post-Double-Selection-Schätzer liefert unter den betrachteten Verfahren die beste Schätzung von <span class="math inline">\(\alpha_0\)</span> und erlaubt gülstige statistische Inferenz. Der geschätzte Effekt ist hoch-signifikant.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Facts zum Post-Double-Selection-Schätzer
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Durch die sorgfältige Auswahl von Variablen, die mit Behandlung- und Outcome-Variable zusammenhängen, ermöglicht die Double-Selection eine bessere Kontrolle über das Risiko ausgelassender Variablen in Beobachtungsstudien und ermöglicht gültige (asymptotisch normale) Inferenz.</p></li>
<li><p>Der Post-Double-Selection-Schätzer besteht aus drei Regressionen:</p>
<ol type="1">
<li>Es werden Variablen mit Lasso selektiert, welche die <em>Behandlungs-Variable</em> erklären.</li>
<li>Es werden Variablen mit Lasso selektiert, welche die <em>Outcome-Variable</em> erklären.</li>
<li>Der Post-Double-Selection-Schätzer ist der KQ-Schätzer in einer Regression, die für die Schnittmenge der ausgewählten Variablen kontrolliert.</li>
</ol></li>
<li><p>Dank der Selektion mit Lasso kann der Schätzer auch bei hoch-dimensionalen Daten (<span class="math inline">\(k&gt;n\)</span>) angewendet werden.</p></li>
<li><p>Post-Double-Selection-Schätzer für Behandlungseffekte sind im R-Paket <code>hdm</code> implementiert.</p></li>
</ul>
</div>
</div>
<section id="case-study-makroökonomisches-wachstum" class="level3" data-number="13.4.1">
<h3 data-number="13.4.1" class="anchored" data-anchor-id="case-study-makroökonomisches-wachstum"><span class="header-section-number">13.4.1</span> Case Study: Makroökonomisches Wachstum</h3>
<p>Zur Illustration des Post-Double-Selection Schätzers betrachten wir eine empirische Anwendung bzgl. der Validierung von makroökonomischer Wachstumtheorie. Aus neo-klassischen Ansätzen wie dem <a href="https://de.wikipedia.org/wiki/Solow-Modell">Solow-Swan-Modell</a> kann die Hypothese, dass Volkswirtschaften zu einem gemeinsamen Wachstumspfad hin konvergieren, abgeleitet werden. Diese Konvergenzhypothese impliziert die Existenz von Aufholeffekten: Ärmere Volkswirtschaften müssen im mittel schneller Wachsen als die Wirschaft wohlhabender Länder. Die grundlegende Spezifikation eines entsprechenden Regressionsmodells lautet <span class="math display">\[\begin{align}
  \text{WR}_{i} = \alpha_0 \text{BIP0}_i + u_i, \label{eq:growthmodel1}
\end{align}\]</span> wobei <span class="math inline">\(\text{WR}_{i}\)</span> die Wachstumsrate des Pro-Kopf-BIP in Land <span class="math inline">\(i\)</span> über einen Zeitraum (typischerweise berechnet als Log-Differenz zwischen zwei Perioden) und <span class="math inline">\(\text{BIP0}_i\)</span> das (logarithmierte) Pro-Kopf-BIP zu beginn der Referenzperiode ist. Gemäß der Konvergenzhypothese muss <span class="math inline">\(\alpha_0&lt;0\)</span> sein: Je wohlhabender eine Volkswirtschaft ist, desto geringer ist das Wirtschaftswachstum.</p>
<p>Um Verzerrung durch ausgelassene Kovariablen zu vermeiden, sollte das Modell <span class="math inline">\(\eqref{eq:growthmodel1}\)</span> um länder-spezifische Regressoren <span class="math inline">\(x_{i,j}\)</span>, die sowohl das Ausgagnsniveau <span class="math inline">\(\text{BIP0}\)</span> sowie die Wachtumsrate beinflussen, erweitert werden. Zu der großen Menge potentieller Kovariablen gehören makro- und sozio-ökonomische Maße wie bspw. die Investitionstätigkeit des Staates, Offenheit der Volkswirtschaft, das politische Umfeld, das Bildungsniveau, die Demographie usw. Eine bevorzugte Spezifikation ist daher <span class="math display">\[\begin{align}
  \text{WR}_{i} = \alpha_0 \text{BIP0}_i + \sum_{j=1}^k \beta_j x_{i,j} + u_i,\label{eq:growthmodel2}
\end{align}\]</span> wobei <span class="math inline">\(\alpha_0\)</span> als Behandlungseffekt interpretiert werden kann. Beachte, dass <span class="math inline">\(\eqref{eq:growthmodel2}\)</span> eine Regression in der Form von <span class="math inline">\(\eqref{eq:lassotmt}\)</span> ist.</p>
<p>Wir illustrieren die Schätzung von und Inferenz bzgl. <span class="math inline">\(\alpha_0\)</span> in <span class="math inline">\(\eqref{eq:growthmodel2}\)</span> mit Post-Double-Selektion für einen 90 Länder umfassenden Auszug aus dem Datensatz von <span class="citation" data-cites="BarroLee2013">Barro und Lee (<a href="Literatur.html#ref-BarroLee2013" role="doc-biblioref">2013</a>)</span>, der als Objekt <code>GrowthData</code> im R-Paket <code>hdm</code> verfügbar ist.<a href="#fn24" class="footnote-ref" id="fnref24" role="doc-noteref"><sup>24</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datensatz in Arbeitsumgebung verfügbar machen</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hdm)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(GrowthData)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Anzahl Beobachtungen und Variablen</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(GrowthData)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 90 63</code></pre>
</div>
</div>
<p>Die Spalte <code>Outcome</code> ist die jeweilige Wachstumsrate des BIP zwischen den Perioden 1965-1975 und 1975-1985 und <code>gdpsh465</code> ist das reale Pro-Kopf-BIP im Jahr 1965 zu Preisen von 1980.</p>
<p>Wir führen zunächst eine graphische Analyse hinsichtlich des Modells einfachen Modells <span class="math inline">\(\eqref{eq:growthmodel1}\)</span> durch, indem wir <code>gdpsh465</code> gegen <code>Outcome</code> plotten und die geschätzte Regressionsgerade einzeichnen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Einfache grafische Analyse mit ggplot2</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>GrowthData <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> gdpsh465, </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> Outcome</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-bipsimple" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bipsimple-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="RegReg_files/figure-html/fig-bipsimple-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bipsimple-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;13.10: BIP-Wachstum: Einfache Regression
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-bipsimple" class="quarto-xref">Abbildung&nbsp;<span>13.10</span></a> zeigt einen geringen positiven geschätzten Effekt <span class="math inline">\(\widehat{\alpha}_0\)</span>. Eine Auswertung mit <code>lm()</code> ergibt, dass der Effekt <span class="math inline">\(\alpha_0\)</span> nicht signifikant von <span class="math inline">\(0\)</span> verschieden ist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Einfache Regression durchführen, </span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Inferenz für gdpsh465 erhalten</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Outcome <span class="sc">~</span> gdpsh465, <span class="at">data =</span> GrowthData) <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coefficients</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  .[<span class="dv">2</span>, ]</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Estimate  Std. Error     t value    Pr(&gt;|t|) 
0.001316713 0.006102200 0.215776701 0.829661165 </code></pre>
</div>
</div>
<p>Der positive Effekt aus der einfachen Schätzung widerspricht der Konvergenzhypothese. Dieses Ergebnis könnte allerdings durch Auslassen relevanter Kovariablen ungültig sein. Beispielsweise ist es plausibel, dass das Bildungsniveau einer Volkswirtschaft sowohl mit dem BIP korreliert ist als auch die Wachstumsrate beeinflusst. Dann wäre das Bildungsniveau eine relevante Kovariable, deren Auslassen zu einer verzerrten Schätzung von <span class="math inline">\(\alpha_0\)</span> führt.</p>
<p>Eine “lange” Regression mit allen Kovariablen ist zwar möglich, aber problematisch: Das Verhältnis von Beobachtungen (90) zu Regressoren (62) bedeutet eine hohe Unsicherheit der Schätzung.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inferenz für alpha_0 in langer Regression</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(Outcome <span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span> , <span class="at">data =</span> GrowthData)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coefficients</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  .[<span class="dv">2</span>, ]</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Estimate   Std. Error      t value     Pr(&gt;|t|) 
-0.009377989  0.029887726 -0.313773911  0.756018518 </code></pre>
</div>
</div>
<p>Der geschätzte Koeffizient <span class="math inline">\(\widehat{\alpha}_0\)</span> ist nun zwar negativ, liefert jedoch weiterhin keine Evidenz, dass <span class="math inline">\(\alpha_0\)</span> von 0 verschieden ist. Ein Vergleich der Standardfehler zeigt aber, dass die KQ-Schätzung aufgrund Berücksichtigung aller potentiellen Kovariablen mit deutlich größerer Varianz behaftet ist als in der einfachen KQ-Regression <span class="math inline">\(\eqref{eq:growthmodel1}\)</span></p>
<p>Post-Double-Selection erlaubt gültige Inferenz bzgl. <span class="math inline">\(\alpha_0\)</span> nach Schätzung der Menge relevanter Kovariablen. Wir weisen die entsprechenden Variablen R-Objekten zu und berechnen den Schätzer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variablen für Post-Double-Selection vorbereiten</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># abh. Variable</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> GrowthData <span class="sc">%&gt;%</span> </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Outcome)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># "Treatment"</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> GrowthData <span class="sc">%&gt;%</span> </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(gdpsh465)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="co"># potentielle Regressoren</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> GrowthData <span class="sc">%&gt;%</span> </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>Outcome, <span class="sc">-</span>intercept, <span class="sc">-</span>gdpsh465</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-Double-Selection-Schätzer berechnen</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>Growth_DS <span class="ot">&lt;-</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rlassoEffect</span>(</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> X <span class="sc">%&gt;%</span> </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.matrix</span>(), </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y, </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">d =</span> d, </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"double selection"</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Post-Double-Selection wählt aus der Menge potentieller Kovariablen lediglich sieben Regressoren aus.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selektierte Variablen einsehen</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ID</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>Selektion <span class="ot">&lt;-</span> Growth_DS<span class="sc">$</span>selection.index</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Namen auslesen</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">which</span>(Selektion <span class="sc">==</span> T)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bmp1l"    "freetar"  "hm65"     "sf65"     "lifee065" "humanf65" "pop6565" </code></pre>
</div>
</div>
<p><a href="#tbl-growthpdssek" class="quarto-xref">Tabelle&nbsp;<span>13.3</span></a> zeigt die Definitionen der ausgewählten Variablen.</p>
<div class="cell">
<div id="tbl-growthpdssek" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-growthpdssek-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;13.3: Mit PDS selektierte Variablen aus <code>GrowthData</code>. Referenzjahr 1965.
</figcaption>
<div aria-describedby="tbl-growthpdssek-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="kxrqdwghhf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kxrqdwghhf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kxrqdwghhf thead, #kxrqdwghhf tbody, #kxrqdwghhf tfoot, #kxrqdwghhf tr, #kxrqdwghhf td, #kxrqdwghhf th {
  border-style: none;
}

#kxrqdwghhf p {
  margin: 0;
  padding: 0;
}

#kxrqdwghhf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kxrqdwghhf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kxrqdwghhf .gt_title {
  color: #000000;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kxrqdwghhf .gt_subtitle {
  color: #000000;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kxrqdwghhf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kxrqdwghhf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kxrqdwghhf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #000000;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kxrqdwghhf .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kxrqdwghhf .gt_column_spanner_outer {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kxrqdwghhf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kxrqdwghhf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kxrqdwghhf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kxrqdwghhf .gt_spanner_row {
  border-bottom-style: hidden;
}

#kxrqdwghhf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kxrqdwghhf .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kxrqdwghhf .gt_from_md > :first-child {
  margin-top: 0;
}

#kxrqdwghhf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kxrqdwghhf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kxrqdwghhf .gt_stub {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kxrqdwghhf .gt_stub_row_group {
  color: #000000;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kxrqdwghhf .gt_row_group_first td {
  border-top-width: 2px;
}

#kxrqdwghhf .gt_row_group_first th {
  border-top-width: 2px;
}

#kxrqdwghhf .gt_summary_row {
  color: #000000;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kxrqdwghhf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kxrqdwghhf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kxrqdwghhf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kxrqdwghhf .gt_grand_summary_row {
  color: #000000;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kxrqdwghhf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kxrqdwghhf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kxrqdwghhf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kxrqdwghhf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
}

#kxrqdwghhf .gt_footnotes {
  color: #000000;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kxrqdwghhf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kxrqdwghhf .gt_sourcenotes {
  color: #000000;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kxrqdwghhf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kxrqdwghhf .gt_left {
  text-align: left;
}

#kxrqdwghhf .gt_center {
  text-align: center;
}

#kxrqdwghhf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kxrqdwghhf .gt_font_normal {
  font-weight: normal;
}

#kxrqdwghhf .gt_font_bold {
  font-weight: bold;
}

#kxrqdwghhf .gt_font_italic {
  font-style: italic;
}

#kxrqdwghhf .gt_super {
  font-size: 65%;
}

#kxrqdwghhf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kxrqdwghhf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kxrqdwghhf .gt_indent_1 {
  text-indent: 5px;
}

#kxrqdwghhf .gt_indent_2 {
  text-indent: 10px;
}

#kxrqdwghhf .gt_indent_3 {
  text-indent: 15px;
}

#kxrqdwghhf .gt_indent_4 {
  text-indent: 20px;
}

#kxrqdwghhf .gt_indent_5 {
  text-indent: 25px;
}

#kxrqdwghhf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kxrqdwghhf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Variable</th>
<th id="Beschreibung" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Beschreibung</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">bmp1l</td>
<td class="gt_row gt_left" headers="Beschreibung">Schwarzmarktprämie d. Währung</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable">freetar</td>
<td class="gt_row gt_left" headers="Beschreibung">Maß für Zollbeschränkungen</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">hm65</td>
<td class="gt_row gt_left" headers="Beschreibung">Einschreibungsquote Uni (Männer)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable">sf65</td>
<td class="gt_row gt_left" headers="Beschreibung">Beschulungsquote Sekundarstufe (Frauen)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">lifee065</td>
<td class="gt_row gt_left" headers="Beschreibung">Lebenserwartung bei Geburt</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable">humanf65</td>
<td class="gt_row gt_left" headers="Beschreibung">Durschn. Bildung im Alter 25 (Frauen)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">pop6565</td>
<td class="gt_row gt_left" headers="Beschreibung">Anteil Bevölkerung ü. 65 Jahre</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gültige Inferenz mit dem Post-Double-Selection-Schätzer</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Growth_DS)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimates and significance testing of the effect of target variables"
   Estimate. Std. Error t value Pr(&gt;|t|)   
d1  -0.05001    0.01579  -3.167  0.00154 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Das Ergebnis der Post-Double-Selection-Schätzung unterstützt die (bedingte) Konvergenzhypothese mit einer signifikanten negativen Schätzung <span class="math inline">\(\widehat{\alpha}_0\approx-0.05\)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-BarroLee2013" class="csl-entry" role="listitem">
Barro, Robert J., und Jong Wha Lee. 2013. <span>„A new data set of educational attainment in the world, 1950–2010“</span>. <em>Journal of Development Economics</em> 104: 184–98. https://doi.org/<a href="https://doi.org/10.1016/j.jdeveco.2012.10.001">https://doi.org/10.1016/j.jdeveco.2012.10.001</a>.
</div>
<div id="ref-Bellonietal2012" class="csl-entry" role="listitem">
Belloni, Alexandre, Daniel Chen, Victor Chernozhukov, und Christian Hansen. 2012. <span>„Sparse models and methods for optimal instruments with an application to eminent domain“</span>. <em>Econometrica</em> 80 (6): 2369–429.
</div>
<div id="ref-BelloniChernozhukov2013" class="csl-entry" role="listitem">
Belloni, Alexandre, und Victor Chernozhukov. 2013. <span>„Least squares after model selection in high-dimensional sparse models“</span>. <em>Bernoulli</em>, 521–47.
</div>
<div id="ref-Bellonietal2014" class="csl-entry" role="listitem">
Belloni, Alexandre, Victor Chernozhukov, und Christian Hansen. 2014. <span>„High-dimensional methods and inference on structural and treatment effects“</span>. <em>Journal of Economic Perspectives</em> 28 (2): 29–50.
</div>
<div id="ref-CortezSilva2008" class="csl-entry" role="listitem">
Cortez, Paulo, und Alice Maria Gonçalves Silva. 2008. <span>„Using data mining to predict secondary school student performance“</span>.
</div>
<div id="ref-Efronetal2004" class="csl-entry" role="listitem">
Efron, Bradley, Trevor Hastie, Iain Johnstone, und Robert Tibshirani. 2004. <span>„Least angle regression“</span>.
</div>
<div id="ref-Hahnetal2018" class="csl-entry" role="listitem">
Hahn, P Richard, Carlos M Carvalho, David Puelz, und Jingyu He. 2018. <span>„Regularization and confounding in linear regression for treatment effect estimation“</span>.
</div>
<div id="ref-HoerlKennard1970" class="csl-entry" role="listitem">
Hoerl, Arthur E, und Robert W Kennard. 1970. <span>„<span>Ridge regression: Biased estimation for nonorthogonal problems</span>“</span>. <em>Technometrics</em> 12 (1): 55–67.
</div>
<div id="ref-Tibshirani1996" class="csl-entry" role="listitem">
Tibshirani, Robert. 1996. <span>„Regression shrinkage and selection via the lasso“</span>. <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em> 58 (1): 267–88.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Beachte, dass für <span class="math inline">\(\lambda=0\)</span> die Verlustfunktion des KQ-Schätzers folgt.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>D.h. wir wählen <span class="math inline">\(p\)</span>, um einen Schätzer mit für die konkrete Anwendung hilfreichen Eigenschaften zu erhalten.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Beispiel: <code>X &lt;- matrix(rnorm(100), ncol = 10)</code>. Vergleiche <code>solve(t(X) %*% X)</code> und <code>solve(t(X) %*% X + diag(.01, nrow = 10))</code><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Bspw. mit der Funktion <code>scale()</code>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Orthonormalität heißt <span class="math inline">\(\boldsymbol{X}_i'\boldsymbol{X}_j = 1\)</span> für <span class="math inline">\(i=j\)</span> und <span class="math inline">\(0\)</span> sonst. Dann ist <span class="math inline">\(\boldsymbol{X}\)</span>’<span class="math inline">\(\boldsymbol{X} = \boldsymbol{I}_k\)</span>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p><span class="math inline">\((1+\lambda)^{-1}\)</span> wird auch als <em>Shrinkage-Faktor</em> bezeichnet.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Für bessere Interpretierbarkeit der Grafischen Auswertung, wählen wir positive und negative Koeffizienten mit gleichem Bertag.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p><code>alpha</code> ist ein Mischparameter im Algorithmus für <a href="https://en.wikipedia.org/wiki/Elastic_net_regularization">elastic net</a>, siehe <code>?glmnet</code>.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Die Wahl von <code>lambda.1se</code> ist eine Heuristik, welche die Schätzunsicherheit berücksichtigt und zu einem “sparsameren” Modell tendiert.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>Wir verwenden eine Auszug aus dem Orignaldatensatz, der nebst ausführlicher Variablenbeschreibung <a href="https://archive.ics.uci.edu/dataset/320/student+performance">hier</a> verfügbar ist.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>Zur Bestimmung des Schätzers werden Algorithmen der nicht-linearen Optimierung genutzt.<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>LARS steht für <em>Least Angle Regression</em>.<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p><code>lars()</code> standardisiert die Regressoren standardmäßig (aufgrund des DGPs hier nicht nötig).<a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>Aktivierung meint die Aufnahme einer Variable in der Modell gegeben eines hinreichend kleinen <span class="math inline">\(\lambda\)</span>.<a href="#fnref14" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p>Chetverikov, Liao, and Chernozhukov (2020) zeigen, dass CV zu konsistenter Modellselektion führen kann.<a href="#fnref15" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn16"><p>Wegen <span class="math inline">\(N=25\)</span> verbleiben bei der KQ-Schätzung mit 9 Regressoren nur 16 Freiheitsgrade.<a href="#fnref16" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn17"><p>Dies folgt aus der Definition von <code>walk</code>. <code>&lt;-</code> bewirkt hier lediglich Assignment in der Funktionsumgebung.<a href="#fnref17" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn18"><p>Die Sequenzen haben wir in Abhängigkeit des DGP so gewählt, dass die Abhängigkeit der Prognosegüte von <span class="math inline">\(\lambda\)</span> gut visualisiert werden kann.<a href="#fnref18" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn19"><p>Beachte, dass der KQ-Schätzer bei <span class="math inline">\(k&gt;N\)</span> nicht lösbar ist.<a href="#fnref19" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn20"><p>Dieses Szenario wird unter Bedingungen bzgl. der Wachstumsrate und der Größe der Koeffizienten betrachet, s. <span class="citation" data-cites="BelloniChernozhukov2013">(<a href="Literatur.html#ref-BelloniChernozhukov2013" role="doc-biblioref">Belloni und Chernozhukov 2013</a>)</span>.<a href="#fnref20" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn21"><p><span class="citation" data-cites="Hahnetal2018">Hahn u.&nbsp;a. (<a href="Literatur.html#ref-Hahnetal2018" role="doc-biblioref">2018</a>)</span> geben eine ausführliche Erläuterung dieser Problematik.<a href="#fnref21" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn22"><p>Solche Verfahren werden <em>Post-Selection-Schätzer</em> gennant.<a href="#fnref22" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn23"><p>Diese Funktionen ermitteln ein optimales <span class="math inline">\(\lambda\)</span> mit dem in <span class="citation" data-cites="Bellonietal2012">Belloni u.&nbsp;a. (<a href="Literatur.html#ref-Bellonietal2012" role="doc-biblioref">2012</a>)</span> vorgeschlagenen Algorithmus.<a href="#fnref23" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn24"><p>Eine ausführliche Beschreibung der Variablen ist <a href="https://www2.nber.org/pub/barro.lee/readme.txt">hier</a> einsehbar.<a href="#fnref24" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./SyntheticControl.html" class="pagination-link" aria-label="Synthetic Control">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Synthetic Control</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Machine Learning.html" class="pagination-link" aria-label="Machine Learning">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Machine Learning</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>