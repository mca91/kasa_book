
# Event Studies

```{r, echo=F, message=FALSE}
library(gt)
library(tidyverse)
# Formatierung von gt-Tabellen
tabopts <- function(x) {
  fmt_number(x, decimals = 3, drop_trailing_zeros = T) %>%
    tab_options(
      # general
      table.width = "80%",
      # fonts
      table.font.color = "black", 
      table.font.size = 16,
      column_labels.font.weight = "bold", 
      # table header  
      column_labels.padding = 15,
      column_labels.border.bottom.color = "black", 
      column_labels.border.bottom.width = "1px", 
      column_labels.border.top.color = "black",
      # group labels
      row_group.border.top.width = 0,
      row_group.border.bottom.width = 0,
      row_group.font.weight = "bold",
      row_group.padding = 20,
      # body
      
      table_body.hlines.width = 0, 
      table_body.border.bottom.color = "black",
      table_body.border.bottom.width = "1px",
      table_body.border.top.width = "0px",
      table.border.bottom.color = "black"
    )
}
```

## Case Study: Abschreckungseffekte durch Strafgesetzgebung

@Abrams2012 untersucht den Abschreckungseffekt drohender Inhaftierung für Straftaten anhand von Daten zu verschärfter Strafgesetzgebung ("Add-on laws") in den USA. Solche Gesetze erhöhen in der Regel die Strafen für Delikte, insbesondere wenn nachweißlich Schusswaffen verwendet werden. Die Studie nutzt eine Event-Study-Methodik, um die Auswirkungen dieser Gesetzesänderung auf die Kriminalitätsraten für verschiedene Straftaten zu analysieren. Dabei wird der Zeitpunkt der tatsächlichen Gesetzeseinführung in verschiedenen US-Bundesstaaten herangezogen, um den kausalen Abschreckungseffekt einer drohenden Gefängnisstrafe anhand von Statistiken in den unmittelbaren Folgeperioden zu isolieren. 

### Identifikationsstrategie

Der Fokus des Forschungsdesigns liegt auf der Unterscheidung zwischen zwei wesentlichen Wirkungskanälen von verschärften Strafgesetzen auf die Kriminalitätsrate:

1. **Abschreckungseffekt**: Die Aussicht auf eine längere Inhaftierung erzielt einen Abschreckungseffekt, der sich 'positiv' auf die Kriminalitätsrate auswirkt (im Sinne einer verringerten Kriminalität). Dies ist der vermutete (kausale) Effekt.

2. **Inhaftierungseffekt**: Inhaftierte Individuen können keine Straftaten begehen und verringern daher die Kriminalitätsrate. Dieser Effekt ist insbesondere für Straftaten mit großer Rückfälligkeit plausibel (etwa Beschaffungskriminalität). Für längere Haftstrafen erwarten wir daher einen Rückgang dieser Kriminalitätsraten nach der Verschärfung der Gesetze.

Der in 2. beschriebene Effekt der Gesetzesverschärfung kann sich erst *nach* der im Rahmen der alten Gesetzgebung verhängten durchschnitlichen Mindesthaftstrafe einstellen: Der verringernde Effekt auf die Kriminalitätsrate zeigt sich erst in den Daten, nachdem Straftäter länger als gemäß der alten Gesetzgebung üblich inhaftiert sind. Rückgänge der Kriminalitätrate die in diesem Zeitraum unmittelbar nach der Gesetztesverschärfung gemessen werden, können also auf den Abschreckungseffekt zurückgeführt werden.

### Replikation mit R

Der Datensatz `Abrams2012.dta` ist ein Auszug der Daten aus dem Replikationspaket @Abrams2012data] zu, welches [hier](https://www.openicpsr.org/openicpsr/project/113838/version/V1/view) eingesehen werden kann. Die Daten liegen im STATA-Format `.dta` und können mit `haven::read_dta()` eingelesen werden.

```{r}
library(haven)
library(dplyr)

# Datensatz einlesen
abrams <- read_dta(file = "datasets/Abrams2012.dta")

# Überblick
glimpse(abrams)
```

Eine Erläuterung der verfügbaren (ausschließlich numerischen) Variablen erfolgt in @tbl-abrams2012vars.

```{r}
#| echo: false
#| label: tbl-abrams2012vars
#| tbl-cap: "`Abrams2012.dta` -- Kriminalität in US-Bundesstaaten."
tibble(
  Variable = colnames(abrams),
  Beschreibung = c(
    "Pro-Kopf-Kriminalitätsrate",
    "Pro-Kopf-Rate Raubüberfälle mit Schusswaffen",
    "Log Pro-Kopf-Rate Raubüberfälle mit Schusswaffen",
    "Bundesstaat",
    "Jahr",
    "Gesetzliche Mindeststrafe in Kraft",
    "Perioden rel. zur Einführung von Add-On-Law",
    "Dummy: Jemals Add-on-Law?",
    "Dummy: 1 Jahr nach Einführung Add-On-Law",
    "Dummy: 2 Jahre nach Einführung Add-On-Law",
    "Dummy: 3 Jahre nach Einführung Add-On-Law",
    "Armutsquote",
    "Arbeitlosenquote",
    "Bevölkerungsstruktur",
    "Anteil 15 bis 17 Jährige",
    "Anteil 18 bis 24 Jährige",
    "Anteil 25 bis 34 Jährige",
    "Anteil Polizeikräfte an Bevölkerung",
    "Anteil Inhaftierte an der Bevölkerung",
    "Dummy: Beobachtung nach 1974",
    "Bevölkerung"
    )
) %>%
  gt() %>%
  tabopts()
```


```{r}
library(tidyr)

# Populationsgewichtete Trends berechnen
plot_dat <- abrams %>% 
  select(
    year, 
    everaddon, 
    pcralloffense, 
    pcrrobgun, 
    statepop
  ) %>%
  mutate(
    pcrrobgun = pcrrobgun * 33.3
  ) %>%
  rename(
    Schusswaffen = pcrrobgun, 
    Gesamt = pcralloffense,
    AddOnGesetze = everaddon
  ) %>%
  pivot_longer(
    cols = Schusswaffen:Gesamt, 
    names_to = "Verbrechen", 
    values_to = "Wert"
  ) %>%
  group_by(year, AddOnGesetze, Verbrechen) %>% 
  mutate(
    AddOnGesetze = as.factor(AddOnGesetze),
    ) %>%
  summarise(
    Wert = weighted.mean(
      Wert, 
      w = statepop, 
      na.rm = T
    )
  ) 
```

```{r}
#| label: fig-abramstrends
#| fig-cap: "Populations-gewichtete mittlere Pro-Kopf-Kriminalitätsraten für US-Bundesstaaten"
library(ggplot2)
library(cowplot)

# Trendverlauf plotten
ggplot(
  data = plot_dat,
  mapping = aes(
    x = year, 
    y = Wert, 
    color = Verbrechen, 
    lty = AddOnGesetze
  )
) +
  geom_line() +
  scale_y_continuous(
    name = "Gesamte Anzeigen / 100k Einw.",
    sec.axis = sec_axis(
      transform = ~ . / 33.3, 
      name = "Raubüberfälle Schusswaffen / 100k Einw."
    )
  ) +
  theme_cowplot() +
  theme(
    legend.position = "bottom", 
    axis.title.y.left = element_text(color = "#F8766D"),
    axis.title.y.right = element_text(color = "#00BFC4")
  )
```

@fig-abramstrends zeigt einen starken Anstieg der Kriminalität in den 1960er und 1970er Jahren, insbesondere für Rabüberfälle mit Schusswaffen. Weiterhin sind die Trends in Staaten mit und ohne Zusatzstrafen deutlich korreliert. Die Entwicklung der Pro-Kopf-Kriminalität insgesamt schwächt sich nachfolgend ab und folgt ab den 1990er Jahren einem rückläufigen Trend. Es ist auffällig, dass sowohl die bewaffneten Raubüberfälle als auch die allgemeine Kriminalität zu Beginn des Beobachtungszeitraums für Staaten mit Add-on-Gesetzen höher sind, sich dies aber im letzten Jahrzehnt ebenfalls umkehrt. Wie in @Abrams2012 erläutert, könnte dies sowohl auf verschäfte Gesetze als auch auf Variation zwischen den Bundesstaaten zurückzuführen sein. Statistische Verfahren sollten zwischen diesen Möglichkeiten unterscheiden können (bspw. durch Fixed Effects und spezifische Zeit-Trends).

#### Basis-Spezifikation

Wir folgen @Abrams2012 und schätzen zunächst mehrere Basis-Spezifikationen für eine balancierte Teilstichprobe aus `abrams`. Das Regressionsmodell ist
\begin{align}
  \log\textup{Rob}_{at} = \beta \textup{AddOn}^i_{st} + \lambda_s + \gamma_t + x_{st} + \epsilon_{at},
\end{align}
wobei $\log\textup{Rob}_{at}$ die logarithmierte Pro-Kopf-Rate für Überfälle mit Schusswaffe (`lnpcrrobgun`). $\textup{AddOn}^i_{st}$ ist eine Dummy-Variable die 1 ist für Beobachtungen des Bundesstaats $s$ in Jahr $t$, wenn die Einführung des Add-On-Gesetzes $i$ Jahre zurückliegt. $\lambda_s$ und $\gamma_t$ sind Fixed Effects für Bundesstaaten und Perioden. $x_{st}$ repräsentiert alle Kontrollvariablen auf Bundesstaatenebene. Hierbei werden stets sämtliche Variablen mit einer Bezeichnung beginnend mit `dc` berücksichtigt, vgl. @tbl-abrams2012vars.

Für die komfortable Schätzung von Fixed Effects und die Berechnung cluster-robusten Standardfehlern verwenden wir `fixest::feols()`, siehe @sec-paneldata für Details zur Schätzung von Panel-Daten-Modellen.

```{r}
library(fixest)

# Basis-Spezifikation
# Table 3 (3)
mod_basis <- feols(
  fml = lnpcrrobgun ~
   # Effekt 1 Jahr nach Add-on law              
   yaddon
   # Ges. Mindeststrafe?
   + ymm
   # Kontrollvariablen
   + dcpoverty
   + dcunemp
   + dcblack_per
   + dcp15t17
   + dcp18t24 
   + dcp25t34
   + dcpolice_per1
   + dcprison_per1
   # Fixed Effects
   | FSTATE + year,
   data = abrams %>% 
     filter(relyr >= -7 & relyr <= 6), 
   weights = ~ statepop,
   vcov = ~ FSTATE
)

summary(mod_basis)
```

```{r}
# (4)
# + state-specific time trends
mod_trends <- feols(fml = lnpcrrobgun ~
        # Effekt 1 Jahr nach Add-on law              
        yaddon
        # Ges. Mindeststrafe?
      + ymm
        # Kontrollvariablen
      + dcpoverty
      + dcunemp
      + dcblack_per
      + dcp15t17
      + dcp18t24 
      + dcp25t34
      + dcpolice_per1
      + dcprison_per1
      # Trends: Bundesstaat
      + FSTATE:year
      # Fixed Effects
      | FSTATE + year,
      data = abrams %>% 
        filter(relyr >= -7 & relyr <= 6), 
      weights = ~ statepop,
      vcov = ~ FSTATE
)

summary(mod_trends)
```

```{r}
# (8)
# Post 1974
# + state-specific time trends
mod_trends_post <- feols(
  fml = lnpcrrobgun ~
        # Effekt 1 Jahr nach Add-on law
        yaddon
        # Ges. Mindeststrafe?
      + ymm
        # Kontrollvariablen
      + dcpoverty
      + dcunemp
      + dcblack_per
      + dcp15t17
      + dcp18t24 
      + dcp25t34
      + dcpolice_per1
      + dcprison_per1
      # Trends: Bundesstaat
      + FSTATE:year
      # Fixed Effects
      | FSTATE + year,
      data = abrams %>% 
        filter(
          relyr >= -7 & relyr <= 6, 
          post74 == 1
        ), 
      weights = ~ statepop, 
      vcov = ~ FSTATE
)

summary(mod_trends_post)
```

#### Event Study

```{r}
# Dateb für ES vorbereiten
abrams_es <- abrams %>%
  mutate(
    relyr = if_else(relyr < -7, -7, relyr),
    relyr = if_else(relyr > 6, 6, relyr)
  ) %>%
  pivot_wider(
    names_from = relyr, 
    values_from = relyr, 
    names_prefix = "D", 
    values_fn = list(relyr = ~ 1), 
    values_fill = 0
  ) %>%
  rename_with(
    .fn = ~ gsub("-", "_", .), 
    .cols = starts_with("D")
  )
```


```{r}
#| message: false
# Event-Study-Regression
es_mod <- feols(
  fml = lnpcrrobgun ~
      # Rel. Zeitpunkt-Dummies
      + D_6
      + D_5
      + D_4
      + D_3
      + D_2
      + D_1
      + D0      
      + D1
      + D2
      + D3
      + D4
      + D5
      + D6
      # Kovariablen
      + dcpoverty
      + dcunemp
      + dcblack_per
      + dcp15t17
      + dcp18t24 
      + dcp25t34
      + dcpolice_per1
      + dcprison_per1
      # Trends: Bundesstaaten
      + FSTATE:year
      # Fixed Effects
      | FSTATE + year,
       data = abrams_es,
      weights = ~ statepop, 
      vcov = ~ FSTATE
)

summary(es_mod, n = 13)
```

```{r}
# Daten für Event-Study-Plot
# Extract the coefficients and standard errors for the dummies
coefficients <- coef(es_mod)
std_errors <- se(es_mod)

# Select the relevant coefficients and standard errors for the dummies D_-6 to D_6
events <- -6:6
event_names <- names(coefficients)[1:13]

event_coefficients <- coefficients[event_names]
event_std_errors <- std_errors[event_names]


# Create a data frame for plotting
plot_data <- tibble(
  Event = events,
  Estimate = event_coefficients,
  SE = event_std_errors
)

# Add confidence intervals
plot_data <- plot_data %>%
  mutate(
    CI_Lower = Estimate - SE,
    CI_Upper = Estimate + SE
  )
```

```{r}
# Event-Study-Plot
ggplot(
  data = plot_data, 
  mapping = aes(x = Event, y = Estimate)
) +
  # gesch. Effekte
  geom_point() +
  geom_line() +
  # SE-Intervall
  geom_ribbon(
    mapping = aes(
      ymin = CI_Lower, 
      ymax = CI_Upper
    ),
    fill = "steelblue",
    color ="white",
    alpha = 0.2
  ) +
  # Hilfslinien
  geom_hline(
    yintercept = c(0), 
    linewidth = .2
  ) +
  geom_vline(
    xintercept = 0, 
    linetype = "dashed", 
    color = "red"
  ) +
  # Labels
  labs(
    x = "Relativer Zeitpunkt zur Einf. Add-on-Gesetz",
    y = "Log Rate: Schussw. Überfälle") +
  theme_cowplot()
```

## Zusammenfassung



